webpackJsonp([16],{1638:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r(1639),r(202)},1639:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(1640),o=r(1641),i=r(1642),a=r(1643),s=r(1644),u=r(1645),c=function(){function e(e,t,r){this.$rootScope=e,this.utilityService=t,this.$injector=r,this.moduleMemoryCalculator=new n.AngularModuleMemoryCalculator(this.$rootScope,this.$injector),this.scopeMemoryCalculator=new o.ScopeMemoryCalculator(this.$rootScope,this.$injector),this.windowMemoryCalculator=new i.WindowMemoryCalculator(this.$rootScope,this.$injector),this.eventListenerWalker=new a.EventListenerDOMWalker,this.eventListenerV2Walker=new s.DetachedDomEventFinder(this.utilityService),this.scopeDOMWalker=new u.ScopeDOMWalker}return e.$inject=["$rootScope","utilityService","$injector"],e.mapAngularMemorySizeResults=function(e){var t=[];return _.forEach(e.memorySizeDictionary,function(e){t.push(e)}),t},e.prototype.calculateTeamsAppModuleMemorySize=function(t){void 0===t&&(t=!1);var r=this.moduleMemoryCalculator.calculateAngularModuleMemorySize("teamspace",{memorySizeDictionary:{},computedModules:{}},t);return e.mapAngularMemorySizeResults(r)},e.prototype.sizeOfRootScopeInMB=function(){return this.scopeMemoryCalculator.sizeOfRootScopeInMB()},e.prototype.mapScopeMemoryResults=function(e){var t=[],r=this.scopeDOMWalker.createScopeElementMap();return _.forEach(e,function(e,n){var o={};o.id=n,o.xpath=void 0,o.watchCount=0,r[n]&&(o.xpath=r[n].xpath,o.watchCount=r[n].watchCount),o.sizeInMB=e,t.push(o)}),t},e.prototype.analyzeScopeMemory=function(){var e=this.scopeMemoryCalculator.traverseAndMeasureScopes(this.$rootScope);return this.mapScopeMemoryResults(e)},e.prototype.windowSize=function(){return this.windowMemoryCalculator.windowSize()},e.prototype.analyzeEventListeners=function(){var e=this.eventListenerWalker.getAllEventListenersFromDocumentNode();return e.sort(function(e,t){return t.listenerCount-e.listenerCount}),console.log("All Event Listeners"),console.table(e),e},e.prototype.analyzeScopeInfo=function(){var e=document.documentElement,t=this.scopeDOMWalker.populateScopeInformation(e);return console.log("All Scope Info"),console.table(t),t},e.prototype.startAnalysisForEventLeaks=function(){var e=this,t=this.eventListenerWalker.getAllEventListenersFromDocumentNode();return function(){var r=e.eventListenerWalker.getAllEventListenersFromDocumentNode();return e.diffEventListenerSnapshots(t,r)}},e.prototype.startAnalysisForEventLeaksV2=function(){var e=this;return this.eventListenerV2Walker.start(),function(){var t=e.eventListenerV2Walker.getRemovedElementsWithPendingEventsAttached();return e.eventListenerV2Walker.stop(),t}},e.prototype.diffEventListenerSnapshots=function(e,t){for(var r=_.intersectionBy(e,t,"xpath"),n=[],o=0;o<r.length;o++){var i=_.find(e,{xpath:r[o].xpath}),a=_.find(t,{xpath:r[o].xpath});a.listenerCount>i.listenerCount&&n.push({elementTag:i.elementTag,xpath:i.xpath,eventSummaryBefore:i.eventSummary,eventSummaryAfter:a.eventSummary,listenerCountDiff:a.listenerCount-i.listenerCount})}return n.length>0&&(console.error("Leaks found!"),console.table(n)),n},e.prototype.startAnalysisForScopeLeaks=function(){var e=this,t=this.scopeDOMWalker.populateScopeInformation(document.documentElement);return function(){var r=e.scopeDOMWalker.populateScopeInformation(document.documentElement);return e.diffScopeListenerSnapshots(t,r)}},e.prototype.diffScopeListenerSnapshots=function(e,t){for(var r=_.intersectionBy(e,t,"xpath"),n=[],o=0;o<r.length;o++){var i=_.find(e,{xpath:r[o].xpath}),a=_.find(t,{xpath:r[o].xpath});a.listenerCount>i.listenerCount&&n.push({id:a.id,xpath:i.xpath,listenerSummaryBefore:i.listenerSummary,listenerSummaryAfter:a.listenerSummary,listenerCountDiff:a.listenerCount-i.listenerCount})}return n.length>0&&(console.error("Leaks found!"),console.table(n)),n},e.prototype.startAnalysisForServiceLeaks=function(e){var t=this,r=this.calculateTeamsAppModuleMemorySize(e);return function(){var n=t.calculateTeamsAppModuleMemorySize(e);return t.diffModuleMemorySnapshots(r,n)}},e.prototype.diffModuleMemorySnapshots=function(e,t){for(var r=_.intersectionWith(e,t,function(e,t){return e.provider===t.provider&&e.moduleName===t.moduleName&&e.providerMethod===t.providerMethod&&e.providerName===t.providerName}),n=[],o=0;o<r.length;o++){var i=_.find(e,{provider:r[o].provider,moduleName:r[o].moduleName,providerMethod:r[o].providerMethod,providerName:r[o].providerName}),a=_.find(t,{provider:r[o].provider,moduleName:r[o].moduleName,providerMethod:r[o].providerMethod,providerName:r[o].providerName}),s=this.diffSubscriptions(a.subscriptions,i.subscriptions);(a.sizeInMB-i.sizeInMB>0||s.length>0)&&n.push({provider:r[o].provider,moduleName:r[o].moduleName,providerMethod:r[o].providerMethod,providerName:r[o].providerName,sizeInMBBefore:i.sizeInMB,sizeInMBAfter:a.sizeInMB,sizeInMBDiff:a.sizeInMB-i.sizeInMB,subscriptionCountDiff:s})}return n.length>0&&(console.error("Leaks found in services"),console.table(n)),n},e.prototype.diffSubscriptions=function(e,t){var r=this.mapValues(_.values(e)),n=this.mapValues(_.values(t)),o=[];return r.forEach(function(e,t){n.has(t)?e-n.get(t)>0&&o.push({signature:t,signatureSource:"after",countDiff:e-n.get(t)}):o.push({signature:t,signatureSource:"after",countDiff:e})}),o},e.prototype.mapValues=function(e){var t=new Map;return _.values(e).forEach(function(e){if(t.has(e)){var r=t.get(e);r+=1,t.set(e,r)}else t.set(e,1)}),t},e}();t.MemoryAnalysisService=c,angular.module("teamspace.memoryAnalysisService",[]).service("memoryAnalysisService",c)},1640:function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t,r){return e.call(this,t,r)||this}return n(t,e),t.prototype.enumerateProviderQueue=function(e){var t=[];_.forEach(e,function(e){t.push(e)});for(var r=[];t.length>0;){var n=t.pop();if(r.push(n),n[2].length>2){var o=n[2][1],i=o.slice(0,o.length-1);t.concat(i)}}return r},t.prototype.getSubscriberCount=function(e){return e instanceof SkypeX.Services.ObservableBase?_.mapValues(e._subsByNum,function(e){return e.callback.toString()}):e instanceof teamspace.services.stores.SingleStateStoreImpl||e instanceof teamspace.services.stores.MultiStateStoreImpl?_.mapValues(e.listeners,function(e){return e.onStateChanged.toString()}):{}},t.prototype.getMemorySizeOfProviders=function(e,t,r,n){var o=this,i=this.enumerateProviderQueue(t);return _.forEach(i,function(t){var i=t[0],a=t[1],s=t[2][0],u=e+":"+i+":"+a+":"+s;try{if(!r[u]&&o.$injector.has(s)){var c=o.$injector.get(s),p=n(c)/o.mBValue;r[u]={moduleName:e,provider:i,providerMethod:a,providerName:s,sizeInMB:p,subscriptions:o.getSubscriberCount(c)}}}catch(e){console.error(e),console.error("Unable to get injector for "+s)}}),r},t.prototype.getMemorySizeOfModule=function(e,t,r){return this.getMemorySizeOfProviders(e,angular.module(e)._invokeQueue,t,r)},t.prototype.calculateAngularModuleMemorySize=function(e,t,r){void 0===r&&(r=!1);var n=[];for(n.push(e);0!==n.length;){var o=n.shift();t.computedModules[o]=!0,console.log("calculating mem size of module BFS : "+o),t.memorySizeDictionary=this.getMemorySizeOfModule(o,t.memorySizeDictionary,r?function(){return 0}:this.sizeofProvider.bind(this)),_.forEach(angular.module(o).requires,function(e){t.computedModules[e]||n.push(e)})}return t},t}(r(50).MemoryCalculator);t.AngularModuleMemoryCalculator=o},1641:function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t,r){return e.call(this,t,r)||this}return n(t,e),t.prototype.visit=function(e,t){t[e.$id]||(console.log("visiting scope : "+e.$id),t[e.$id]=this.sizeofScope(e)/this.mBValue)},t.prototype.traverseBFS=function(e,t){var r=[];for(r.push(e);0!==r.length;){var n=r.shift();this.visit(n,t),n.$$nextSibling&&r.push(n.$$nextSibling),n.$$childHead&&r.push(n.$$childHead)}},t.prototype.traverseAndMeasureScopes=function(e){var t={};return this.traverseBFS(e,t),t},t.prototype.sizeOfRootScopeInMB=function(){return this.sizeOfRootScope()/this.mBValue},t}(r(50).MemoryCalculator);t.ScopeMemoryCalculator=o},1642:function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t,r){return e.call(this,t,r)||this}return n(t,e),t.prototype.windowSize=function(){var e={};for(var t in window)"object"==typeof window[t]&&(e[t]=this.sizeofProvider(window[t])/this.mBValue);return e.window=this.sizeofWindowReference(window)/this.mBValue,e},t}(r(50).MemoryCalculator);t.WindowMemoryCalculator=o},1643:function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){return e.call(this)||this}return n(t,e),t.prototype.getAllEventListenersFromDocumentNode=function(){var e=document.documentElement;return this.getAllEventListenersFromNode(e)},t.prototype.getAllEventListenersFromNode=function(e){var t=this;return this.walkDomTree(e,function(e,r){if(e){var n=$._data(e,"events"),o=0;if(n&&Object.keys(n).forEach(function(e){o+=n[e].length}),o>0){var i=Object.keys(n).sort().map(function(e){return e+": "+n[e].length}).join("\n").trim(),a=t.getXpathTo(e);r.push({elementTag:e.tagName,listenerCount:o,xpath:a,eventSummary:i,eventList:n})}}},[])},t}(r(76).DOMTreeWalker);t.EventListenerDOMWalker=o},1644:function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t){var r=e.call(this)||this;return r.utilityService=t,r}return n(t,e),t.prototype.start=function(){this.setupSpy(),this.eventListenerCache={}},t.prototype.stop=function(){this.revertSpyForAddRemoveEventListener(),t.isSpying=!1,this.eventListenerCache=void 0},t.prototype.getRemovedElementsWithPendingEventsAttached=function(){var e={};for(var r in this.eventListenerCache){var n=this.eventListenerCache[r];if(n)for(var o in n){var i=n[o];if(i.handlers&&i.handlers.length){var a=$("["+t.listenerIdentifierAttributeName+"='"+o+"']");if(!(a&&a.length>0)){for(var s=[],u=0;u<i.handlers.length;u++)s.push(i.handlers[u].toString());var c=i.componentTagName?i.componentTagName:"UNKNOWN";e[c]||(e[c]=[]),e[c].push({listenerCount:i.handlers.length,xpath:i.xpath,tag:i.tag,eventName:r,class:i.class,handlers:s})}}}}return e},t.prototype.setupSpy=function(){t.isSpying||(t.isSpying=!0,this.setupSpyForAddRemoveEventListener())},t.prototype.setupSpyForAddRemoveEventListener=function(){var e=this;this.addEventListenerOriginal=Element.prototype.addEventListener,Element.prototype.addEventListener=function(t,r){e.addEventListenerSpy.call(e,this,t,r,arguments)},this.removeEventListenerOriginal=Element.prototype.removeEventListener,Element.prototype.removeEventListener=function(t,r){e.removeEventListenerSpy.call(e,this,t,r,arguments)}},t.prototype.revertSpyForAddRemoveEventListener=function(){Element.prototype.addEventListener=this.addEventListenerOriginal,this.addEventListenerOriginal=void 0,Element.prototype.removeEventListener=this.removeEventListenerOriginal,this.removeEventListenerOriginal=void 0},t.prototype.removeEventListenerSpy=function(e,r,n,o){var i=e.getAttribute(t.listenerIdentifierAttributeName);if(i){var a=this.eventListenerCache[r];if(a){var s=a[i];s&&_.remove(s.handlers,function(e){return e===n}),this.removeEventListenerOriginal.apply(e,o)}else this.removeEventListenerOriginal.apply(e,o)}else this.removeEventListenerOriginal.apply(e,o)},t.prototype.addEventListenerSpy=function(e,t,r,n){this.trackAddEventListener(e,t,r,n),this.addEventListenerOriginal.apply(e,n)},t.prototype.trackAddEventListener=function(e,r,n,o){var i=this.eventListenerCache[r];i||(i={},this.eventListenerCache[r]=i);var a=e.getAttribute(t.listenerIdentifierAttributeName);a||(a=this.utilityService.generateUUID(),e.setAttribute(t.listenerIdentifierAttributeName,a));var s=i[a],u=!0;if(!s){s={};try{var c;s.xpath=this.getXpathTo(e,!1,function(e){e&&e.tagName.indexOf("-")>0&&!c&&(c=e.tagName),e&&e.parentElement||(u=!1)}),s.componentTagName=c}catch(e){console.error("Error while getting xpath")}if(!u)return;s.class=e.className,s.tag=e.tagName,i[a]=s}s.handlers||(s.handlers=[]),_.some(s.handlers,function(e){return e===n})||s.handlers.push(n)},t.prototype.getElementIdentifier=function(e){var t=e.tagName;return e.className&&(t+="(class="+e.className+")"),t},t.listenerIdentifierAttributeName="elv2-id",t}(r(76).DOMTreeWalker);t.DetachedDomEventFinder=o},1645:function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){return e.call(this)||this}return n(t,e),t.prototype.countListeners=function(e){var t=0;return _.each(e,function(e){e&&t++}),t},t.prototype.calculateScopeListenerCount=function(e){var t=this,r=0;return _.each(Object.keys(e.$$listeners),function(n){r+=t.countListeners(e.$$listeners[n])}),r},t.prototype.generateScopeListenerSummary=function(e){var t=this;return Object.keys(e.$$listeners).sort().map(function(r){return r+": "+t.countListeners(e.$$listeners[r])}).join("\n").trim()},t.prototype.populateScopeInformation=function(e){var t=this;return this.walkDomTree(e,function(e,r){if(e&&angular.element(e).isolateScope){var n=angular.element(e).isolateScope()||angular.element(e).scope();n&&!_.some(r,{id:n.$id})&&r.push({id:n.$id,xpath:t.getXpathTo(e),watchCount:n.$$watchersCount,listenerCount:t.calculateScopeListenerCount(n),listenerSummary:t.generateScopeListenerSummary(n)})}},[])},t.prototype.createScopeElementMap=function(){var e=this;return this.walkDomTree(document.documentElement,function(t,r){if(t&&angular.element(t).isolateScope){var n=angular.element(t).isolateScope()||angular.element(t).scope();n&&!r[n.$id]&&(r[n.$id]={id:n.$id,xpath:e.getXpathTo(t),watchCount:n.$$watchersCount})}},{})},t}(r(76).DOMTreeWalker);t.ScopeDOMWalker=o},76:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.prototype.getXpathTo=function(e,t,r){if(void 0===t&&(t=!0),t&&""!==e.id)return'id("'+e.id+'")';if(r&&r(e),e===document.body||e===document.documentElement)return e.tagName;var n=0;if(!e.parentElement)return this.getElementIdentifier(e);for(var o=e.parentElement.children,i=0;i<o.length;i++){var a=o[i];if(a===e)return this.getXpathTo(e.parentElement,t,r)+"/"+this.getElementIdentifier(e)+"["+(n+1)+"]";1===a.nodeType&&a.tagName===e.tagName&&n++}},e.prototype.getElementIdentifier=function(e){return e.tagName},e.prototype.walkDomTree=function(e,t,r){void 0===r&&(r=[]);var n=r,o=[e];do{var i=o.pop();t(i,n),_.forEach(i.children,function(e){o.push(e)})}while(o.length>0);return n},e}();t.DOMTreeWalker=n}},[1638]);
//# sourceMappingURL=https://statics.teams.microsoft.com/hashedjs/lazy-ng1-mod-perf-dashboard-services.min.js-5fd6dc9f.map