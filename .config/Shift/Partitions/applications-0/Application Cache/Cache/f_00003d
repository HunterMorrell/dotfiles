webpackJsonp([15],{1882:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n(1883),n(1885),n(1890)},1883:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(1884),i=function(){function e(e,t,n,a,i,s,r,o,p,l,c,d,g,h,u,m,y,f,A){this.$q=e,this.$timeout=t,this.$filter=n,this.$translate=a,this.constants=i,this.resources=s,this.appsService=r,this.appStateAdapter=o,this.dialogService=p,this.extensionManifestService=l,this.navigationService=c,this.loggingService=d,this.routeUtilityService=g,this.tooltipService=h,this.peopleSlugService=u,this.utilityService=f,this.eventingService=A,this.errorInfo="",this.currentIndex=0,this.isGuestUser=!1,this.fileSelectionTimeoutInMS=18e4,this.logger=d.newLogger("ChatAppsList"),this.uploadACustomApp=a.instant(s.strings.chats_apps_sideload_app_button_label),this.enableInstallChatAppsFromStore=m.valueAsBoolean(i.settings.names.enableInstallChatAppsFromStore),this.enableSideloadAppByZip=m.valueAsBoolean(i.settings.names.enableSideloadAppByZip),this.isGuestUser=y.isGuestUserType(),this.sortAppsList(),this.setFileSelecting(!1)}return e.$inject=["$q","$timeout","$filter","$translate","constants","resources","appsService","appStateAdapter","dialogService","extensionManifestService","navigationService","loggingService","routeUtilityService","tooltipService","peopleSlugService","settingsService","identityService","utilityService","eventingService"],e.prototype.onSideloadAppButtonClicked=function(){var e=this;this.setFileSelecting(!0),this.fileSelectionTimeoutPromise&&(this.$timeout.cancel(this.fileSelectionTimeoutPromise),this.fileSelectionTimeoutPromise=void 0),this.fileSelectionTimeoutPromise=this.$timeout(function(){e.dismissChatAppPopover()},this.fileSelectionTimeoutInMS)},e.prototype.manageApps=function(){this.dismissChatAppPopover(),this.chatId=this.getChatId(),this.navigationService.navigateToManageAppsInChat(this.chatId,"chat-apps-list")},e.prototype.openAppDetails=function(e){this.dismissChatAppPopover();var t=this.appItems[e];this.chatId=this.getChatId();var n={appID:t.id,intent:teamspace.components.AddAppDialogIntent.GroupChat,chatId:this.chatId,preselectChat:this.chatId,action:teamspace.components.AddAppDialogAction.View,autoNavigationOnDone:!0,source:"chat-apps-list"};this.dialogService.openLazyDialog(this.constants.lazyDialogs.addAppNew,this.constants.lazyModules.extensibilityDialogs,n)},e.prototype.atMentionBot=function(e){var t=this,n=this.appItems[e],a=this.logger.service.newScenario(this.constants.scenarios.extensibility.apps.chat.getGroupChatAppDefinition);this.dismissChatAppPopover(),this.appsService.getGroupChatAppDefinition(this.getChatId(),n.id,"chat-apps-list").then(function(e){if(e&&e.bots&&e.bots.length>0){var i={botProfile:{memberCount:0,accountEnabled:!0,displayName:n.name,mri:t.constants.bots.keyPrefix+e.bots[0].id,type:t.constants.atMentions.type.bot},type:t.constants.atMentions.type.bot};t.eventingService.$emit(t.constants.events.bots.insertBotAtMention,i)}a.stop()}).catch(function(e){a.fail({error:e})})},e.prototype.sideloadApp=function(e){var t=this;if(e){this.setFileSelecting(!1),this.fileSelectionTimeoutPromise&&(this.$timeout.cancel(this.fileSelectionTimeoutPromise),this.fileSelectionTimeoutPromise=void 0);var n=this.logger.service.newScenario(this.constants.scenarios.extensibility.apps.chat.processSideloadedManifest);this.loggingService.info("Processing uploaded app definition"),this.errorInfo=null,this.chatId=this.getChatId(),this.dismissChatAppPopover(),this.setAppIsUploading(!0);var a="",i=this.enableSideloadAppByZip?this.extensionManifestService.getZipStreamPromise(e):this.$q.resolve();this.$q.all([this.extensionManifestService.extractAppDefinition(e,this.enableSideloadAppByZip),this.appsService.getInstalledAppsForGroupChat(this.chatId),i]).then(function(e){var n=e[0],i=e[1],s=e[2];a=n.name;for(var r=0;r<i.length;r++){var o=i[r];if(teamspace.services.AppsServiceUtils.isAppInstalled(o)&&n.externalId===o.appDefinition.externalId)return n.id=o.appDefinition.id,t.enableSideloadAppByZip?t.appsService.updateGroupChatAppDefinitionFromZip(t.chatId,o.appDefinition.id,s):t.appsService.updateGroupChatAppDefinition(t.chatId,n)}return t.enableSideloadAppByZip?t.appsService.createGroupChatAppDefinitionFromZip(t.chatId,s):t.appsService.createGroupChatAppDefinition(t.chatId,n)}).then(function(){n.stop(),t.showBanner(t.$translate.instant(t.resources.strings.chats_apps_sideload_app_installtion_banner,{name:a}),"chat-add-app")}).catch(function(e){e.type===t.constants.extensibility.apps.errorCodes.manifestError?(n.cancel({error:e.errors}),t.handleError(e.errors,"Failed to validate app manifest")):e.data&&e.data.errorCode===t.constants.extensibility.apps.errorCodes.unableToParseTeamsAppManifest?(n.cancel({error:e}),t.handleManifestParseError(e.data.message)):(n.fail({error:e}),t.handleError(e,"Failed to upload app package"))}).finally(function(){n.stop(),t.buildAppsList(),t.setAppIsUploading(!1)})}},e.prototype.deleteApp=function(e,t){var n=this,a=this.appItems[t];if(a){var i={closeButtonText:this.$translate.instant(this.resources.strings.extension_uninstallConfirmCloseText),okButtonText:this.$translate.instant(this.resources.strings.extension_uninstallConfirmOkText),confirmMessageTitle:this.$translate.instant(this.resources.strings.extension_uninstallConfirmTitle,{name:a.name}),confirmMessageHtmlBody:this.$translate.instant(this.resources.strings.extension_uninstallConfirmMessage,{name:a.name}),clickSilent:!0,callback:function(){var e=n.logger.service.newScenario(n.constants.scenarios.extensibility.apps.chat.deleteAppFromChatScenario);n.logger.info("Starting deletion of app definition"),n.errorInfo=null,n.setAppIsDeleting(!0),n.appItems.splice(t,1),n.chatId=n.getChatId(),n.appsService.deleteGroupChatAppEntitlement(n.chatId,a.id).then(function(){e.stop(),n.showBanner(n.$translate.instant(n.resources.strings.chats_apps_sideload_app_remove_banner,{name:a.name}),"chat-remove-app")}).catch(function(t){n.buildAppsList(),e.fail(),t&&t.type===n.constants.extensibility.apps.errorCodes.amsError?n.handleError(t,"Failed to remove image from ams, appId: "+a.id):n.handleError(t,"Failed to uninstall app, appId: "+a.id)}).finally(function(){e.stop(),n.setAppIsDeleting(!1)})}};this.dialogService.open(this.constants.dialogs.confirmDialog,i)}},e.prototype.handleError=function(e,t){var n=t+". Error: ";"string"==typeof e?(n+=e,this.errorInfo=this.$translate.instant(this.resources.strings.chats_apps_sideload_app_manifest_error)):(n+=JSON.stringify(e),this.errorInfo=this.$translate.instant(this.resources.strings.chats_apps_sideload_app_error)),this.showBanner(this.errorInfo,"chat-sideload-app_error"),this.logger.error(n)},e.prototype.handleManifestParseError=function(e){this.dialogService.openLazyDialog(this.constants.lazyDialogs.manifestError,this.constants.lazyModules.extensibilityDialogs,{errorMessage:this.$translate.instant(this.resources.strings.extension_addAppDialogManifestParsingErrorMessage),errorDetails:e})},e.prototype.dismissChatAppPopover=function(){this.tooltipService.clearTooltip(teamspace.services.TooltipType.Popover,"chat-apps-popover")},e.prototype.handleKeyDown=function(e){e.which===this.constants.keyCodes.down?(e.preventDefault(),this.currentIndex=this.currentIndex>=this.appItems.length?0:this.currentIndex+1):e.which===this.constants.keyCodes.up&&(e.preventDefault(),this.currentIndex=this.currentIndex>0?this.currentIndex-1:this.appItems.length)},e.prototype.hoverRow=function(e){this.currentIndex=e},e.prototype.buildAppsList=function(){var e=this;this.setAppIsLoading(!0),this.getChatAppsFromAppsService().then(function(t){e.appItems=t,e.sortAppsList(),e.setAppItemsChange(t)}).catch(function(t){e.handleError(t,"Failed to get the apps list")}).finally(function(){e.setAppIsLoading(!1)})},e.prototype.sortAppsList=function(){this.appItems=this.$filter("orderBy")(this.appItems,"name")},e.prototype.getChatAppsFromAppsService=function(){var e=this;return this.chatId=this.getChatId(),this.appsService.getInstalledAppsForGroupChat(this.chatId).then(function(t){if(!t||t.length<1)return[];for(var n=[],a=0;a<t.length;a++){var i=t[a];if(teamspace.services.AppsServiceUtils.isAppInstalled(i)&&!teamspace.services.AppsServiceUtils.isAppPermanent(i)){var s=i.appDefinition.name;e.appsService.isSideloadedApp(i.appDefinition)&&(s=e.$translate.instant(e.resources.strings.chats_apps_sideload_app_name,{name:s})),n.push({id:i.appDefinition.id,name:s,description:i.appDefinition.longDescription,icon:i.appDefinition.largeImageUrl,smallIcon:i.appDefinition.smallImageUrl,accentColor:i.appDefinition.accentColor,hasBots:!!i.appDefinition.bots,hasTabs:!!i.appDefinition.galleryTabs,externalId:i.appDefinition.externalId})}}return n})},e.prototype.getChatId=function(){var e=this.routeUtilityService.getRootRouteParams();if(e.peopleSlug&&e.ctx===this.constants.navigation.context.chat){var t=this.peopleSlugService.resolve(e.peopleSlug);return t&&t.conversation&&t.conversation.id}return null},e.prototype.setAppItemsChange=function(e){this.onAppItemsChange&&this.onAppItemsChange({apps:e})},e.prototype.setFileSelecting=function(e){this.onFileSelecting&&this.onFileSelecting({isSelecting:e})},e.prototype.setAppIsUploading=function(e){this.onAppUploading&&this.onAppUploading({isUploading:e})},e.prototype.setAppIsDeleting=function(e){this.onAppDeleting&&this.onAppDeleting({isDeleting:e})},e.prototype.setAppIsLoading=function(e){this.onAppLoading&&this.onAppLoading({isLoading:e})},e.prototype.showBanner=function(e,t){this.appStateAdapter.mainNotificationBannerStore.showBanner(teamspace.services.Severity.Warning,e,t,{countdownInSeconds:2.5,autoHideTimer:2.5})},e}();t.ChatAppsListController=i,angular.module("teamspace.chatAppsList",[]).directive("chatAppsList",function(){return{restrict:"E",scope:{},bindToController:{appItems:"=",onAppItemsChange:"&",onAppUploading:"&",onAppDeleting:"&",onAppLoading:"&",onFileSelecting:"&"},templateUrl:"components/extensibility/chat-apps-list/chat-apps-list.html",controller:i,controllerAs:"chatAppsList"}}).run(["$templateCache",function(e){e.put("components/extensibility/chat-apps-list/chat-apps-list.html",a)}])},1884:function(e,t){e.exports='<nav class="chat-apps-list" acc-role="dialog">\n  <div class="simple-scrollbar" ng-if="chatAppsList.appItems && chatAppsList.appItems.length > 0" simple-scrollbar>\n    <ul class="chat-apps" acc-role="menu">\n      <li ng-repeat="app in chatAppsList.appItems track by $index" acc-role="menu-item focus-default" class="app-item">\n        <a class="ts-sym app-button" ng-click="chatAppsList.enableInstallChatAppsFromStore && chatAppsList.atMentionBot($index)" ng-class="{ \'ts-selectedRow\': $index == chatAppsList.currentIndex}" ng-keydown="chatAppsList.handleKeyDown($event)" ng-mouseenter="chatAppsList.hoverRow($index)" track-gesture="{{::$root.trackConstants.trackGesture.click}}" track-scenario="{{::$root.trackConstants.trackScenario.navBotHeader}}" track-scenario-type="{{::$root.trackConstants.trackScenarioType.appDetails}}" track-outcome="{{::$root.trackConstants.trackOutcome.atMention}}" track-name="{{::$root.trackConstants.trackModuleName.chatBotHeader}}" track-type="{{::$root.trackConstants.trackType.chatBotHeader}}" track-summary="Chat Header bot list">\n          <ng-include class="app-icon" src="app.icon" ng-if="::chatAppsList.utilityService.useNgIncludeForIcon(app.icon)"></ng-include>\n          <img class="app-icon" ng-src="{{::app.icon}}" ng-if="::!chatAppsList.utilityService.useNgIncludeForIcon(app.icon)"/>\n          <span class="app-name single-line-truncation" title="{{app.name}}">{{app.name}}</span>\n          <button class="ts-sym show-icon-on-hover" ng-if="::(!chatAppsList.enableInstallChatAppsFromStore && !chatAppsList.isGuestUser)" ng-click="chatAppsList.deleteApp($event, $index)" space-action>\n            <ng-include src="\'svg/icons-delete.html\'"></ng-include>\n          </button>\n        </a>\n      </li>\n      <li class="chat-sideload-apps" ng-if="::(!chatAppsList.enableInstallChatAppsFromStore && !chatAppsList.isGuestUser)">\n        <button class="ts-sym chat-sideload-apps-button" acc-role="menu-item focus-default" ngf-select="chatAppsList.sideloadApp($file)" ng-model="chatAppsList.file" ngf-pattern="\'.zip\'" ngf-accept="\'.zip\'" track-click-silent="true" ng-click="chatAppsList.onSideloadAppButtonClicked()" data-tid="td-sideload-app" ng-mouseenter="chatAppsList.hoverRow(-1)" ng-keydown="chatAppsList.handleKeyDown($event)">\n          <ng-include src="\'svg/icons-files-upload.html\'"></ng-include>\n          <span class="chat-sideload-apps-text" ng-bind="::chatAppsList.uploadACustomApp"></span>\n        </button>\n      </li>\n      <li class="chat-sideload-apps" ng-if="::chatAppsList.enableInstallChatAppsFromStore" acc-role="menu-item focus-default">\n        <button class="ts-sym chat-sideload-apps-button" ng-click="chatAppsList.manageApps()" ng-mouseenter="chatAppsList.hoverRow(-1)" ng-keydown="chatAppsList.handleKeyDown($event)" track-gesture="{{::$root.trackConstants.trackGesture.click}}" track-scenario="{{::$root.trackConstants.trackScenario.manageApps}}" track-scenario-type="{{::$root.trackConstants.trackScenarioType.appSettings}}" track-outcome="{{::$root.trackConstants.trackOutcome.nav}}" track-name="{{::$root.trackConstants.trackModuleName.chatBotHeader}}" track-type="{{::$root.trackConstants.trackType.chatBotHeader}}" track-summary="Chat header manage apps">\n          <ng-include src="\'svg/icons-settings.html\'"></ng-include>\n          <span class="chat-sideload-apps-text" ng-bind="::$root.resources.strings.chat_see_all_apps | translate"></span>\n        </button>\n      </li>\n    </ul>\n  </div>\n</nav>'},1885:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(1886),i=n(1887),s=n(1888),r=n(1889),o="Personal",p="All",l="Bots",c="Tabs",d="Connectors",g="TopPicks",h="TenantApps",u="InputExtensions",m="Installed",y=250,f="https://statics.teams.microsoft.com/evergreen-assets/apps/teams_dev_app_largeimage.png?v=0.1",A={AnalyticsBI:"extensibility_apps_store_category_merged_analyticsbi",HumanResource:"extensibility_apps_store_category_merged_hr",DeveloperIT:"extensibility_apps_store_category_merged_developerit",Education:"extensibility_apps_store_category_merged_education",SocialFun:"extensibility_apps_store_category_merged_socialfun",Productivity:"extensibility_apps_store_category_merged_productivity",SalesSupport:"extensibility_apps_store_category_merged_salessupport",ProjectManagement:"extensibility_apps_store_category_merged_projectmanagement"},v={AnalyticsBI:["Analytics","DataVisualizationAndBI"],HumanResource:["HumanResourcesAndRecruiting"],DeveloperIT:["DeveloperTools","ITAdmin"],Education:["Education"],SocialFun:["ImageAndVideoGalleries","Lifestyle","NewsAndWeather","Social","TravelAndNavigation"],Productivity:["ContentManagement","FilesAndDocuments","Productivity","TrainingAndTutorial","Utilities","Microsoft"],SalesSupport:["CustomerAndContactManagement","CustomerSupport","FinancialManagement","SalesAndMarketing"],ProjectManagement:["Communication","ProjectManagement","WorkflowAndBusinessManagement"]},b=function(){function e(t,n,a,i,s,r,f,v,b,S,I,C,x,T,k,D,M,P,w,E,G,B,F,L,U,N,O,R,H){var V=this;if(this.$q=t,this.constants=n,this.appStateService=a,this.utilityService=i,this.appsService=s,this.ariaLiveService=r,this.loggingService=v,this.$timeout=b,this.$translate=S,this.resources=I,this.$scope=C,this.helpService=x,this.dialogService=k,this.eventingService=D,this.analyticsService=M,this.extensionManifestService=P,this.deepLinkProvider=w,this.settingsService=E,this.tooltipService=L,this.identityService=U,this.tooltipCssApplicators=N,this.filesAsyncMediaService=O,this.appStateAdapter=R,this.searchString="",this.errorInfo="",this.isLoading=!0,this.categories=[],this.types=[],this.selectedType=p,this.bannerViewModel={},this.userCanManageTenantApps=!1,this.networkError=!1,this.offlineImage="svg/app_offline.html",this.bannerImages={},this.allApps=[],this.appDefinitions=[],this.featuredAppDefinitions=[],this.appGalleryLeftRailPersonalAppDefinitions=[],this.featuredAppsImageInfo=[],this.appSortingRule=E.valueFor(n.settings.names.appSortingRule),this.showInputExtensionCategory=E.valueAsBoolean(n.settings.names.enableComposeExtensionInAppGallery),this.categoryMapping=A,this.uploadACustomApp=S.instant(I.strings.extensibility_apps_gallery_sideload_app),this.enableTenantOwnedApps=E.valueAsBoolean(n.settings.names.enableTenantOwnedApps),this.enableAppsGalleryAppSharing=E.valueAsBoolean(n.settings.names.enableAppsGalleryAppSharing),this.enableJITTenantAdminLookup=E.valueAsBoolean(n.settings.names.enableJITTenantAdminLookup),this.enableServiceAdminTenantAppManagement=E.valueAsBoolean(n.settings.names.enableServiceAdminTenantAppManagement),this.enableSideloadAppByZip=E.valueAsBoolean(n.settings.names.enableSideloadAppByZip),this.uploadATenantApp=S.instant(I.strings.extensibility_apps_gallery_upload_option_tenant),this.appFallbackIcon=n.fallbackImages.appFallbackImage,E.valueAsBoolean(n.settings.names.enableSideloadingEnforcement)){var z;E.valueAsBoolean(n.settings.names.runningscenariotests)||(z=v.newScenario(n.scenarios.extensibility.apps.gallery.toggleSideloadEntrypoint)),s.getUserAppPolicy("apps gallery").then(function(e){V.sideloadEnabled=!(!e||!e.isSideloadingAllowed)&&e.isSideloadingAllowed,z&&z.stop({sideloadingAllowedByPolicy:e&&void 0!=e.isSideloadingAllowed?e.isSideloadingAllowed:void 0,sideloadingEntrypointIsVisible:V.sideloadEnabled})}).catch(function(e){V.sideloadEnabled=!1,z&&z.fail({sideloadingEntrypointIsVisible:V.sideloadEnabled,error:e,error1:e})})}else this.sideloadEnabled=G.getSettingValue(SkypeX.Services.TenantSettingsStorageKey.isSideLoadedAppsEnabled);this.imageStripe=$("#img-container"),this.leftIcon=$(".left.carousel-control"),this.rightIcon=$(".right.carousel-control"),this.leftIcon.css("visibility","hidden"),this.banner=$("#td-app-gallery-top"),this.categories.push({value:p,text:S.instant(I.strings.extensibility_apps_gallery_all_apps),title:S.instant(I.strings.extensibility_apps_gallery_all_apps)}),this.categories.push({value:o,text:S.instant(I.strings.extensibility_apps_gallery_personal_apps),title:S.instant(I.strings.extensibility_apps_gallery_personal_apps)}),this.categories.push({value:l,text:S.instant(I.strings.extensibility_apps_gallery_bots_option),title:S.instant(I.strings.extensibility_apps_gallery_title_bots_option)}),this.categories.push({value:c,text:S.instant(I.strings.extensibility_apps_gallery_tabs_option),title:S.instant(I.strings.extensibility_apps_gallery_title_tabs_option)}),this.categories.push({value:d,text:S.instant(I.strings.extensibility_apps_gallery_connectors_option),title:S.instant(I.strings.extensibility_apps_gallery_title_connectors_option)}),this.showInputExtensionCategory&&this.categories.push({value:u,text:S.instant(I.strings.extensibility_apps_messaging_option),title:S.instant(I.strings.extensibility_apps_messaging_option)}),this.dialogTitle=I.strings.extensibility_apps_gallery_title_new,this.intent=this.params.intent?parseInt(this.params.intent):this.intent,this.preselectTeam=this.params.preselectTeam,this.autoNavigationOnDone="true"===this.params.autoNavigationOnDone,this.category=parseInt(this.params.category),this.preselectChat=this.intent===teamspace.components.AddAppDialogIntent.GroupChat?this.params.threadId:void 0,this.selectedType=teamspace.services.AppsServiceCategoryFilter[parseInt(this.params.category)],this.galleryCategory="true"===this.params.filterByPersonal?o:teamspace.services.AppsServiceCategoryFilter[parseInt(this.params.category)];var q=_.find(this.categories,function(e){return e.value===V.galleryCategory});q&&(this.rightRailRegionLabel=q.text),this.storeLaunchFromChat=this.params&&"true"===this.params.storeLaunchFromChat,this.bannerViewModel.apps=[],this.getAppRankMapPromise=this.appSortingRule?s.getAppStoreRankMap():t.resolve({});var j=f.getBannerAppsForStore().then(function(e){return e&&e.length?V.bannerViewModel.apps=e:V.bannerViewModel.apps=E.valueFor(n.settings.names.appsGalleryBannerApps),V.bannerViewModel.apps});this.skipInstalledSuccess="true"===this.params.skipInstalledSuccess,this.disableSelectCategory=this.category!==teamspace.services.AppsServiceCategoryFilter.All,this.isUserOrAmbiguous=this.intent===teamspace.components.AddAppDialogIntent.User||this.intent===teamspace.components.AddAppDialogIntent.Ambiguous,this.addAppDialogEntryPoint=this.params&&this.params.addAppDialogEntryPoint&&parseInt(this.params.addAppDialogEntryPoint),this.hasInstalledFilter=this.intent!==teamspace.components.AddAppDialogIntent.Ambiguous,this.hasInstalledFilter&&this.types.push({value:m,text:S.instant(I.strings.extensibility_apps_gallery_installed),title:S.instant(I.strings.extensibility_apps_gallery_installed)}),this.categoryIndexToAddSpace=this.categories.length,this.messageId=this.params.returnMessageId;var Z=this.preselectChannel=this.params.threadId;Z&&this.intent===teamspace.components.AddAppDialogIntent.Team?(this.teamAndChannelPromise=T.resolveTeamAndChannel(Z).then(function(e){V.teamName=e.team&&e.team.displayName}),this.teamId=T.getChannelByObjectId(Z)?T.getChannelByObjectId(Z).parentTeamId:void 0,this.preselectTeam=this.teamId):this.teamAndChannelPromise=t.resolve(),this.categories.push({value:g,text:S.instant(I.strings.extensibility_apps_gallery_featured_option),title:S.instant(I.strings.extensibility_apps_gallery_title_featured_option),hasTopPadding:!0,isHidden:!0});var W=v.newScenario(n.scenarios.extensibility.apps.gallery.view),J=v.newScenario(n.scenarios.extensibility.apps.gallery.render);this.getAppsPromiseOptions={category:teamspace.services.AppsServiceCategoryFilter.All},this.getInstalledAppsPromise=this.teamId?s.getInstalledAppsForTeam(this.teamId,this.getAppsPromiseOptions):s.getInstalledAppsForUser(this.getAppsPromiseOptions),this.getAppsPromise=this.teamId?s.getTeamAppDefinitions(this.teamId,"td-apps-gallery",this.getAppsPromiseOptions):s.getUserAppDefinitions("td-apps-gallery",this.getAppsPromiseOptions),t.all([this.getAppsPromise,this.getExtensionGalleryItems(this.category,this.galleryCategory),this.getInstalledAppsPromise]).then(function(a){for(var i=V.getCategorySet(a[0]),s=0;s<i.length;s++){var r=i[s];V.categories.push({value:r,text:S.instant(I.strings[V.categoryMapping[r]]),title:S.instant(I.strings[V.categoryMapping[r]])})}if(V.enableTenantOwnedApps){var l=v.newScenario(n.scenarios.extensibility.apps.gallery.loadLOBApps);t.all([F.getTenants(),B.getUserInformation()]).then(function(e){V.currentTenant=_.find(e[0],function(t){return t.tenantId===e[1].profile.tid}),V.currentTenant&&(V.uploadATenantApp=S.instant(I.strings.extensibility_apps_gallery_upload_option_tenant_with_name,{tenantName:V.currentTenant.tenantName})),_.some(a[0],function(e){return!_.isEmpty(e.tenantId)})&&(V.categories=V.categories.slice(0,V.categoryIndexToAddSpace).concat([{value:h,text:V.currentTenant?V.currentTenant.tenantName:S.instant(I.strings.extensibility_apps_gallery_tenantapps_option),title:V.currentTenant?V.currentTenant.tenantName:S.instant(I.strings.extensibility_apps_gallery_tenantapps_option),hasTopPadding:!0}],V.categories.slice(V.categoryIndexToAddSpace)))}).catch(function(e){v.error("Failed to resolve LOB apps: "+e),l.fail({error:e,error1:e})}).finally(function(){l.stop()})}var c=a[0],d=a[2];j.then(function(e){_.forEach(e,function(e){var t=_.find(c,function(t){return t.id.toLowerCase()===e.id.toLowerCase()}),a=t&&d?d.find(function(e){return e.appDefinition.id.toLowerCase()===t.id}):void 0;t&&(e.name=t.name,V.featuredAppsImageInfo.push({name:t.name,id:e.id,src:e.src}),V.featuredAppDefinitions.push({id:t.id,name:t.name,description:t.longDescription,developerName:t.developerName,icon:t.largeImageUrl,accentColor:t.accentColor,isInstalled:!!a&&teamspace.services.AppsServiceUtils.isAppInstalled(a),version:t.version,bots:t.bots,galleryTabs:t.galleryTabs,inputExtensions:t.inputExtensions,connectors:t.connectors,category:t.categories&&t.categories[0]?S.instant(I.strings[n.extensibility.store.AppStoreCategoryStringMapping[t.categories[0]]]):""}))}),V.featuredAppDefinitions.length&&(_.find(V.categories,function(e){return e.value===g}).isHidden=!1),V.updateBanner()});var u=E.valueFor(n.settings.names.appGalleryLeftRailPersonalApps);_.forEach(u,function(e){var t=_.find(c,function(t){return t.id.toLowerCase()===e.id.toLowerCase()}),a=t&&d?d.find(function(e){return e.appDefinition.id.toLowerCase()===t.id}):void 0;t&&V.appGalleryLeftRailPersonalAppDefinitions.push({id:t.id,name:t.name,description:t.longDescription,developerName:t.developerName,icon:t.largeImageUrl,accentColor:t.accentColor,isInstalled:!!a&&teamspace.services.AppsServiceUtils.isAppInstalled(a),version:t.version,bots:t.bots,galleryTabs:t.galleryTabs,inputExtensions:t.inputExtensions,connectors:t.connectors,category:t.categories&&t.categories[0]?S.instant(I.strings[n.extensibility.store.AppStoreCategoryStringMapping[t.categories[0]]]):""})}),_.isEmpty(V.appGalleryLeftRailPersonalAppDefinitions)&&(_.remove(V.categories,function(e){return e.value===o}),V.categoryIndexToAddSpace=V.categoryIndexToAddSpace-1,V.galleryCategory===o&&(V.galleryCategory=p)),b(function(){V.searchBox=document.getElementById("app-search-input"),V.searchBox&&V.searchBox.focus(),J.stop({numberOfApps:V.appDefinitions?V.appDefinitions.length:"null",isFirstTimeRender:e.isFirstTimeVisit}),e.isFirstTimeVisit=!1,H.showPerfIndicators&&D.$emit(n.events.app.galleryReady)})}).catch(function(e){a.isOnline||(V.networkError=!0),W.fail({error:e,error1:e}),J.fail({error:e,error1:e}),V.errorInfo="string"==typeof e?e:S.instant(I.strings.td_apps_gallery_error),V.showErrorInfoBanner(V.errorInfo)}).finally(function(){V.updateBanner(),V.isLoading=!1,V.handleEdgeCasesAndArrows(),V.featuredAppsImageInfo&&0!=V.featuredAppsImageInfo.length||(V.banner.css("height","0"),V.rightIcon.css("visibility","hidden")),V.filterByPersonal(),W.stop({numberOfApps:V.appDefinitions?V.appDefinitions.length:"null"})}),C.$on("$destroy",function(e){D.$emit(n.events.app.installed,{result:{installSucceeded:!1}}),W.cancel(),J.cancel(),V.filterBySearchDebounce&&V.filterBySearchDebounce.cancel()}),this.enableTenantOwnedApps&&this.determineTenantAppsAdminStatus(),this.showManageAppButton=this.enableTenantOwnedApps&&this.userCanManageTenantApps&&this.galleryCategory==h,this.showManageAppMenu=this.enableAppsGalleryAppSharing||!this.enableAppsGalleryAppSharing&&this.showManageAppButton,this.filterBySearchDebounce=_.debounce(function(){return V.filterBySearchFunction()},y)}return e.$inject=["$q","constants","appStateService","utilityService","appsService","ariaLiveService","cmsService","loggingService","$timeout","$translate","resources","$scope","helpService","channelService","dialogService","eventingService","analyticsService","extensionManifestService","deepLinkProvider","settingsService","tenantSettingsStore","authenticationService","tenantService","tooltipService","identityService","tooltipCssApplicators","filesAsyncMediaService","appStateAdapter","layoutService"],e.prototype.sideloadApp=function(e){var t=this;if(e){this.dismissUploadAppPopover();var n=this.loggingService.newScenario(this.constants.scenarios.extensibility.apps.gallery.processSideloadedManifest);this.loggingService.info("Processing uploaded app definition"),this.errorInfo=null,this.extensionManifestService.extractAppDefinition(e,!0).then(function(n){var a={appDefinitionSideloaded:{appDefinition:n},intent:t.intent,teamId:t.teamId,teamName:t.teamName,chatId:t.preselectChat,autoNavigationOnDone:t.autoNavigationOnDone,viewOnly:!1,skipInstalledSuccess:t.skipInstalledSuccess,preselectTeam:t.preselectTeam,preselectChannel:t.preselectChannel,preselectChat:t.preselectChat,category:t.galleryCategory,storeLaunchFromChat:t.storeLaunchFromChat,file:e,source:"td-apps-gallery-sideload"},i={entryPoint:teamspace.components.AddAppDialogEntryPoint.StoreSideload,manifestZipFile:e};return t.dialogService.openLazyDialog(t.constants.lazyDialogs.addAppNew,t.constants.lazyModules.extensibilityDialogs,Object.assign(a,i)),t.$q.resolve(null)}).then(function(){n.stop()}).catch(function(e){n.fail({error:e,error1:e}),t.handleError(e,"Failed extract app definition")})}},e.prototype.uploadTenantApp=function(e){var t=this;if(e){this.errorInfo=null,this.isUploading=!0,this.updateManageAppMenuAndButton(),this.dismissUploadAppPopover();var n=this.loggingService.newScenario(this.constants.scenarios.extensibility.apps.gallery.uploadTenantApp);this.extensionManifestService.extractAppDefinition(e,!0).then(function(a){return n.mark(t.constants.scenarios.extensibility.apps.gallery.extractTenantAppDefinitionStep,{appId:a.id,externalId:a.externalId,tenantId:t.currentTenant&&t.currentTenant.tenantId}),t.appDefinitions.some(function(e){return e.externalId===a.externalId&&e.isTenantApp})?(t.handleError(t.$translate.instant(t.resources.strings.apps_gallery_errorDialog_reupload_error),"Tenant app definition already exists"),n.stop({appId:a.id,externalId:a.externalId,tenantId:t.currentTenant&&t.currentTenant.tenantId}),t.$q.reject({type:t.constants.extensibility.apps.errorCodes.handledError})):(a.id=a.externalId,t.enableSideloadAppByZip?t.extensionManifestService.getZipStreamPromise(e).then(function(e){return t.appsService.createTenantAppDefinitionFromZip(e,t.teamId)}):t.uploadTenantAppIcon(a).then(function(e){return e&&e.smallImageUrl&&e.largeImageUrl?(a.smallImageUrl=e.smallImageUrl,a.largeImageUrl=e.largeImageUrl,t.appsService.createTenantAppDefinition(a,t.teamId)):t.$q.reject("uploadTenantApp: Invalid image urls")}))}).then(function(e){return n.mark(t.constants.scenarios.extensibility.apps.gallery.createTenantAppDefinitionStep,{appId:e.id,externalId:e.externalId,tenantId:t.currentTenant&&t.currentTenant.tenantId}),t.invalidateAppsCache(),t.categories.every(function(e){return e.value!==h})&&(t.categories=t.categories.slice(0,t.categoryIndexToAddSpace).concat([{value:h,text:t.currentTenant?t.currentTenant.tenantName:t.$translate.instant(t.resources.strings.extensibility_apps_gallery_tenantapps_option),title:t.currentTenant?t.currentTenant.tenantName:t.$translate.instant(t.resources.strings.extensibility_apps_gallery_tenantapps_option),hasTopPadding:!0}],t.categories.slice(t.categoryIndexToAddSpace))),t.galleryCategory===h?(t.appDefinitions.push(t.convertToGalleryViewAppViewModel(e,!1)),t.appDefinitions.sort(t.compare.bind(t)),t.$timeout(function(){t.setFocus(e.id)}),t.$q.resolve()):(t.appDefinitions=[],t.changeCategory(t.categories.find(function(e){return e.value===h})))}).catch(function(e){if(e.type)switch(e.type){case t.constants.extensibility.apps.errorCodes.handledError:return;case t.constants.extensibility.apps.errorCodes.manifestError:n.cancel({error:e,error1:e}),t.handleError(e,"Failed to validate tenant app manifest");break;case t.constants.extensibility.apps.errorCodes.iconError:n.fail({error:e,error1:e}),t.handleError(t.$translate.instant(t.resources.strings.apps_gallery_errorDialog_icon_error),"Failed to upload tenant app icons");break;default:n.fail({error:e,error1:e}),t.handleError(e,"Failed to upload tenant app package")}else e.data&&e.data.errorCode&&e.data.errorCode===t.constants.extensibility.apps.errorCodes.appDefinitionAlreadyExists?(n.cancel({error:e,error1:e}),t.handleError(t.$translate.instant(t.resources.strings.apps_gallery_errorDialog_reupload_error),"Tenant app definition already exists")):e.data&&e.data.errorCode===t.constants.extensibility.apps.errorCodes.unableToParseTeamsAppManifest?(n.cancel({error:e,error1:e}),t.handleManifestParseError(e.data.message)):(n.fail({error:e,error1:e}),t.handleError(e,"Failed to upload tenant app package"))}).finally(function(){t.isUploading=!1,t.updateManageAppMenuAndButton(),n.stop(),t.logUploadTenantAppAction()})}},e.prototype.updateTenantApp=function(e){var t=this;if(e){this.errorInfo=null,this.isUpdating=!0,this.dismissManageAppPopover();var n=this.loggingService.newScenario(this.constants.scenarios.extensibility.apps.gallery.updateTenantApp);this.extensionManifestService.extractAppDefinition(e,!0).then(function(a){n.mark(t.constants.scenarios.extensibility.apps.gallery.extractTenantAppDefinitionStep,{appId:a.id,externalId:a.externalId,tenantId:t.currentTenant&&t.currentTenant.tenantId});var i=t.appDefinitions.find(function(e){return e.id===t.selectedAppId});return angular.isUndefined(i)||i.externalId!==a.externalId?(t.handleError(t.$translate.instant(t.resources.strings.apps_gallery_errorDialog_manifest_id_mismatch),"App Id didn't match for tenant app update"),n.stop({appId:a.id,externalId:a.externalId,tenantId:t.currentTenant&&t.currentTenant.tenantId}),t.$q.reject({type:t.constants.extensibility.apps.errorCodes.handledError})):i.version===a.version?(t.handleError(t.$translate.instant(t.resources.strings.apps_gallery_errorDialog_manifest_version_error),"Same app version for tenant app update"),n.stop({appId:a.id,externalId:a.externalId,tenantId:t.currentTenant&&t.currentTenant.tenantId}),t.$q.reject({type:t.constants.extensibility.apps.errorCodes.handledError})):t.currentTenant?(a.id=t.selectedAppId,t.enableSideloadAppByZip?t.extensionManifestService.getZipStreamPromise(e).then(function(e){return t.appsService.updateTenantAppDefinitionFromZip(e,a,t.teamId)}):t.uploadTenantAppIcon(a).then(function(e){return a.smallImageUrl=e&&e.smallImageUrl?e.smallImageUrl:f,a.largeImageUrl=e&&e.largeImageUrl?e.largeImageUrl:f,t.appsService.updateTenantAppDefinition(a,t.teamId)})):t.$q.reject("Tenant information is not present")}).then(function(e){n.mark(t.constants.scenarios.extensibility.apps.gallery.updateTenantAppDefinitionStep,{appId:e.id,externalId:e.externalId,tenantId:t.currentTenant&&t.currentTenant.tenantId}),t.allApps=t.appDefinitions;var a=_.findIndex(t.allApps,function(t){return t.id===e.id});t.allApps.splice(a,1,t.convertToGalleryViewAppViewModel(e,!1)),t.appDefinitions=[],t.appDefinitions=t.allApps,t.$timeout(function(){t.setFocus(e.id)})}).catch(function(e){if(e.type)switch(e.type){case t.constants.extensibility.apps.errorCodes.handledError:return;case t.constants.extensibility.apps.errorCodes.manifestError:n.cancel({error:e,error1:e}),t.handleError(e,"Failed to validate tenant app manifest");break;case t.constants.extensibility.apps.errorCodes.iconError:n.fail({error:e,error1:e}),t.handleError(t.$translate.instant(t.resources.strings.apps_gallery_errorDialog_icon_error),"Failed to update tenant app icons");break;default:n.fail({error:e,error1:e}),t.handleError(e,"Failed to update tenant app package")}else e.data&&e.data.errorCode===t.constants.extensibility.apps.errorCodes.unableToParseTeamsAppManifest?(n.fail({error:e,error1:e}),t.handleManifestParseError(e.data.message)):(n.fail({error:e,error1:e}),t.handleError(e,"Failed to update tenant app package"))}).finally(function(){t.isUpdating=!1,n.stop(),t.logUpdateTenantAppAction()})}},e.prototype.deleteTenantApp=function(){var e=this,t=this.appDefinitions.find(function(t){return t.id===e.selectedAppId});this.errorInfo=null,this.currentTenant||this.handleError(this.$translate.instant(this.resources.strings.td_apps_tab_error),"Tenant information is not present. AppId:"+this.selectedAppId),this.dismissManageAppPopover();var n=this.loggingService.newScenario(this.constants.scenarios.extensibility.apps.gallery.deleteTenantApp),a={closeButtonText:this.$translate.instant(this.resources.strings.cancel),okButtonText:this.$translate.instant(this.resources.strings.app_deleteTeamButtonText),confirmMessageTitle:this.$translate.instant(this.resources.strings.app_delete_dialog_confirmation_text,{appName:t.name}),confirmMessageHtmlBody:this.$translate.instant(this.resources.strings.app_delete_dialog_confirmation_details,{appName:t.name,tenantName:this.currentTenant.tenantName}),showAffirmationAfterAction:!1,reconfirmMessage:this.$translate.instant(this.resources.strings.app_delete_dialog_reconfirmation_text),clickSilent:!0,callback:function(){e.isInlineDeleting=!0,e.appsService.deleteTenantAppDefinition(e.selectedAppId,e.teamId).then(function(){return _.remove(e.appDefinitions,function(t){return t.id===e.selectedAppId}),e.isInlineDeleting=!1,e.invalidateAppsCache(),e.appDefinitions.every(function(e){return!e.isTenantApp})?(_.remove(e.categories,function(e){return e.value===h}),e.isDeleting=!0,e.changeCategory(e.categories.find(function(e){return e.value===p}))):e.$q.resolve()}).catch(function(a){a&&a.type===e.constants.extensibility.apps.errorCodes.amsError?(n.fail({appId:t.id,externalId:t.externalId,tenantId:e.currentTenant&&e.currentTenant.tenantId,error:a,error1:a}),e.handleError(a,"Failed to remove image from ams, appId: "+e.selectedAppId)):(n.fail({appId:t.id,externalId:t.externalId,tenantId:e.currentTenant&&e.currentTenant.tenantId,error:a,error1:a}),e.handleError(a,"Failed to delete app, appId: "+e.selectedAppId))}).finally(function(){e.isInlineDeleting=!1,e.isDeleting=!1,n.stop({appId:t.id,externalId:t.externalId,tenantId:e.currentTenant&&e.currentTenant.tenantId}),e.logDeleteTenantAppAction(),e.$timeout(function(){e.setFocus()})})}};this.dialogService.open(this.constants.dialogs.confirmDialog,a)},e.prototype.uploadTenantAppIcon=function(e){var t=[];return this.isBase64(e.smallImageUrl)&&this.isBase64(e.largeImageUrl)?(t.push(this.uploadbase64Icon(e.smallImageUrl)),t.push(this.uploadbase64Icon(e.largeImageUrl)),this.$q.all(t).then(function(e){return{smallImageUrl:e[0],largeImageUrl:e[1]}})):this.$q.reject("uploadTenantAppIcon: Image urls are not base64")},e.prototype.isBase64=function(e){return e&&0===e.indexOf("data:")},e.prototype.uploadbase64Icon=function(e){var t=this;if(!this.currentTenant||!this.currentTenant.tenantId)return this.$q.reject("Tenant information is not present");var n=e.indexOf(",");if(n<0)return this.$q.reject({type:this.constants.extensibility.apps.errorCodes.iconError,error:"Icon format error"});for(var a=atob(e.substring(n+1)),i=a.length,s=new Uint8Array(new ArrayBuffer(i)),r=0;r<i;r++)s[r]=a.charCodeAt(r);if(a){var o={containerId:"*:tid:"+this.currentTenant.tenantId};return this.filesAsyncMediaService.uploadItem(o,s).then(function(e){return t.$q.resolve(e.fullsizeUrl)}).catch(function(e){return t.$q.reject({type:t.constants.extensibility.apps.errorCodes.amsError,error:"Icon upload error:"+JSON.stringify(e)})})}return this.$q.reject({type:this.constants.extensibility.apps.errorCodes.iconError,error:"Icon format error"})},e.prototype.invalidateAppsCache=function(){delete this.getAppsPromise,this.getAppsPromise=this.teamId?this.appsService.getTeamAppDefinitions(this.teamId,"td-apps-gallery",this.getAppsPromiseOptions):this.appsService.getUserAppDefinitions("td-apps-gallery",this.getAppsPromiseOptions)},e.prototype.handleError=function(e,t){var n=t+". Error: ";e.type===this.constants.extensibility.apps.errorCodes.manifestError?this.dialogService.openLazyDialog(this.constants.lazyDialogs.manifestError,this.constants.lazyModules.extensibilityDialogs,{errorMessage:e.errors}):"string"==typeof e?(n+=e,this.showErrorDialog(e)):(n+=JSON.stringify(e),this.errorInfo=this.$translate.instant(this.resources.strings.td_apps_tab_error),this.showErrorInfoBanner(this.errorInfo)),this.loggingService.error(n)},e.prototype.handleManifestParseError=function(e){this.dialogService.openLazyDialog(this.constants.lazyDialogs.manifestError,this.constants.lazyModules.extensibilityDialogs,{errorMessage:this.$translate.instant(this.resources.strings.extension_addAppDialogManifestParsingErrorMessage),errorDetails:e})},e.prototype.showErrorInfoBanner=function(e){null!=this.errorInfoBanner&&this.errorInfoBanner.hide(),this.errorInfoBanner=this.appStateAdapter.mainNotificationBannerStore.showBanner(teamspace.services.Severity.Warning,e,"banner_error_info",{autoHideTimer:10})},e.prototype.changeCategory=function(e,t){var n=this;if(!t||t.which===this.constants.keyCodes.enter){e&&(this.galleryCategory=e.value,this.rightRailRegionLabel=e.text,this.searchString="",this.updateManageAppMenuAndButton(),teamspace.services.AppsServiceCategoryFilter[this.galleryCategory]?this.category=teamspace.services.AppsServiceCategoryFilter[this.galleryCategory]:this.category=teamspace.services.AppsServiceCategoryFilter.All,this.updateBanner());var a=this.loggingService.newScenario(this.constants.scenarios.extensibility.apps.gallery.changeCategory);return this.allApps=[],this.getExtensionGalleryItems(this.category,this.galleryCategory).catch(function(e){a.fail({error:e,error1:e}),n.errorInfo="string"==typeof e?e:n.$translate.instant(n.resources.strings.td_apps_gallery_error),n.showErrorInfoBanner(n.errorInfo)}).finally(function(){n.galleryCategory===m||n.selectedType===m?n.appDefinitions=_.filter(n.appDefinitions,function(e){return e.isInstalled}):n.filterByPersonal(),n.isLoading=!1,a.stop(),n.logCategoryChangeAction(e),t&&t.which===n.constants.keyCodes.enter&&n.$timeout(function(){n.setFocus()})})}},e.prototype.changeType=function(e,t){var n=this;this.category=teamspace.services.AppsServiceCategoryFilter[e]?teamspace.services.AppsServiceCategoryFilter[e]:teamspace.services.AppsServiceCategoryFilter.All,this.updateBanner(),this.selectedType=e;var a=this.loggingService.newScenario(this.constants.scenarios.extensibility.apps.gallery.changeCategory);this.allApps=[],this.getExtensionGalleryItems(this.category,this.galleryCategory).catch(function(e){a.fail({error:e,error1:e}),n.errorInfo="string"==typeof e?e:n.$translate.instant(n.resources.strings.td_apps_gallery_error),n.showErrorInfoBanner(n.errorInfo)}).finally(function(){n.selectedType===m?n.appDefinitions=_.filter(n.appDefinitions,function(e){return e.isInstalled}):n.filterByPersonal(),n.isLoading=!1,a.stop()})},e.prototype.filterBySearch=function(){this.filterBySearchDebounce()},e.prototype.goToLearnMore=function(){this.helpService.gotoHelp("Articles-AppsAndServices/6c25661b-90f8-4b52-92b2-1fcd3e5d946c")},e.prototype.onFeaturedAppClicked=function(e){var t=_.find(this.featuredAppDefinitions,function(t){return t.id.toLowerCase()===e.toLowerCase()});t&&this.onAppClicked(t,!0)},e.prototype.onAppClicked=function(e,t){var n=this;this.eventingService.$once(this.$scope,this.constants.events.app.installed,function(t,a){var i=a.result;i&&i.installSucceeded&&(n.teamId?n.appsService.getInstalledAppForTeam(n.teamId,e.id):n.appsService.getInstalledAppForUser(e.id)).then(function(t){t.appDefinition.id===e.id&&(e.isInstalled=teamspace.services.AppsServiceUtils.isAppInstalled(t))})});var a,i={appID:e.id,intent:this.intent,teamId:this.teamId,chatId:this.preselectChat,messageId:this.messageId,teamName:this.teamName,autoNavigationOnDone:this.autoNavigationOnDone,action:teamspace.components.AddAppDialogAction.Install,skipInstalledSuccess:this.skipInstalledSuccess,preselectTeam:this.preselectTeam,preselectChannel:this.preselectChannel,preselectChat:this.preselectChat,category:this.galleryCategory,storeLaunchFromChat:this.storeLaunchFromChat,source:"td-apps-gallery"};switch(this.addAppDialogEntryPoint){case teamspace.components.AddAppDialogEntryPoint.InContextGalleryDialogMoreAppsFromChannel:a={entryPoint:this.addAppDialogEntryPoint,appId:e.id,teamId:this.teamId||this.preselectTeam,channelId:this.preselectChannel};break;case teamspace.components.AddAppDialogEntryPoint.InContextGalleryDialogMoreAppsFromGroupChat:a={entryPoint:this.addAppDialogEntryPoint,appId:e.id,chatId:this.preselectChat};break;case teamspace.components.AddAppDialogEntryPoint.Flyout:a={appId:e.id,entryPoint:this.addAppDialogEntryPoint};break;case teamspace.components.AddAppDialogEntryPoint.MessagingExtensionFlyoutFromChannel:a={entryPoint:this.addAppDialogEntryPoint,appId:e.id,teamId:this.teamId||this.preselectTeam,channelId:this.preselectChannel};break;case teamspace.components.AddAppDialogEntryPoint.MessagingExtensionFlyoutFromChat:a={entryPoint:this.addAppDialogEntryPoint,appId:e.id};break;case teamspace.components.AddAppDialogEntryPoint.AppsManagementTabFromTeam:a={entryPoint:this.addAppDialogEntryPoint,appId:e.id,teamId:this.teamId||this.preselectTeam};break;case teamspace.components.AddAppDialogEntryPoint.AppsManagementTabFromGroupChat:a={entryPoint:this.addAppDialogEntryPoint,appId:e.id,chatId:this.preselectChat};break;default:a={entryPoint:teamspace.components.AddAppDialogEntryPoint.Store,appId:e.id}}this.dialogService.openLazyDialog(this.constants.lazyDialogs.addAppNew,this.constants.lazyModules.extensibilityDialogs,Object.assign(i,a)),this.logAppClickAction(e,!0)},e.prototype.getTitleText=function(){var e=this,t=_.filter(this.categories,function(t){return t.value===e.galleryCategory});return t?t[0].title:""},e.prototype.getTypeDescription=function(e){switch(this.galleryCategory){case l:return"type"===e?this.$translate.instant(this.resources.strings.extensibility_apps_gallery_bots_option):this.$translate.instant(this.resources.strings.extensibility_apps_gallery_title_bots);case c:return"type"===e?this.$translate.instant(this.resources.strings.extensibility_apps_gallery_tabs_option):this.$translate.instant(this.resources.strings.extensibility_apps_gallery_title_tabs);case d:return"type"===e?this.$translate.instant(this.resources.strings.extensibility_apps_gallery_connectors_option):this.$translate.instant(this.resources.strings.extensibility_apps_gallery_title_connectors);case u:return"type"===e?this.$translate.instant(this.resources.strings.extensibility_apps_messaging_option):this.$translate.instant(this.resources.strings.extensibility_apps_gallery_title_messaging);case o:return"type"===e?this.$translate.instant(this.resources.strings.extensibility_consent_badge_personal_app):this.$translate.instant(this.resources.strings.extensibility_apps_gallery_title_personal);default:return""}},e.prototype.showUploadOptions=function(e){var t=this,n={templateUrl:"components/extensibility/td-apps-gallery/td-apps-gallery-upload-options.html",trigger:"manual",container:"td-apps-gallery",scope:this.$scope,autoClose:!1,placement:"auto bottom-right"},a={sourceElement:angular.element(e.currentTarget),tooltipType:teamspace.services.TooltipType.Popover,options:n,tooltipId:"upload-app-options",cssApplicator:function(){t.tooltipCssApplicators.contextMenu(e,"app-upload-menu",null,angular.element(e.currentTarget))}};e.stopPropagation(),this.tooltipService.toggleTooltip(a)},e.prototype.showManageAppOptions=function(e,t){var n=this;this.dismissManageAppPopover(e),this.selectedAppId=e;var a={templateUrl:"components/extensibility/td-apps-gallery/td-apps-gallery-manage-app-options.html",trigger:"manual",container:"td-apps-gallery",scope:this.$scope,autoClose:!1,placement:"auto bottom-right"},i="div[id='app-"+e+"-manageAppMenu']",s={sourceElement:angular.element(t.currentTarget),tooltipType:teamspace.services.TooltipType.Popover,options:a,tooltipId:"manage-app-options-"+e,cssApplicator:function(){n.tooltipCssApplicators.contextMenu(t,i,null,angular.element(t.currentTarget),-5,54)}};t.stopPropagation(),t.preventDefault(),this.tooltipService.toggleTooltip(s)},e.prototype.copyLinkToApp=function(e){var t=this,n="apps-gallery-"+this.selectedAppId,a=this.deepLinkProvider.getAppDeepLinkUrl(this.selectedAppId),i=this.appDefinitions.find(function(e){return e.id===t.selectedAppId}),s=this.utilityService.escapeHtml(i.name||a),r=teamspace.services.MessagingUtilities.getPrettyLink(s,a,"",!1),o={};o[teamspace.services.UtilityServiceStatics.ClipboardFormats.Text]=a,o[teamspace.services.UtilityServiceStatics.ClipboardFormats.Html]=r.innerHTML,this.utilityService.copyMultipleFormatsToClipboard(o);var p=angular.element(document.getElementById(n));if(p){var l=p.find(".icons-more");l&&this.tooltipService.showLinkCopiedTooltip(e,this.$scope,l,l,12)}},e.prototype.dismissUploadAppPopover=function(){this.tooltipService.clearTooltip(teamspace.services.TooltipType.Popover,"upload-app-options")},e.prototype.dismissManageAppPopover=function(e){e&&this.selectedAppId===e||this.tooltipService.clearTooltip(teamspace.services.TooltipType.Popover,"manage-app-options-"+this.selectedAppId)},e.prototype.filterBySearchFunction=function(){var e=this;if(this.updateManageAppMenuAndButton(),this.showNoResult=!1,""==this.searchString){this.allApps=[],this.getExtensionGalleryItems(this.category,this.galleryCategory).catch(function(t){e.errorInfo="string"==typeof t?t:e.$translate.instant(e.resources.strings.td_apps_gallery_error),e.showErrorInfoBanner(e.errorInfo)}).finally(function(){e.galleryCategory===m||e.selectedType===m?e.appDefinitions=_.filter(e.allApps,function(e){return e.isInstalled}):e.galleryCategory===o?e.appDefinitions=e.appGalleryLeftRailPersonalAppDefinitions:e.appDefinitions=e.allApps,0==e.appDefinitions.length&&(e.showNoResult=!0),e.isLoading=!1})}else{this.allApps=[],this.getExtensionGalleryItems(teamspace.services.AppsServiceCategoryFilter.All,p).catch(function(t){e.errorInfo="string"==typeof t?t:e.$translate.instant(e.resources.strings.td_apps_gallery_error),e.showErrorInfoBanner(e.errorInfo)}).finally(function(){var t=e.searchString.toLowerCase();e.appDefinitions=_.filter(e.appDefinitions,function(n){var a=n.name.toLowerCase(),i=n.developerName.toLowerCase(),s=n.description.toLowerCase(),r=a.contains(t)||i.contains(t)||s.contains(t);return e.galleryCategory===m||e.selectedType===m?r&&n.isInstalled:r}),0==e.appDefinitions.length&&(e.showNoResult=!0),e.announceSearchResultsChanged(e.appDefinitions.length),e.isLoading=!1})}this.logSearchAction(this.searchString)},e.prototype.appActionDisabled=function(){return this.isUploading||this.isUpdating||this.isDeleting||this.isInlineDeleting},e.prototype.updateManageAppMenuAndButton=function(){this.showManageAppButton=this.enableTenantOwnedApps&&!this.isUploading&&!this.searchString&&this.userCanManageTenantApps&&this.galleryCategory==h,this.showManageAppMenu=this.enableAppsGalleryAppSharing||!this.enableAppsGalleryAppSharing&&this.showManageAppButton},e.prototype.filterByPersonal=function(){this.galleryCategory===o&&(this.appDefinitions=this.appGalleryLeftRailPersonalAppDefinitions)},e.prototype.handleEdgeCasesAndArrows=function(){if($(".banner-image")[0]){this.bannerImageWidth||(this.bannerImageWidth=$(".banner-image")[0].clientWidth+18);var e=this.banner.scrollLeft();this.leftIcon.css("visibility","visible"),this.rightIcon.css("visibility","visible"),e<=0&&this.leftIcon.css("visibility","hidden"),e>=this.featuredAppsImageInfo.length*this.bannerImageWidth-18-this.banner.width()&&this.rightIcon.css("visibility","hidden")}},e.prototype.getExtensionGalleryItems=function(e,t){var n=this;return this.isLoading=!this.isUploading&&!this.isDeleting,this.teamAndChannelPromise.then(function(){return n.$q.all([n.getInstalledAppsPromise,n.getAppsPromise,n.getAppRankMapPromise]).then(function(a){n.appSortingRule&&(n.appRankMap=a[2]);var i=a[0],s=a[1];(s=teamspace.services.AppsServiceUtils.filterToStoreFrontApps(i,s)).forEach(function(a){var s=i?i.find(function(e){return e.appDefinition.id.toLowerCase()===a.id}):void 0;(t!==h||n.enableTenantOwnedApps&&!_.isEmpty(a.tenantId))&&(!n.categoryMapping[t]||!_.isEmpty(a.categories)&&n.isCategoryIncluded(a,t))&&(e===teamspace.services.AppsServiceCategoryFilter.All||n.passesCapabilityFilter(a,e))&&(t!==g||_.some(n.featuredAppDefinitions,function(e){return e.id===a.id}))&&("Other"!==t||_.isEmpty(a.categories)||a.categories.includes("Other")||n.appHasUnknownCategory(a))&&n.allApps.push(n.convertToGalleryViewAppViewModel(a,!!s&&teamspace.services.AppsServiceUtils.isAppInstalled(s)))}),n.allApps.sort(n.compare.bind(n)),n.appDefinitions=n.allApps})})},e.prototype.convertToGalleryViewAppViewModel=function(e,t){return{officeAssetId:e.officeAssetId,id:e.id,name:e.name,developerName:e.developerName,description:e.longDescription,icon:e.largeImageUrl,accentColor:e.accentColor,isInstalled:t,version:e.version,bots:e.bots,galleryTabs:e.galleryTabs,inputExtensions:e.inputExtensions,connectors:e.connectors,category:e.categories&&e.categories[0]?this.$translate.instant(this.resources.strings[this.constants.extensibility.store.AppStoreCategoryStringMapping[e.categories[0]]]):"",isTenantApp:!!e.tenantId,externalId:e.externalId,smallIcon:e.smallImageUrl}},e.prototype.isCategoryIncluded=function(e,t){return!_.isEmpty(_.intersection(e.categories,v[t]))},e.prototype.passesCapabilityFilter=function(e,t){return(t&teamspace.services.AppsServiceCategoryFilter.Bots)==teamspace.services.AppsServiceCategoryFilter.Bots&&e.bots&&e.bots.length>0||(t&teamspace.services.AppsServiceCategoryFilter.Tabs)==teamspace.services.AppsServiceCategoryFilter.Tabs&&e.galleryTabs&&e.galleryTabs.length>0||(t&teamspace.services.AppsServiceCategoryFilter.InputExtensions)==teamspace.services.AppsServiceCategoryFilter.InputExtensions&&e.inputExtensions&&e.inputExtensions.length>0||(t&teamspace.services.AppsServiceCategoryFilter.Connectors)==teamspace.services.AppsServiceCategoryFilter.Connectors&&e.connectors&&e.connectors.length>0},e.prototype.appHasUnknownCategory=function(e){var t=this;return _.some(e.categories,function(e){return t.constants.extensibility.store.AppStoreCategoryStringMapping[e]})},e.prototype.getCategorySet=function(e){var t=this,n=[];return e.forEach(function(e){_.isEmpty(e.categories)||e.categories.forEach(function(e){if(t.constants.extensibility.store.AppStoreCategoryStringMapping[e]){var a=_.findKey(v,function(t){return t.includes(e)});_.isUndefined(a)||n.push(a)}})}),(n=_.uniq(n)).sort()},e.prototype.compare=function(e,t){if(this.appRankMap&&this.appSortingRule===this.constants.extensibility.apps.appRanking.appSortingRuleInstall){var n=(this.appRankMap[t.id]?this.appRankMap[t.id].installRank:0)-(this.appRankMap[e.id]?this.appRankMap[e.id].installRank:0);return 0===n?e.name.toLocaleLowerCase()<t.name.toLocaleLowerCase()?-1:1:n}return e.name.toLocaleLowerCase()<t.name.toLocaleLowerCase()?-1:1},e.prototype.logAppClickAction=function(e,t){var n=this;_.defer(function(){var a={action:{gesture:teamspace.components.PanelActionGesture.click,outcome:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionOutcome.select.toString(),teamspace.components.PanelActionOutcome,n.loggingService),scenario:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionScenario.openAddAppDialog.toString(),teamspace.components.PanelActionScenario,n.loggingService),scenarioType:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionScenarioType.appMgmt.toString(),teamspace.components.PanelActionScenarioType,n.loggingService)},module:{name:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelModuleName.appsGalleryItem.toString(),teamspace.components.PanelModuleName,n.loggingService),type:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelModuleType.openDialog.toString(),teamspace.components.PanelModuleType,n.loggingService),summary:"Open app installation dialog for "+e.name,state:"Clicked"},dataBag:{isFeatured:!!t},app:{id:e.id,name:e.name,version:e.version,isTenantApp:e.isTenantApp,externalId:e.externalId}};e.bots&&e.bots.length>0&&(a.bot={id:e.bots[0].id,name:e.name}),n.sendPanelAction(a)})},e.prototype.logCategoryChangeAction=function(e){var t=this;_.defer(function(){var n={action:{gesture:teamspace.components.PanelActionGesture.click,outcome:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionOutcome.nav.toString(),teamspace.components.PanelActionOutcome,t.loggingService),scenario:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionScenario.changeAppGalleryCategory.toString(),teamspace.components.PanelActionScenario,t.loggingService),scenarioType:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionScenarioType.appMgmt.toString(),teamspace.components.PanelActionScenarioType,t.loggingService)},module:{name:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelModuleName.appsGalleryItem.toString(),teamspace.components.PanelModuleName,t.loggingService),type:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelModuleType.nav.toString(),teamspace.components.PanelModuleType,t.loggingService),summary:"Change category to "+(e?e.value:t.category.toString()),state:"Clicked"},dataBag:{category:e?e.value:t.category.toString()}};t.sendPanelAction(n)})},e.prototype.logUploadTenantAppAction=function(){var e=this;_.defer(function(){var t={action:{gesture:teamspace.components.PanelActionGesture.click,outcome:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionOutcome.upload.toString(),teamspace.components.PanelActionOutcome,e.loggingService),scenario:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionScenario.uploadTenantApp.toString(),teamspace.components.PanelActionScenario,e.loggingService),scenarioType:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionScenarioType.appMgmt.toString(),teamspace.components.PanelActionScenarioType,e.loggingService)},module:{name:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelModuleName.appsGalleryItem.toString(),teamspace.components.PanelModuleName,e.loggingService),type:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelModuleType.menuItem.toString(),teamspace.components.PanelModuleType,e.loggingService),summary:"Upload tenant app from app store"}};e.sendPanelAction(t)})},e.prototype.logUpdateTenantAppAction=function(){var e=this;_.defer(function(){var t={action:{gesture:teamspace.components.PanelActionGesture.click,outcome:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionOutcome.upload.toString(),teamspace.components.PanelActionOutcome,e.loggingService),scenario:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionScenario.updateTenantApp.toString(),teamspace.components.PanelActionScenario,e.loggingService),scenarioType:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionScenarioType.appMgmt.toString(),teamspace.components.PanelActionScenarioType,e.loggingService)},module:{name:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelModuleName.appsGalleryItem.toString(),teamspace.components.PanelModuleName,e.loggingService),type:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelModuleType.menuItem.toString(),teamspace.components.PanelModuleType,e.loggingService),summary:"Update tenant app from app store"}};e.sendPanelAction(t)})},e.prototype.logDeleteTenantAppAction=function(){var e=this;_.defer(function(){var t={action:{gesture:teamspace.components.PanelActionGesture.click,outcome:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionOutcome.submit.toString(),teamspace.components.PanelActionOutcome,e.loggingService),scenario:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionScenario.deleteTenantApp.toString(),teamspace.components.PanelActionScenario,e.loggingService),scenarioType:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionScenarioType.appMgmt.toString(),teamspace.components.PanelActionScenarioType,e.loggingService)},module:{name:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelModuleName.appsGalleryItem.toString(),teamspace.components.PanelModuleName,e.loggingService),type:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelModuleType.menuItem.toString(),teamspace.components.PanelModuleType,e.loggingService),summary:"Delete tenant app from app store"}};e.sendPanelAction(t)})},e.prototype.logSearchAction=function(e){var t=this;_.defer(function(){var n={action:{gesture:teamspace.components.PanelActionGesture.submit,outcome:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionOutcome.search.toString(),teamspace.components.PanelActionOutcome,t.loggingService),scenario:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionScenario.storeSearchApp.toString(),teamspace.components.PanelActionScenario,t.loggingService),scenarioType:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionScenarioType.appMgmt.toString(),teamspace.components.PanelActionScenarioType,t.loggingService)},module:{name:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelModuleName.appsGalleryItem.toString(),teamspace.components.PanelModuleName,t.loggingService),type:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelModuleType.search.toString(),teamspace.components.PanelModuleType,t.loggingService),state:e?"search":"clear search"}};t.sendPanelAction(n)})},e.prototype.sendPanelAction=function(e){var t=this;this.analyticsService.getAnalyticsPanelActionEventData(e).then(function(e){t.analyticsService.sendPanelAction(e)})},e.prototype.updateBanner=function(){var e=this,t=function(t,n,a,i,s,r){e.bannerViewModel.hideBanner=!1,e.bannerViewModel.title=e.$translate.instant(t),e.bannerViewModel.content=e.$translate.instant(n),e.bannerViewModel.imageSrc=a,e.bannerViewModel.learnMoreButtonTitle=e.$translate.instant(i),e.bannerViewModel.showLearnMoreButton=s||!1,e.bannerViewModel.learnMoreButtonClick=r||function(){return e.goToLearnMore()},e.bannerViewModel.onBannerAppClicked=function(t){return e.onFeaturedAppClicked(t)}};switch(_.isEmpty(this.bannerImages)&&(this.bannerImages=this.settingsService.valueFor(this.constants.settings.names.appsGalleryBannerImages)),this.galleryCategory){case p:t(this.resources.strings.extensibility_apps_gallery_banner_cat_all_apps_title,this.resources.strings.extensibility_apps_gallery_banner_cat_all_apps_content,this.bannerImages[p]||"",this.resources.strings.extensibility_apps_gallery_banner_btn_top_picks,!_.isEmpty(this.featuredAppDefinitions),function(){var t=_.find(e.categories,{value:g});t?e.changeCategory(t):e.goToLearnMore()});break;case o:t(this.resources.strings.extensibility_apps_gallery_banner_cat_personal_apps_title,this.resources.strings.extensibility_apps_gallery_banner_cat_personal_apps_content,this.bannerImages[o]||"",this.resources.strings.extensibility_apps_gallery_banner_btn_top_picks);break;case l:t(this.resources.strings.extensibility_apps_gallery_banner_cat_bots_title,this.resources.strings.extensibility_apps_gallery_banner_cat_bots_content,this.bannerImages[l]||"",this.resources.strings.extensibility_apps_gallery_banner_btn_top_picks);break;case c:t(this.resources.strings.extensibility_apps_gallery_banner_cat_tabs_title,this.resources.strings.extensibility_apps_gallery_banner_cat_tabs_content,this.bannerImages[c]||"",this.resources.strings.extensibility_apps_gallery_banner_btn_top_picks);break;case d:t(this.resources.strings.extensibility_apps_gallery_banner_cat_connectors_title,this.resources.strings.extensibility_apps_gallery_banner_cat_connectors_content,this.bannerImages[d]||"",this.resources.strings.extensibility_apps_gallery_banner_btn_top_picks);break;case u:t(this.resources.strings.extensibility_apps_gallery_banner_cat_messaging_title,this.resources.strings.extensibility_apps_gallery_banner_cat_messaging_content,this.bannerImages[u]||"",this.resources.strings.extensibility_apps_gallery_banner_btn_top_picks);break;default:this.bannerViewModel.hideBanner=!0}},e.prototype.announceSearchResultsChanged=function(e){var t="";t=e<=0?this.$translate.instant(this.resources.strings.extensibility_apps_list_search_result_update_no_match):1==e?this.$translate.instant(this.resources.strings.extensibility_apps_list_search_result_update_1_match):this.$translate.instant(this.resources.strings.extensibility_apps_list_search_result_update_multiple_matches,{num:e}),this.ariaLiveService.update(t)},e.prototype.showErrorDialog=function(e){this.dialogService.open(this.constants.dialogs.errorDialog,{errorTitle:e,doneButtonMessage:this.$translate.instant(this.resources.strings.apps_gallery_errorDialog_okBtn)})},e.prototype.setFocus=function(e){var t,n=angular.element(".td-apps-gallery-list");e&&(t=angular.element(document.querySelector("#apps-gallery-"+e))),t||(t=n.find(".td-apps-gallery-app")[0]),t&&t.focus()},e.prototype.determineTenantAppsAdminStatus=function(){var e,t=this;this.settingsService.valueAsBoolean(this.constants.settings.names.runningscenariotests)||(e=this.loggingService.newScenario(this.constants.scenarios.setTenantAppsAdminStatusInAppsGallery)),this.enableServiceAdminTenantAppManagement?this.identityService.canUserManageTenantApps("td-apps-gallery").then(function(n){t.userCanManageTenantApps=n,e&&e.stop({userCanManageTenantApps:t.userCanManageTenantApps,valueFrom:"me/settings/canManageLobApps"})}).catch(function(n){t.userCanManageTenantApps=t.identityService.isTenantAdmin(),e&&e.fail({error1:n,error:n,userCanManageTenantApps:t.userCanManageTenantApps,valueFrom:"User Resources Settings isTenantAdmin (skip cache)"})}).finally(function(){t.updateManageAppMenuAndButton()}):this.enableJITTenantAdminLookup?this.identityService.isTenantAdminFromMT("td-apps-gallery").then(function(n){t.userCanManageTenantApps=n,e&&e.stop({userCanManageTenantApps:t.userCanManageTenantApps,valueFrom:"User Resources Settings isTenantAdmin (skip cache)"})}).catch(function(n){t.userCanManageTenantApps=t.identityService.isTenantAdmin(),e&&e.fail({error1:n,error:n,userCanManageTenantApps:t.userCanManageTenantApps,valueFrom:"User Resources Settings isTenantAdmin (skip cache)"})}).finally(function(){t.updateManageAppMenuAndButton()}):(this.userCanManageTenantApps=this.identityService.isTenantAdmin(),this.updateManageAppMenuAndButton(),e&&e.stop({userCanManageTenantApps:this.userCanManageTenantApps,valueFrom:"User Resources Settings isTenantAdmin (cached)"}))},e.isFirstTimeVisit=!0,e}();t.TdAppsGalleryController=b,angular.module("teamspace.tdAppsGallery",["teamspace.utilityService"]).directive("tdAppsGallery",["constants","settingsService",function(e,t){return{restrict:"E",scope:{},templateUrl:"components/extensibility/td-apps-gallery/td-apps-gallery-section-with-left-rail.html",controller:b,controllerAs:"tdAppsGallery",bindToController:{params:"="}}}]).run(["$templateCache",function(e){e.put("components/extensibility/td-apps-gallery/td-apps-gallery-section-with-left-rail.html",a),e.put("components/extensibility/td-apps-gallery/td-apps-gallery-banner.html",i),e.put("components/extensibility/td-apps-gallery/td-apps-gallery-upload-options.html",s),e.put("components/extensibility/td-apps-gallery/td-apps-gallery-manage-app-options.html",r)}])},1886:function(e,t){e.exports='<div class="td-apps-gallery section with-left-rail" data-tid="apps-gallery">\n  <div class="offline-content" ng-if="tdAppsGallery.networkError">\n    <div class="offline-image">\n      <ng-include src="::tdAppsGallery.offlineImage"></ng-include>\n    </div>\n    <div class="offline-text"><h1>{{::$root.resources.strings.error_message_ClientNetworkOffline|translate}}</h1></div>\n  </div>\n  <div class="scroll-wrapper-child" ng-if="!tdAppsGallery.networkError" id="scroll-wrapper-child">\n    <section class="td-app-gallery-left-rail" ng-class="{ hide: tdAppsGallery.isLoading }" id="td-app-gallery-left-rail">\n      <div class="td-apps-gallery-header">\n        <h2 class="gallery-title">{{::$root.resources.strings.extensibility_apps_store_header|translate}}</h2>\n      </div>\n      <div class="search-and-filter" role="search">\n        \x3c!-- Search Area --\x3e\n        <div class="search">\n          <input sanitized id="app-search-input" ng-model="tdAppsGallery.searchString" class="ts-header-search ts-heading-font ng-valid-maxlength" placeholder="{{::$root.resources.strings.extensibility_apps_gallery_search_all|translate}}" autocapitalize="off" autocorrect="off" autocomplete="off" maxlength="750" ng-change="tdAppsGallery.filterBySearch()">\n          <div class="input-group-btn">\n            <button class="ts-sym icons-search" ng-mousedown="tdAppsGallery.filterBySearch()" data-tid="searchBtn" aria-label="{{::$root.resources.strings.search_placeholderText|translate}}" tabindex="-1">\n              <ng-include src="\'svg/icons-search.html\'"></ng-include>\n            </button>\n          </div>\n        </div>\n      </div>\n      \x3c!-- Category Filter --\x3e\n      <div class="filter-scrollbar-wrapper">\n        <div ng-if="tdAppsGallery.categories.length" class="td-app-gallery-container" role="region" aria-label="{{::$root.resources.strings.extensibility_apps_gallery_category_region|translate}}" simple-scrollbar>\n          <div class="ts-apps-gallery-filter">\n            <div class="td-app-gallery-category-list" acc-role="listgrid-vertical" role="list">\n              <ul class="td-app-gallery-category-ul">\n                <li class="td-app-gallery-category" aria-labelledby="td-app-gallery-name-{{::category.value}}" aria-pressed="{{!tdAppsGallery.searchString && tdAppsGallery.galleryCategory === category.value}}" acc-role="listgrid-item" role="menuitem" title="{{::category.text}}" ng-repeat="category in tdAppsGallery.categories track by category.value" ng-click="tdAppsGallery.changeCategory(category)" ng-keydown="tdAppsGallery.changeCategory(category, $event)" data-tid="td-app-gallery-category-{{::category.value}}" tabindex="{{(tdAppsGallery.galleryCategory === category.value) ? 0 : -1}}" track-click-silent="true">\n                  <div ng-if="category.hasTopPadding" class="category-space"></div>\n                  <div class="category-name" ng-if="!category.isHidden" ng-class="{selected: !tdAppsGallery.searchString && tdAppsGallery.galleryCategory === category.value}">\n                    <div class="text">\n                      <span ng-bind="::category.text" class="category-text" ng-class="{\'selected\': !tdAppsGallery.searchString && tdAppsGallery.galleryCategory === category.value}" id="td-app-gallery-name-{{::category.value}}">\n                      </span>\n                    </div>\n                    <ng-include ng-if="!tdAppsGallery.searchString && tdAppsGallery.galleryCategory === category.value" class="right-align-icon" src="\'svg/icons-patharrow.html\'"></ng-include>\n                  </div>\n                </li>\n              </ul>\n            </div>\n            <div class="category-space"></div>\n            <a class="td-app-gallery-category side-load" href="javascript:void(0)" tabindex="0" id="td-apps-gallery-side-load" ng-if="(tdAppsGallery.sideloadEnabled && !tdAppsGallery.userCanManageTenantApps)" ngf-select="tdAppsGallery.sideloadApp($file)" ng-disabled="tdAppsGallery.wait" ng-model="tdAppsGallery.file" ngf-pattern="\'.zip\'" ngf-accept="\'.zip\'" data-tid="td-app-gallery-sideload-app" acc-role="button listgrid-item" role="button listitem" aria-haspopup="true" title="{{::tdAppsGallery.uploadACustomApp}}">\n              <div class="category-name">\n                <div class="text">\n                  <span class="text" ng-bind="::tdAppsGallery.uploadACustomApp"></span>\n                </div>\n              </div>\n            </a>\n            <div class="td-app-gallery-category" ng-click="tdAppsGallery.showUploadOptions($event)" acc-role="button listgrid-item" role="button listitem" aria-haspopup="true" tabindex="0" title="{{::tdAppsGallery.uploadACustomApp}}" id="td-apps-gallery-side-load" ng-if="tdAppsGallery.userCanManageTenantApps">\n              <div class="category-name">\n                <div class="text">\n                  <span class="text" ng-bind="::tdAppsGallery.uploadACustomApp"></span>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </section>\n    <section class="td-app-gallery-right-rail" id="right-rail" role="region" aria-label="{{tdAppsGallery.rightRailRegionLabel}}">\n      \x3c!-- Loading Indicator --\x3e\n      <div ng-if="tdAppsGallery.isLoading || tdAppsGallery.isUploading || tdAppsGallery.isDeleting" class="ts-loading-indicator">\n        <busy-animation size="medium" context="apps-gallery"></busy-animation>\n      </div>\n\n      \x3c!--No search Result --\x3e\n      <div class="no-search-result-container" ng-if="tdAppsGallery.appDefinitions.length == 0 && tdAppsGallery.showNoResult">\n        <img class="no-results-image" src="https://statics.teams.microsoft.com/hashedassets/search_noresults-54383aa0.svg" aria-hidden="true"/>\n        <div class="error-message" aria-label="{{::$root.resources.strings.td_apps_gallery_no_results|translate}}" translate-once="{{::$root.resources.strings.td_apps_gallery_no_results}}"></div>\n      </div>\n\n      \x3c!-- Gallery Items --\x3e\n      <div class="scrollbar-wrapper" id="gallery-apps">\n        <div ng-if="!tdAppsGallery.isLoading && tdAppsGallery.appDefinitions.length" class="td-apps-gallery-container" simple-scrollbar enable-dynamic-adjusting-scrollbar="true">\n          <div class="app-gallery-scroll-wrapper">\n            <ng-include src="\'components/extensibility/td-apps-gallery/td-apps-gallery-banner.html\'" onload="bannerVm = tdAppsGallery.bannerViewModel" ng-if="!tdAppsGallery.searchString">\n            </ng-include>\n            <div class="td-apps-gallery-list" acc-role="listgrid-horizontal-and-vertical" role="menu">\n              <div class="td-apps-gallery-app" ng-class="{ \'td-apps-placeholder\': tdAppsGallery.isUpdating && tdAppsGallery.selectedAppId }" aria-labelledby="apps-gallery-name-{{::definition.id}} app-aria-suffix-{{::definition.id}} apps-gallery-type-{{::definition.id}}" aria-describedby="apps-gallery-description-{{::definition.id}} tenant-app-management-aria-label-{{::definition.id}}" acc-role="listgrid-item focus-default" role="menuitem" ng-disabled="tdAppsGallery.isInlineDeleting" tabindex="{{$first ? 0 : -1}}" ng-repeat="definition in tdAppsGallery.appDefinitions track by definition.id" ng-click="tdAppsGallery.onAppClicked(definition)" ts-right-click="tdAppsGallery.showManageAppOptions(definition.id, $event)" id="apps-gallery-{{::definition.id}}" data-tid="apps-gallery-{{::definition.id}}" track-click-silent="true">\n                <div class="ts-loading-indicator td-apps-gallery-loader" ng-if="tdAppsGallery.isInlineDeleting && tdAppsGallery.selectedAppId == definition.id">\n                  <busy-animation size="medium" context="apps-gallery"></busy-animation>\n                </div>\n                <div class="td-apps-gallery-app-area" ng-if="!tdAppsGallery.isUpdating || tdAppsGallery.selectedAppId !== definition.id">\n                  <button class="ts-sym icons-more app-icons-fill-hover show-icon-on-hover manage-app-options" ng-if="tdAppsGallery.showManageAppMenu" ng-click="tdAppsGallery.showManageAppOptions(definition.id, $event)" tabindex="-1" data-tid="manage-gallery-app">\n                    <ng-include src="\'svg/icons-more.html\'"></ng-include>\n                  </button>\n                  <div class="td-apps-gallery-info">\n                    <div class="image-container">\n                      <span class="image-background" ng-style="{ \'background\': definition.accentColor }">\n                        <ng-include src="definition.icon" ng-if="::tdAppsGallery.utilityService.useNgIncludeForIcon(definition.icon)"></ng-include>\n                        <img role="img" alt="{{::($root.resources.strings.extensibility_app_icon_alt|translate:{appName:definition.name})}}" aria-label="{{::($root.resources.strings.extensibility_app_icon_alt|translate:{appName:definition.name})}}" ng-src="{{::definition.icon}}" fallback-src="{{::tdAppsGallery.appFallbackIcon}}" ng-if="::!tdAppsGallery.utilityService.useNgIncludeForIcon(definition.icon)"/>\n                      </span>\n                    </div>\n                    <div class="td-apps-gallery-app-name">\n                      <span class="app-name" dir="auto" title="{{::definition.name}}" ng-bind="::definition.name" id="apps-gallery-name-{{::definition.id}}">\n                      </span>\n                      <span class="app-description" title="{{::definition.category}}" ng-bind="::definition.category" id="apps-gallery-type-{{::definition.id}}">\n                      </span>\n                    </div>\n                  </div>\n                  <div class="td-apps-gallery-app-description">\n                    <span class="app-description" dir="auto" title="{{::definition.description}}" ng-bind="::definition.description" id="apps-gallery-description-{{::definition.id}}">\n                    </span>\n                  </div>\n                  <div class="hidden" ng-if="tdAppsGallery.showManageAppMenu" id="tenant-app-management-aria-label-{{::definition.id}}" aria-label="{{::$root.resources.strings.extensibility_apps_store_app_management_option|translate}}"></div>\n                  <div class="hidden" id="app-aria-suffix-{{::definition.id}}" aria-label="{{::$root.resources.strings.extensibility_apps_store_app_tile_label|translate}}"></div>\n                </div>\n                <div class="ts-loading-indicator" ng-if="tdAppsGallery.isUpdating && tdAppsGallery.selectedAppId === definition.id">\n                  <busy-animation size="medium" context="apps-gallery"></busy-animation>\n                </div>\n              </div>\n              \x3c!-- these empty blocks is to handle the flex-grow for last row --\x3e\n              <div class="empty"></div>\n              <div class="empty"></div>\n              <div class="empty"></div>\n              <div class="empty"></div>\n              <div class="empty"></div>\n              <div class="empty"></div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </section>\n  </div>\n</div>'},1887:function(e,t){e.exports='<div ng-if="!bannerVm.hideBanner" ng-class="{\'td-apps-gallery-banner-select\': bannerVm.showLearnMoreButton}" class="td-apps-gallery-banner">\n\n  \x3c!-- left part --\x3e\n  <div class="td-apps-gallery-banner-left">\n    \x3c!-- title / content --\x3e\n    <h2 ng-bind="bannerVm.title" ng-attr-title="{{bannerVm.title}}" class="td-apps-gallery-banner-title">\n    </h2>\n    <div ng-bind="bannerVm.content" ng-attr-title="{{bannerVm.content}}" role="presentation" class="td-apps-gallery-banner-content">\n    </div>\n\n    \x3c!-- learn more button --\x3e\n    <a ng-click="bannerVm.learnMoreButtonClick()" ng-if="bannerVm.showLearnMoreButton" ng-attr-title="{{bannerVm.learnMoreButtonTitle}}" class="td-apps-gallery-banner-btn-more" role="link" tabindex="0">\n      <span ng-bind="bannerVm.learnMoreButtonTitle" class="td-apps-gallery-banner-btn-text">\n      </span>\n    </a>\n  </div>\n\n  \x3c!-- right part --\x3e\n  <div class="td-apps-gallery-banner-right" ng-class="{\'all\': !bannerVm.imageSrc}">\n    <div class="images" ng-if="!bannerVm.imageSrc">\n      <div class="app-image-container image-{{$index}}" ng-repeat="app in bannerVm.apps | limitTo: 4 track by app.id">\n        <img class="banner-app-image" title="{{::app.name}}" alt="{{::app.name}}" ng-click="bannerVm.onBannerAppClicked(app.id)" ng-src="{{::app.src}}" tabindex="0" fallback-src="{{::tdAppsGallery.appFallbackIcon}}" role="link"/>\n      </div>\n    </div>\n    <img class="banner-image" ng-src="{{bannerVm.imageSrc}}" ng-if="bannerVm.imageSrc" fallback-src="{{::tdAppsGallery.appFallbackIcon}}"/>\n  </div>\n</div>'},1888:function(e,t){e.exports='<div class="popover link-more-actions app-default-menu minwidth-sm maxwidth-sm" id="app-upload-menu" data-tid="app-upload-menu" outside-click="tdAppsGallery.dismissUploadAppPopover()" role="region" aria-label="{{::$root.resources.strings.extensibility_apps_gallery_upload_app_label|translate}}" set-aria-pos>\n  <ul acc-role="dialog menu" class="app-default-menu-ul set-aria-attribute">\n    <li role="menuitem">\n      <button class="ts-sym has-icon" ng-if="tdAppsGallery.sideloadEnabled" ngf-select="tdAppsGallery.sideloadApp($file)" ng-disabled="tdAppsGallery.appActionDisabled()" ng-model="tdAppsGallery.file" ngf-pattern="\'.zip\'" ngf-accept="\'.zip\'" acc-role="menu-item focus-default" title="{{::$root.resources.strings.extensibility_apps_gallery_upload_option_sideload|translate}}" track-click-silent="true" data-tid="side-load-app">\n        <div>\n          <ng-include class="icon" src="\'svg/icons-files-upload.html\'"></ng-include>\n          <span>{{::$root.resources.strings.extensibility_apps_gallery_upload_option_sideload|translate}}</span>\n        </div>\n      </button>\n    </li>\n    <li role="menuitem" ng-if="tdAppsGallery.enableTenantOwnedApps">\n      <button class="ts-sym has-icon" ngf-select="tdAppsGallery.uploadTenantApp($file)" ng-disabled="tdAppsGallery.appActionDisabled()" ng-model="tdAppsGallery.file" ngf-pattern="\'.zip\'" ngf-accept="\'.zip\'" acc-role="menu-item" title="{{tdAppsGallery.uploadATenantApp}}" track-click-silent="true" data-tid="upload-tenant-app">\n        <div>\n          <ng-include class="icon" src="\'svg/icons-files-upload.html\'"></ng-include>\n          <span ng-bind="tdAppsGallery.uploadATenantApp"></span>\n        </div>\n      </button>\n    </li>\n  </ul>\n</div>\n'},1889:function(e,t){e.exports='<div class="popover link-more-actions app-default-menu minwidth-sm maxwidth-sm" id="app-{{tdAppsGallery.selectedAppId}}-manageAppMenu" outside-click="tdAppsGallery.dismissManageAppPopover()" role="region" aria-label="{{::$root.resources.strings.extensibility_apps_gallery_manage_app_label|translate}}" set-aria-pos>\n  <ul acc-role="dialog menu" class="app-default-menu-ul set-aria-attribute">\n    <li acc-role="menu-item focus-default" ng-if="tdAppsGallery.showManageAppButton">\n      <button class="ts-sym has-icon" ngf-select="tdAppsGallery.updateTenantApp($file)" ng-disabled="tdAppsGallery.appActionDisabled()" ng-model="tdAppsGallery.file" ngf-pattern="\'.zip\'" ngf-accept="\'.zip\'" title="{{::$root.resources.strings.extensibility_apps_gallery_update_app_option|translate}}" track-click-silent="true" data-tid="update-tenant-app-{{tdAppsGallery.selectedAppId}}">\n        <div>\n          <ng-include class="icon" src="\'svg/icons-files-upload.html\'"></ng-include>\n          <span>{{::$root.resources.strings.extensibility_apps_gallery_update_app_option|translate}}</span>\n        </div>\n      </button>\n    </li>\n    <li acc-role="menu-item focus-default" ng-if="tdAppsGallery.enableAppsGalleryAppSharing">\n      <button class="ts-sym has-icon" ng-click="$parent.$hide(); tdAppsGallery.copyLinkToApp($event)" ng-disabled="tdAppsGallery.appActionDisabled()" title="{{::$root.resources.strings.extensibility_apps_gallery_sharing_copyLink_title|translate}}" track-click-silent="true" data-tid="share-app-{{tdAppsGallery.selectedAppId}}">\n        <div>\n          <ng-include class="icon" src="\'svg/icons-link.html\'"></ng-include>\n          <span>{{::$root.resources.strings.extensibility_apps_gallery_sharing_copyLink_title|translate}}</span>\n        </div>\n      </button>\n    </li>\n    <li acc-role="menu-item" ng-if="tdAppsGallery.showManageAppButton">\n      <button class="ts-sym has-icon" ng-click="tdAppsGallery.deleteTenantApp()" ng-disabled="tdAppsGallery.appActionDisabled()" title="{{::$root.resources.strings.extensibility_apps_gallery_delete_app_option|translate}}" track-click-silent="true" data-tid="delete-tenant-app-{{tdAppsGallery.selectedAppId}}">\n        <div>\n          <ng-include class="icon" src="\'svg/icons-delete.html\'"></ng-include>\n          <span>{{::$root.resources.strings.extensibility_apps_gallery_delete_app_option|translate}}</span>\n        </div>\n      </button>\n    </li>\n  </ul>\n</div>\n'},1890:function(e,t,n){"use strict";var a=this&&this.__assign||function(){return(a=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(1891),s=function(){function e(e,t,n,a,i,s,r,o,p,l,c,d,g,h,u,m,y,f,A,v,b,_){var S=this;if(this.$state=e,this.$filter=t,this.$q=n,this.$translate=a,this.$timeout=i,this.analyticsService=s,this.appsService=r,this.constants=p,this.dialogService=l,this.extensionManifestService=c,this.helpService=d,this.loggingService=g,this.peopleSlugService=u,this.resources=m,this.routeUtilityService=y,this.utilityService=_,this.learnMoreUrl="https://aka.ms/microsoftteamsplatform",this.enableAppUpgradeInChat=!1,this.isGuestUser=!1,this.isChat=!1,this.scenarioName=p.scenarios.teamDashboard.appsTabLoad,this.logger=g.newLogger("AppsTab"),this.enableInstallChatAppsFromStore=f.valueAsBoolean(p.settings.names.enableInstallChatAppsFromStore),this.enableSideloadAppByZip=f.valueAsBoolean(p.settings.names.enableSideloadAppByZip),this.stateParams=y.getRootRouteParams(),this.isChat=this.stateParams&&this.stateParams.peopleSlug&&this.stateParams.ctx===p.navigation.context.chat,this.appFallbackIcon=p.fallbackImages.appFallbackImage,this.teamAndChannelPromise=this.isChat?void 0:o.resolveTeamAndChannel(y.getRootRouteParams().threadId).then(function(e){S.teamId=e.team.objectId,S.isTeamArchived=e.team.isArchived&&f.valueAsBoolean(p.settings.names.enableTeamArchive);var t=v.isAdmin(S.teamId);if(S.canInstallApp=!S.isTeamArchived&&(t||b.canAddApp(S.teamId)),S.canUninstallApp=!S.isTeamArchived&&(t||b.canRemoveApp(S.teamId)),S.enableAppUpgradeNotification=S.canInstallApp&&f.valueAsBoolean(p.settings.names.enableAppUpgradeNotification),S.enableAppPolicySideloadingControl=f.valueAsBoolean(p.settings.names.enableAppPolicySideloadingControl),f.valueAsBoolean(p.settings.names.enableSideloadingEnforcement)){var n;f.valueAsBoolean(p.settings.names.runningscenariotests)||(n=g.newScenario(p.scenarios.extensibility.apps.tab.toggleSideloadEntrypoint)),r.getUserAppPolicy("apps tab - team").then(function(e){var a=!(!e||!e.isSideloadingAllowed)&&e.isSideloadingAllowed,i=b.canUploadCustomApp(S.teamId);S.canSideloadApp=a&&(t||i),n&&n.stop({isTeamAdmin:t,teamAllowsCustomUploads:i,sideloadingAllowedByPolicy:e&&void 0!=e.isSideloadingAllowed?e.isSideloadingAllowed:void 0,sideloadingEntrypointIsVisible:S.canSideloadApp})}).catch(function(e){S.canSideloadApp=!1,n&&n.fail({sideloadingEntrypointIsVisible:S.canSideloadApp,error:e,error1:e})})}else S.canSideloadApp=A.getSettingValue(SkypeX.Services.TenantSettingsStorageKey.isSideLoadedAppsEnabled)}),this.isChat)if(f.valueAsBoolean(p.settings.names.enableSideloadingEnforcement)){var I;f.valueAsBoolean(p.settings.names.runningscenariotests)||(I=g.newScenario(p.scenarios.extensibility.apps.tab.toggleSideloadEntrypoint)),r.getUserAppPolicy("apps tab - chat").then(function(e){S.canSideloadApp=!(!e||!e.isSideloadingAllowed)&&e.isSideloadingAllowed,I&&I.stop({sideloadingAllowedByPolicy:e&&void 0!=e.isSideloadingAllowed?e.isSideloadingAllowed:void 0,sideloadingEntrypointIsVisible:S.canSideloadApp})}).catch(function(e){S.canSideloadApp=!1,I&&I.fail({sideloadingEntrypointIsVisible:S.canSideloadApp,error:e,error1:e})})}else this.canSideloadApp=A.getSettingValue(SkypeX.Services.TenantSettingsStorageKey.isSideLoadedAppsEnabled);this.isChat&&this.enableInstallChatAppsFromStore&&(this.chatId=this.getChatId(),this.canInstallApp=!0,this.canUninstallApp=!0,this.enableAppUpgradeInChat=f.valueAsBoolean(p.settings.names.enableChatAppUpgrade)),this.discoverButtonSrc="svg/icons-discover-apps.html",this.noAppsStr=a.instant(m.strings.team_dashboard_developer_noapps_subtitle_discover_new),this.appButtonText=a.instant(m.strings.extensibility_go_to_store),this.wait=this.isWaiting(),this.isGuestUser=this.enableInstallChatAppsFromStore&&this.isChat&&h.isGuestUserType(),this.buildTable()}return e.$inject=["$state","$filter","$q","$translate","$timeout","analyticsService","appsService","channelService","constants","dialogService","extensionManifestService","helpService","loggingService","identityService","peopleSlugService","resources","routeUtilityService","settingsService","tenantSettingsStore","teamMembershipPropertiesService","teamSettingsService","utilityService"],e.prototype.buildTable=function(){var e=this;this.getAppsFromAppsService().then(function(t){e.appList=t,e.sortedColumn||(e.sortedColumn={name:"name"}),e.sortTableInternal()}).catch(function(t){e.handleError(t,"Failed to get the apps list")}).finally(function(){e.wait=e.isWaiting()})},e.prototype.getAppsFromAppsService=function(){var e=this;return this.isChat&&this.enableInstallChatAppsFromStore?this.appsService.getInstalledAppsForGroupChat(this.chatId).then(function(t){return e.getAppsFromEntitlements(t)}):this.teamAndChannelPromise.then(function(){return e.appsService.getInstalledAppsForTeam(e.teamId).then(function(t){return e.getAppsFromEntitlements(t)})})},e.prototype.getAppsFromEntitlements=function(e){if(!e||e.length<1)return[];for(var t=[],n=0;n<e.length;n++){var a=e[n];if(teamspace.services.AppsServiceUtils.isAppInstalled(a)&&!teamspace.services.AppsServiceUtils.isAppPermanent(a)){var i=a.appDefinition.name;a.appDefinition.customBots&&a.appDefinition.customBots.length?i=this.$translate.instant(this.resources.strings.td_apps_tab_name_customBot,{name:i}):this.appsService.isSideloadedApp(a.appDefinition)&&(i=this.$translate.instant(this.resources.strings.td_apps_tab_name_sideloaded_app,{name:i}));var s=this.teamId?this.enableAppUpgradeNotification&&this.appsService.isUpgradeConsentRequired(a.appDefinition.id,this.teamId):this.enableAppUpgradeInChat&&this.appsService.isUpgradeConsentRequired(a.appDefinition.id,this.chatId);t.push({id:a.appDefinition.id,name:i,description:a.appDefinition.longDescription,icon:a.appDefinition.largeImageUrl,smallIcon:a.appDefinition.smallImageUrl,accentColor:a.appDefinition.accentColor,hasCustomBots:!!a.appDefinition.customBots,hasBots:!!a.appDefinition.bots,hasTabs:!!a.appDefinition.galleryTabs,externalId:a.appDefinition.externalId,upgradeConsentRequired:s,tenantId:a.appDefinition.tenantId})}}return t},e.prototype.getChatId=function(){if(this.stateParams.peopleSlug&&this.stateParams.ctx===this.constants.navigation.context.chat){var e=this.peopleSlugService.resolve(this.stateParams.peopleSlug);return e&&e.conversation&&e.conversation.id}return null},e.prototype.isWaiting=function(){return!(this.errorInfo||this.appList&&(this.teamId||this.chatId))},e.prototype.sortTable=function(e){this.sortedColumn&&e==this.sortedColumn.name?this.sortedColumn.reverse=!this.sortedColumn.reverse:this.sortedColumn={name:e},this.sortTableInternal()},e.prototype.sortTableInternal=function(){this.appList=this.$filter("orderBy")(this.appList,this.sortedColumn.name,this.sortedColumn.reverse)},e.prototype.sideloadApp=function(e){var t=this;if(e){var n=this.isChat&&this.enableInstallChatAppsFromStore;this.wait=!0;var a=n?this.logger.service.newScenario(this.constants.scenarios.extensibility.apps.chat.processSideloadedManifest):this.logger.service.newScenario(this.constants.scenarios.extensibility.tabs.framework.sideloadAppToTeamScenario);this.logger.info("Starting upload of tab definition"),this.errorInfo=null;var i=this.enableSideloadAppByZip?this.extensionManifestService.getZipStreamPromise(e):this.$q.resolve();this.$q.all([this.extensionManifestService.extractAppDefinition(e,this.enableSideloadAppByZip),n?this.appsService.getInstalledAppsForGroupChat(this.chatId):this.appsService.getInstalledAppsForTeam(this.teamId),i]).then(function(e){for(var a=e[0],i=e[1],s=e[2],r=0;r<i.length;r++){var o=i[r].appDefinition;if(teamspace.services.AppsServiceUtils.isAppInstalled(i[r])&&a.externalId===o.externalId)return a.id=o.id,n?t.enableSideloadAppByZip?t.appsService.updateGroupChatAppDefinitionFromZip(t.chatId,o.id,s):t.appsService.updateGroupChatAppDefinition(t.chatId,a):t.enableSideloadAppByZip?t.appsService.updateTeamAppDefinitionFromZip(t.teamId,o.id,s):t.appsService.updateTeamAppDefinition(t.teamId,a)}return n?t.enableSideloadAppByZip?t.appsService.createGroupChatAppDefinitionFromZip(t.chatId,s):t.appsService.createGroupChatAppDefinition(t.chatId,a):t.enableSideloadAppByZip?t.appsService.createTeamAppDefinitionFromZip(t.teamId,s):t.appsService.createTeamAppDefinition(t.teamId,a)}).then(function(){a.stop()}).catch(function(e){if(e.type===t.constants.extensibility.apps.errorCodes.manifestError)a.cancel({error:e.errors}),t.handleError(e.errors,"Failed to validate app manifest");else if(e.data&&e.data.errorCode===t.constants.extensibility.apps.errorCodes.chatBotsRosterLimitExceeded){var n=t.$translate.instant(t.resources.strings.chats_apps_sideload_bot_roster_limit);a.fail({error:e}),t.handleError(n,"Failed to upload app package")}else e.data&&e.data.errorCode===t.constants.extensibility.apps.errorCodes.unableToParseTeamsAppManifest?(a.cancel({error:e}),t.handleManifestParseError(e.data.message)):(a.fail({error:e}),t.handleError(e,"Failed to upload app package"))}).finally(function(){t.buildTable()})}},e.prototype.openAppDetails=function(e){var t=this;if(e.hasCustomBots)this.loggingService.newScenario(this.constants.scenarios.extensibility.customBots.openAddWebhookDialog).clientId="td-apps-tab",this.dialogService.registerCloseCallback(this.constants.dialogs.addWebhook,function(e){e&&e.installSucceeded&&t.buildTable()}),this.dialogService.open(this.constants.dialogs.addWebhook,{teamId:this.teamId,webhookId:e.id,editMode:!0});else{var n=this.logger.service.newScenario(this.constants.scenarios.extensibility.tabs.framework.openAppDetailsScenario);n.eventData=this.getScenarioEventData(e);var a={appID:e.id,intent:this.isChat?teamspace.components.AddAppDialogIntent.GroupChat:teamspace.components.AddAppDialogIntent.Team,chatId:this.chatId,preselectChat:this.chatId,teamId:this.teamId,preselectTeam:this.teamId,action:(this.enableAppUpgradeNotification||this.enableAppUpgradeInChat)&&e.upgradeConsentRequired?teamspace.components.AddAppDialogAction.Consent:teamspace.components.AddAppDialogAction.View,autoNavigationOnDone:!0,source:"td-apps-tab"},i=void 0;i=this.isChat?(this.enableAppUpgradeNotification||this.enableAppUpgradeInChat)&&e.upgradeConsentRequired?{entryPoint:teamspace.components.AddAppDialogEntryPoint.GroupChatAppsManagementUpgrade,appId:e.id,chatId:this.chatId}:{entryPoint:teamspace.components.AddAppDialogEntryPoint.GroupChatAppsManagementView,appId:e.id,chatId:this.chatId}:(this.enableAppUpgradeNotification||this.enableAppUpgradeInChat)&&e.upgradeConsentRequired?{entryPoint:teamspace.components.AddAppDialogEntryPoint.AppsManagementTabUpgrade,appId:e.id,teamId:this.teamId}:{entryPoint:teamspace.components.AddAppDialogEntryPoint.AppsManagementTabView,appId:e.id,teamId:this.teamId};var s;e.upgradeConsentRequired&&(s=function(e){e&&e.upgradeSucceeded&&t.buildTable()}),this.dialogService.openLazyDialog(this.constants.lazyDialogs.addAppNew,this.constants.lazyModules.extensibilityDialogs,Object.assign(a,i),s),n.stop()}},e.prototype.openAppGallery=function(){var e=this.logger.service.newScenario(this.constants.scenarios.extensibility.tabs.framework.openAppGalleryScenario),t={intent:this.isChat?teamspace.components.AddAppDialogIntent.GroupChat:teamspace.components.AddAppDialogIntent.Team,category:teamspace.services.AppsServiceCategoryFilter.All,threadId:this.isChat?this.routeUtilityService.getRootRouteParams().peopleSlug:this.routeUtilityService.getRootRouteParams().threadId,autoNavigationOnDone:!0,skipInstalledSuccess:!1,preselectTeam:this.teamId,preselectChat:this.chatId,addAppDialogEntryPoint:this.isChat?teamspace.components.AddAppDialogEntryPoint.AppsManagementTabFromGroupChat:teamspace.components.AddAppDialogEntryPoint.AppsManagementTabFromTeam};this.$state.go(this.constants.states.appApps,t).catch(function(n){e.fail({source:"td-apps-tab",params:JSON.stringify(t),error:n})}).finally(function(){e.stop()})},e.prototype.deleteApp=function(e,t){var n=this;e.stopPropagation();var i=this.appList[t];if(i){var s={closeButtonText:this.$translate.instant(this.resources.strings.extension_uninstallConfirmCloseText),okButtonText:this.$translate.instant(this.resources.strings.extension_uninstallConfirmOkText),confirmMessageTitle:this.$translate.instant(this.resources.strings.extension_uninstallConfirmTitle,{name:i.name}),confirmMessageHtmlBody:this.$translate.instant(this.resources.strings.extension_uninstallConfirmMessage,{name:i.name}),clickSilent:!0,callback:function(){var e=n.logger.service.newScenario(n.constants.scenarios.extensibility.tabs.framework.deleteAppFromTeamScenario);n.logger.info("Starting deletion of tab definition"),n.errorInfo=null,n.appList.splice(t,1),n.$timeout(function(){n.setFocus(t)}),n.wait=!0,(n.isChat&&n.enableInstallChatAppsFromStore?n.appsService.deleteGroupChatAppEntitlement(n.chatId,i.id):n.appsService.deleteTeamAppEntitlement(n.teamId,i.id)).then(function(){n.setFocus(t),e.stop(),n.logTelemetryForDeleteAppAction(i)}).catch(function(t){n.buildTable(),e.fail(a({},n.getScenarioEventData(i),{error:t})),t&&t.type===n.constants.extensibility.apps.errorCodes.amsError?n.handleError(t,"Failed to remove image from ams, appId: "+i.id):n.handleError(t,"Failed to uninstall app, appId: "+i.id)}).finally(function(){n.wait=!1})}};this.dialogService.open(this.constants.dialogs.confirmDialog,s)}},e.prototype.goToLearnMore=function(){this.helpService.gotoHelp("Articles-UsingAppsServicesPluginsWithSkypeTeams/6c25661b-90f8-4b52-92b2-1fcd3e5d946c")},e.prototype.addOutgoingWebhook=function(){var e=this;this.loggingService.newScenario(this.constants.scenarios.extensibility.customBots.openAddWebhookDialog).clientId="td-apps-tab",this.dialogService.registerCloseCallback(this.constants.dialogs.addWebhook,function(t){t&&t.installSucceeded&&e.buildTable()}),this.dialogService.open(this.constants.dialogs.addWebhook,{teamId:this.teamId})},e.prototype.handleError=function(e,t){var n=t+". Error: ";"string"==typeof e?(n+=e,this.errorInfo=e):e&&e.data&&e.data.errorCode===this.constants.extensibility.apps.errorCodes.appSideloadingForbidden?(n+=JSON.stringify(e),this.errorInfo=this.$translate.instant(this.resources.strings.extension_appSideloadingForbiddenErrorMessage)):(n+=JSON.stringify(e),this.errorInfo=this.$translate.instant(this.resources.strings.td_apps_tab_error)),this.logger.error(n)},e.prototype.handleManifestParseError=function(e){this.dialogService.openLazyDialog(this.constants.lazyDialogs.manifestError,this.constants.lazyModules.extensibilityDialogs,{errorMessage:this.$translate.instant(this.resources.strings.extension_addAppDialogManifestParsingErrorMessage),errorDetails:e})},e.prototype.setFocus=function(e){var t;(t=this.appList.length>0&&this.appList.length>=e?angular.element(".td-apps-container").find(".td-apps")[this.appList.length===e?e-1:e]:angular.element(".left-action-btns").find("[data-tid='td-apps-gallery']"))&&t.focus()},e.prototype.logTelemetryForDeleteAppAction=function(e){var t=this,n={action:{gesture:teamspace.components.PanelActionGesture.click,outcome:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionOutcome.submit.toString(),teamspace.components.PanelActionOutcome,this.loggingService),scenario:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionScenario.removeAppDialog.toString(),teamspace.components.PanelActionScenario,this.loggingService),scenarioType:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionScenarioType.appMgmt.toString(),teamspace.components.PanelActionScenarioType,this.loggingService)},module:{name:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelModuleName.confirmRemoveApp.toString(),teamspace.components.PanelModuleName,this.loggingService),type:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelModuleType.button.toString(),teamspace.components.PanelModuleType,this.loggingService),summary:this.isChat?"Delete "+e.name+" from chat":"Delete "+e.name+" from team"},app:{id:e.id,name:e.name}};this.analyticsService.getAnalyticsPanelActionEventData(n).then(function(e){t.analyticsService.sendPanelAction(e)})},e.prototype.getScenarioEventData=function(e){return{appId:e.id,externalId:e.externalId,tenantId:e.tenantId,isChat:this.isChat}},e}();t.TdAppsTabController=s,angular.module("teamspace.tdAppsTab",["teamspace.utilityService","teamspace.routeUtilityService"]).run(["$templateCache",function(e){e.put("components/extensibility/td-apps-tab/td-apps-tab.html",i)}]).directive("tdAppsTab",[function(){return{restrict:"E",scope:{},bindToController:{},templateUrl:"components/extensibility/td-apps-tab/td-apps-tab.html",controller:s,controllerAs:"tdct"}}])},1891:function(e,t){e.exports='<div class="td-apps-tab team-dashboard-tab flex-fill">\n    <div class="manage-apps-title" ng-if="tdct.isChat" ng-bind="::$root.resources.strings.chat_manage_apps | translate"></div>\n    <div class="user-actions-container">\n        <div class="title" ng-if="tdct.canInstallApp && !tdct.isChat" ng-bind="::$root.resources.strings.team_dashboard_apps_header_name_new | translate"></div>\n        <div class="title" ng-if="tdct.isChat" ng-bind="::$root.resources.strings.user_apps_header_name_new | translate"></div>\n        <div class="title" ng-if="::(!tdct.canInstallApp && !tdct.isTeamArchived)" ng-bind="::$root.resources.strings.team_dashboard_apps_header_name_noperms_new | translate"></div>\n        <div ng-if="tdct.canInstallApp" class="left-action-btns">\n            <button type="button" class="ts-btn ts-btn-fluent ts-btn-fluent-with-icon ts-btn-fluent-primary" ng-click="tdct.openAppGallery()" track-outcome="{{::$root.trackConstants.trackOutcome.nav}}" track-scenario="{{::$root.trackConstants.trackScenario.navAppStore}}" track-scenario-type="{{::$root.trackConstants.trackScenarioType.nav}}" track-name="{{::(tdct.isChat ? $root.trackConstants.trackModuleName.chatAppDashboard : $root.trackConstants.trackModuleName.teamAppDashboard)}}" track-type="{{::$root.trackConstants.trackType.nav}}" track-summary="{{::tdct.isChat ? \'Chat app dashboard - Store\' : \'Team app dashboard - Store\'}}" data-tid="td-apps-gallery">\n                <ng-include class="icon" src="::tdct.discoverButtonSrc"></ng-include>\n                <span ng-bind="::tdct.appButtonText"></span>\n            </button>\n        </div>\n    </div>\n    <div class="error" data-tid="tdAppsTab-error" ng-if="tdct.errorInfo">\n        <ng-include class="icons-input-invalid icon" src="\'svg/icons-error.html\'"></ng-include>\n        <span ng-bind-html="::tdct.errorInfo" role="alert" aria-live="assertive"></span>\n    </div>\n    <div ng-if="tdct.wait" class="td-apps-tab-busy-container">\n        <busy-animation size="medium" context="td-apps-tab"></busy-animation>\n    </div>\n\n    <div class="apps-content" ng-if="tdct.wait || tdct.appList.length > 0">\n      <div class="container-headers" ng-if="tdct.appList.length > 0">\n          <div class="td-header-name">\n              <button class="btn btn-default td-header-button icons-gray-06-triangle-fill" ng-click="tdct.sortTable(\'name\')" aria-label="{{::$root.resources.strings.td_channels_tab_header_name_aria|translate}}">\n                  <div>\x3c!-- This div is required by Firefox for flexbox --\x3e\n                      <div class="header-button-text" translate-once="{{::$root.resources.strings.td_channels_tab_header_name}}"></div>\n                      <div ng-if="tdct.sortedColumn.name === \'name\' && !tdct.sortedColumn.reverse" aria-label="{{::$root.resources.strings.td_channels_tab_header_ascending|translate}}">\n                        <ng-include class="icon" src="\'svg/icons-triangle-down-small.html\'"></ng-include>\n                      </div>\n                      <div ng-if="tdct.sortedColumn.name === \'name\' && tdct.sortedColumn.reverse" aria-label="{{::$root.resources.strings.td_channels_tab_header_descending|translate}}">\n                        <ng-include class="icon" src="\'svg/icons-triangle-up-small.html\'"></ng-include>\n                      </div>\n                  </div>\n              </button>\n          </div>\n          <div class="td-header-description">\n              <button class="btn btn-default td-header-button icons-gray-06-triangle-fill" ng-click="tdct.sortTable(\'description\')" aria-label="{{::$root.resources.strings.chat_manage_apps_header_description_aria|translate}}">\n                  <div>\x3c!-- This div is required by Firefox for flexbox --\x3e\n                      <div class="header-button-text" translate-once="{{::$root.resources.strings.td_channels_tab_header_description}}"></div>\n                      <div ng-if="tdct.sortedColumn.name === \'description\' && !tdct.sortedColumn.reverse" aria-label="{{::$root.resources.strings.td_channels_tab_header_ascending|translate}}">\n                        <ng-include class="icon" src="\'svg/icons-triangle-down-small.html\'"></ng-include>\n                      </div>\n                      <div ng-if="tdct.sortedColumn.name === \'description\' && tdct.sortedColumn.reverse" aria-label="{{::$root.resources.strings.td_channels_tab_header_descending|translate}}">\n                        <ng-include class="icon" src="\'svg/icons-triangle-up-small.html\'"></ng-include>\n                      </div>\n                  </div>\n              </button>\n          </div>\n      </div>\n    </div>\n    <div class="td-apps-tab-scrollbar-wrapper" ng-class="{\'no-apps\': tdct.appList.length === 0, \'td-apps-tab-scrollbar-wrapper-chat\': tdct.isChat}">\n      <div simple-scrollbar>\n        <div class="apps-content" ng-if="tdct.wait || tdct.appList.length > 0">\n          <ul class="td-apps-container" data-tid="tdAppsTab-apps" ng-if="tdct.appList.length > 0" scenario-end="{{ tdct.scenarioName }}">\n              <li class="td-apps" ng-repeat="app in tdct.appList track by app.id" ng-click="tdct.openAppDetails(app)" aria-label="{{app.name}} {{app.description}}" tabindex="0" data-tid="td-apps-{{::app.id}}" track-gesture="{{::$root.trackConstants.trackGesture.click}}" track-outcome="{{::$root.trackConstants.trackOutcome.openDialog}}" track-scenario="{{::$root.trackConstants.trackScenario.openAddAppDialog}}" track-scenario-type="{{::$root.trackConstants.trackScenarioType.manageApps}}" track-name="{{::$root.trackConstants.trackModuleName.manageApps}}" track-type="{{::$root.trackConstants.trackType.manageApps}}" track-summary="manage apps - open add app dialog">\n                  <div class="td-apps-name" title="{{app.name}}">\n                      <div class="td-apps-icon" aria-hidden="true" ng-style="{ \'background\': app.accentColor }">\n                          <ng-include src="app.icon" ng-if="::tdct.utilityService.useNgIncludeForIcon(app.icon)"></ng-include>\n                          <img ng-src="{{::app.icon}}" fallback-src="{{::tdct.appFallbackIcon}}" ng-if="::!tdct.utilityService.useNgIncludeForIcon(app.icon)"/>\n                      </div>\n                      <div class="td-apps-display-name" dir="auto">\n                          {{app.name}}\n                      </div>\n                  </div>\n                  <div class="td-apps-description">\n                    <div class="td-apps-description-content" title="{{app.description}}" dir="auto">{{app.description}}</div>\n                    <div class="td-apps-upgrade-consent-notification" data-tid="td-apps-upgrade-consent-notification" title="{{::$root.resources.strings.team_dashboard_apps_upgrade_consent_notification | translate}}" ng-if="app.upgradeConsentRequired" ng-bind="::$root.resources.strings.team_dashboard_apps_upgrade_consent_notification | translate"></div>\n                  </div>\n                  <div class="td-apps-actions" ng-if="tdct.canUninstallApp && !tdct.isGuestUser">\n                      <button type="button" class="ts-btn update-button" data-tid="tdAppsTab-delete" ng-click="tdct.deleteApp($event, $index)" ng-disabled="tdct.wait" aria-label="{{::$root.resources.strings.icons_uninstall | translate}}" title="{{::$root.resources.strings.icons_uninstall | translate}}" track-gesture="{{::$root.trackConstants.trackGesture.click}}" track-outcome="{{::$root.trackConstants.trackOutcome.delete}}" track-scenario="{{::$root.trackConstants.trackScenario.removeApp}}" track-scenario-type="{{::$root.trackConstants.trackScenarioType.manageApps}}" track-name="{{::$root.trackConstants.trackModuleName.manageApps}}" track-type="{{::$root.trackConstants.trackType.manageApps}}" track-summary="manage apps - remove app">\n                          <div class="ts-sym"><ng-include src="\'svg/icons-delete.html\'"></ng-include></div>\n                      </button>\n                  </div>\n              </li>\n          </ul>\n        </div>\n      </div>\n    </div>\n\n    <div class="td-apps-noapps" data-tid="tdAppsTab-noapps" ng-if="!tdct.wait && tdct.appList.length === 0">\n        <div>\n            <div ng-if="tdct.canInstallApp">\n                <span ng-bind="::tdct.noAppsStr"></span>\n            </div>\n        </div>\n    </div>\n    <div ng-if="tdct.canInstallApp || (tdct.enableAppPolicySideloadingControl && tdct.canSideloadApp)" class="td-apps-footer">\n        <div class="pull-left" ng-if="tdct.canSideloadApp">\n            <span ng-bind="::$root.resources.strings.team_dashboard_developer_footer | translate"></span>\n            <a href="{{::tdct.learnMoreUrl}}" target="_blank\\" ng-bind="::$root.resources.strings.team_dashboard_developer_footer_learn_more | translate"></a>\n        </div>\n        <div class="pull-right">\n            <div class="pull-right-container" ng-if="tdct.canSideloadApp && !tdct.isChat" aria-label="{{::$root.resources.strings.team_dashboard_developer_add_outgoing_webhook|translate}}">\n              <a href="javascript:void(0)" translate-once="{{::$root.resources.strings.team_dashboard_developer_add_outgoing_webhook}}" ng-click="tdct.addOutgoingWebhook()" data-tid="td-new-outgoing-webhook"></a>\n            </div>\n            <span ng-if="tdct.canSideloadApp && !tdct.isChat">|</span>\n            <div class="pull-right-container" aria-label="{{::$root.resources.strings.team_dashboard_developer_sideload_app_new|translate}}">\n              <a href="javascript:void(0)" ng-bind="::$root.resources.strings.team_dashboard_developer_sideload_app_new | translate" ng-if="tdct.canSideloadApp && !tdct.isGuestUser" ngf-select="tdct.sideloadApp($file)" ngf-select-disabled="tdct.wait" ng-model="tdct.file" ngf-pattern="\'.zip\'" ngf-accept="\'.zip\'" data-tid="td-new-app"></a>\n            </div>\n        </div>\n    </div>\n</div>\n'}},[1882]);
//# sourceMappingURL=https://statics.teams.microsoft.com/hashedjs/lazy-ng1-mod-extensibility-apps-components.min.js-47566322.map