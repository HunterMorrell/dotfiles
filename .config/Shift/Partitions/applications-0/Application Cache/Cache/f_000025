var msRDCRTC;!function(e){window.vdiPeerConnection=e()}(function(e,t){"use strict";function n(e,t){t.forEach(function(t){Object.defineProperty(e,t,{enumerable:!0,get:function(){return this.readOnlyAttributes[t]},set:function(){throw new TypeError}})})}function i(e,t){t.forEach(function(t){var n=t[0],i=t[1],r=t[2];e.observableAttributes[n]=i,Object.defineProperty(e,n,{enumerable:!0,get:function(){return this.observableAttributes[n]},set:function(e){this.observableAttributes[n]=e,r()}})})}function r(e,t){t.forEach(function(t){var n=t[0],i=t[1],r=t[2];Object.defineProperty(e,n,{enumerable:!0,get:function(){return i(n)},set:function(e){return r(n,e)}})})}function c(e,t){t.forEach(function(t){var c=t[0],o=t[1];if(Object.defineProperty(e,c,{enumerable:!1,writable:!0,value:o}),"readOnlyAttributes"===c){var a=[];for(var c in o)a.push(c);n(e,a)}else"observableAttributes"===c?i(e,o):"customAttributes"===c&&r(e,o)})}function o(e,t){var n="on"+t,i=e.observableAttributes[n],r=e.eventListeners[n];e.eventListeners[n]=i,null!=r&&e.removeEventListener(t,r,!1),null!=i&&e.addEventListener(t,i,!1)}function a(){var e=this;c(this,[["customAttributes",[["size",function(){return e.getSize()},E]]]])}function s(e){return e<0&&(e+=4294967296),"0x"+e.toString(16)}function d(e){var t=[];e.forEach(function(e){t[e.name]={listeners:[],level:e.level}}),this.eventTarget=void 0,this.eventList=t}function u(){var e=navigator.mediaDevices,t=new d([{name:"devicechange",level:"info"}]);t.setEventTarget(e);var n=this;c(this,[["readOnlyAttributes",{rpcObjectType:"MediaDevices",actualMediaDevicesAddEventListener:e.addEventListener,actualMediaDevicesRemoveEventListener:e.removeEventListener,actualMediaDevicesGetUserMedia:e.getUserMedia,actualMediaDevicesEnumerateDevices:e.enumerateDevices,actualMediaDevicesGetDisplayMedia:e.getDisplayMedia}],["observableAttributes",[["ondevicechange",void 0,function(){o(n,"devicechange")}]]],["redirecting",!1],["mediaDevices",null],["audioInputDevice",null],["audioOutputDevice",null],["videoInputDevice",null],["localInputStream",null],["eventManager",t],["eventListeners",new a],["deviceList",""]]);e.addEventListener=function(){return n.addEventListener.apply(n,arguments)},e.removeEventListener=function(){return n.removeEventListener.apply(n,arguments)},e.getUserMedia=function(){return n.getUserMedia.apply(n,arguments)},e.enumerateDevices=function(){return n.enumerateDevices.apply(n,arguments)},e.getDisplayMedia=function(){return n.getDisplayMedia.apply(n,arguments)}}function l(e,t,n){var i=this,r=msRDCRTC.getNextRpcObjectId();y.debug("RTCPeerConnectionRedirector("+r+") - config: "+JSON.stringify(e)+", constraints: "+JSON.stringify(t)+", ext: "+JSON.stringify(n));var s=new d([{name:"negotiationneeded",level:"info"},{name:"icecandidate",level:"info"},{name:"icecandidateerror",level:"error"},{name:"signalingstatechange",level:"info"},{name:"iceconnectionstatechange",level:"info"},{name:"icegatheringstatechange",level:"info"},{name:"connectionstatechange",level:"info"},{name:"track",level:"info"},{name:"addstream",level:"info"},{name:"removestream",level:"info"},{name:"statsended",level:"info"}]);c(this,[["readOnlyAttributes",{rpcObjectType:"RTCPeerConnection",rpcObjectId:r,currentLocalDescription:null,pendingLocalDescription:null,currentRemoteDescription:null,pendingRemoteDescription:null,signalingState:"stable",iceGatheringState:"new",iceConnectionState:"new",connectionState:"new",canTrickleIceCandidates:null}],["observableAttributes",[["onnegotiationneeded",void 0,function(){o(i,"negotiationneeded")}],["onicecandidate",void 0,function(){o(i,"icecandidate")}],["onicecandidateerror",void 0,function(){o(i,"icecandidateerror")}],["onsignalingstatechange",void 0,function(){o(i,"signalingstatechange")}],["oniceconnectionstatechange",void 0,function(){o(i,"iceconnectionstatechange")}],["onicegatheringstatechange",void 0,function(){o(i,"icegatheringstatechange")}],["onconnectionstatechange",void 0,function(){o(i,"connectionstatechange")}],["ontrack",void 0,function(){o(i,"track")}],["onaddstream",void 0,function(){o(i,"addstream")}],["onremovestream",void 0,function(){o(i,"removestream")}],["onstatsended",void 0,function(){o(i,"statsended")}]]],["customAttributes",[["localDescription",function(){return i.getLocalDescription()},E],["remoteDescription",function(){return i.getRemoteDescription()},E]]],["eventManager",s],["eventListeners",new a],["configuration",e],["closed",!1],["senders",[]],["receivers",[]],["transceivers",[]],["defaultIceServers",[]],["sendCapabilities",{}],["recvCapabilities",{}],["operations",[]],["opExecutionScheduled",!1],["pendingOp",null],["ready",!1],["eventMap",{signalingstatechange:"signalingState",iceconnectionstatechange:"iceConnectionState",icegatheringstatechange:"iceGatheringState",connectionstatechange:"connectionState"}]]),0!==msRDCRTC.debugLevel&&(this.debugPeriodicCallback=function(){var e=performance.now(),t=i.pendingOp;if(null!=t&&void 0==t.completed){var n=e-t.started;n>=5e3?void 0==t.hung&&(y.error('RTCPeerConnectionRedirector "rpcObjectId":'+i.rpcObjectId+', "opName":'+t.name+', "opId":'+t.id+" has not completed after "+n.toFixed(4)+" ms"),t.hung=!0):n>=1e3&&void 0==t.warned&&(y.warn('RTCPeerConnectionRedirector "rpcObjectId":'+i.rpcObjectId+', "opName":'+t.name+', "opId":'+t.id+" has not completed after "+n.toFixed(4)+" ms"),t.warned=!0)}i.operations.forEach(function(t){var n=e-t.queued;n>=5e3?void 0==t.hung&&(y.error('RTCPeerConnectionRedirector "rpcObjectId":'+i.rpcObjectId+', "opName":'+t.name+', "opId":'+t.id+" has been waiting in the queue for "+n.toFixed(4)+" ms"),t.hung=!0):n>=1e3&&void 0==t.warned&&(y.warn('RTCPeerConnectionRedirector "rpcObjectId":'+i.rpcObjectId+', "opName":'+t.name+', "opId":'+t.id+" has been waiting in the queue for "+n.toFixed(4)+" ms"),t.warned=!0)})}),msRDCRTC.dtlsEnabled||(void 0==n&&(n={}),n["enable-dtls"]=!1),this.queueOperation("createPeerConnection",function(){return i.makeRpcCall("createPeerConnection",[e,t,n]).then(function(e){y.debug("RTCPeerConnectionRedirector("+i.rpcObjectId+")::createPeerConnection - sendCapabilities: "+JSON.stringify(e.sendCapabilities)),y.debug("RTCPeerConnectionRedirector("+i.rpcObjectId+")::createPeerConnection - recvCapabilities: "+JSON.stringify(e.recvCapabilities)),i.sendCapabilities=e.sendCapabilities,i.recvCapabilities=e.recvCapabilities,i.senders.forEach(function(e){e.readOnlyAttributes.capabilities=i.sendCapabilities}),i.ready=!0})})}function p(e,t,n,i){var r=this,s=void 0==t?msRDCRTC.getNextRpcObjectId():t;if(void 0==n&&(n=msRDCRTC.generateUuid()),y.debug("MediaStreamRedirector("+s+") - id: "+n+", devices: "+JSON.stringify(e)),c(this,[["readOnlyAttributes",{rpcObjectType:"MediaStream",rpcObjectId:s,id:n}],["observableAttributes",[["onaddtrack",void 0,function(){o(r,"addtrack")}],["onremovetrack",void 0,function(){o(r,"removetrack")}]]],["eventManager",new d([{name:"addtrack",level:"info"},{name:"removetrack",level:"info"}])],["eventListeners",new a],["audioTracks",[]],["videoTracks",[]],["devices",e]]),void 0===t&&(this.makeRpcCall("createMediaStream",[{id:this.id}]),void 0==i))for(var u in e){var l=new g(this,e[u]);this.addTrack(l)}}function g(e,t,n,i){var r=this,s=void 0==n?msRDCRTC.getNextRpcObjectId():n;void 0==i&&(i=msRDCRTC.generateUuid());var u=null;if("audioinput"===t.kind||"audiooutput"===t.kind)u="audio";else{if("videoinput"!==t.kind)throw new Error({name:"MSRDCRTC: E_NOTIMPL",message:"device not supported - kind="+t.kind});u="video"}y.debug("MediaStreamTrackRedirector("+s+") - id: "+i+", kind: "+u+", stream rpcObjectId: "+e.rpcObjectId);var l=new d([{name:"mute",level:"info"},{name:"unmute",level:"info"},{name:"ended",level:"info"},{name:"overconstrained",level:"warn"}]);c(this,[["readOnlyAttributes",{rpcObjectType:"MediaStreamTrack",rpcObjectId:s,mediaStreamRpcObjectId:e.rpcObjectId,deviceRpcObjectId:t.rpcObjectId,kind:u,id:i,label:t.label,muted:!1,readyState:"live"}],["observableAttributes",[["enabled",!0,function(){r.onEnabledAttributeChanged()}],["onmute",void 0,function(){o(r,"mute")}],["onunmute",void 0,function(){o(r,"unmute")}],["onended",void 0,function(){o(r,"ended")}],["onoverconstrained",void 0,function(){o(r,"overconstrained")}]]],["mediaStream",e],["device",t],["eventManager",l],["eventListeners",new a]]),void 0==n&&this.makeRpcCall("createMediaStreamTrack",[{mediaStreamRpcObjectId:e.rpcObjectId,id:this.id,kind:this.kind,label:this.label}])}function h(e,t,n,i){var r=msRDCRTC.getNextRpcObjectId();y.debug("RTCRtpSenderRedirector("+r+") - kind: "+t.kind+", pc rpcObjectId: "+e.rpcObjectId),c(this,[["readOnlyAttributes",{rpcObjectType:"RTCRtpSender",rpcObjectId:r,track:t,kind:t.kind,transport:null,rtcpTransport:null}],["ready",!1],["peerConnection",e],["streams",n],["sendEncodings",i],["parameters",null],["capabilities",e.sendCapabilities]])}function v(e,t,n,i){var r=void 0==n?msRDCRTC.getNextRpcObjectId():n;y.debug("RTCRtpReceiverRedirector("+r+") - kind: "+t+", pc rpcObjectId: "+e.rpcObjectId),c(this,[["readOnlyAttributes",{rpcObjectType:"RTCRtpReceiver",rpcObjectId:r,track:void 0==i?null:i,kind:t,transport:null,rtcpTransport:null}],["peerConnection",e],["parameters",null],["contributingSources",[]],["synchronizationSources",[]],["capabilities",e.recvCapabilities]])}function f(e,t,n,i){var r=msRDCRTC.getNextRpcObjectId();y.debug("RTCRtpTransceiverRedirector("+r+") - pc rpcObjectId: "+e.rpcObjectId),c(this,[["readOnlyAttributes",{rpcObjectType:"RTCRtpTransceiver",rpcObjectId:r,mid:null,sender:t,receiver:n,stopped:!1,direction:i,currentDirection:null}],["peerConnection",e]])}function b(e,t){var n=this,i=msRDCRTC.getNextRpcObjectId();y.debug("MediaElementRedirector("+i+") - kind: "+e);var r=new d([{name:"loadstart",level:"info"},{name:"abort",level:"info"},{name:"emptied",level:"info"},{name:"stalled",level:"info"},{name:"play",level:"info"},{name:"pause",level:"info"},{name:"loadedmetadata",level:"info"},{name:"loadeddata",level:"info"},{name:"waiting",level:"info"},{name:"playing",level:"info"},{name:"canplay",level:"info"},{name:"canplaythrough",level:"info"},{name:"ended",level:"info"},{name:"durationchange",level:"info"},{name:"volumechange",level:"info"},{name:"timeupdate",level:"ignore"},{name:"progress",level:"ignore"},{name:"contextmenu",level:"info"},{name:"error",level:"error"}]);r.setEventTarget(t);var s=function(e){return n.getAttribute(e)},u=function(e){return n.getReadOnlyAttribute(e)},l=function(e,t){return n.setAttribute(e,t)};c(this,[["readOnlyAttributes",{rpcObjectType:"MediaElement",rpcObjectId:i,kind:e,duration:Number.NaN,readyState:this.HAVE_NOTHING,networkState:this.NETWORK_EMPTY,paused:t.paused,currentTime:0,ended:!1}],["redirecting",!1],["mediaElement",t],["eventManager",r],["eventListeners",new a],["actualGetAttribute",t.getAttribute],["actualSetAttribute",t.setAttribute],["actualRemoveAttribute",t.removeAttribute],["actualAddEventListener",t.addEventListener],["actualRemoveEventListener",t.removeEventListener],["actualPlay",t.play],["actualPause",t.pause],["actualLoad",t.load],["actualSetSinkId",t.setSinkId],["getAttributeFunctor",s],["setAttributeFunctor",l],["removeAttributeFunctor",function(e){return n.removeAttribute(e)}],["addEventListenerFunctor",function(e,t,i){return n.addEventListener(e,t,i)}],["removeEventListenerFunctor",function(e,t,i){return n.removeEventListener(e,t,i)}],["onResizeFunctor",function(){return n.onPositionChanged("onresize")}],["playFunctor",function(){return n.play()}],["pauseFunctor",function(){return n.pause()}],["loadFunctor",function(){return n.load()}],["setSinkIdFunctor",function(e){return n.setSinkId(e)}],["srcObject",null],["autoplay",t.autoplay],["muted",t.muted],["volume",t.volume],["lastPlayAt",0],["progressIntervalId",void 0],["boundingRect",void 0]]),c(t,[["customAttributes",[["currentSrc",u,E],["networkState",u,E],["buffered",u,E],["readyState",u,E],["seeking",u,E],["duration",u,E],["paused",u,E],["seekable",u,E],["ended",u,E],["error",u,E],["sinkId",u,E],["src",s,D],["preload",s,I],["currentTime",s,D],["defaultPlaybackRate",s,I],["playbackRate",s,I],["played",s,E],["loop",s,I],["srcObject",s,l],["autoplay",s,l],["muted",s,l],["volume",s,l]]],["observableAttributes",[["onloadstart",void 0,function(){o(n,"loadstart")}],["onsuspend",void 0,function(){o(n,"suspend")}],["onabort",void 0,function(){o(n,"abort")}],["onemptied",void 0,function(){o(n,"emptied")}],["onstalled",void 0,function(){o(n,"stalled")}],["onplay",void 0,function(){o(n,"play")}],["onpause",void 0,function(){o(n,"pause")}],["onloadedmetadata",void 0,function(){o(n,"loadedmetadata")}],["onwaiting",void 0,function(){o(n,"waiting")}],["onplaying",void 0,function(){o(n,"playing")}],["oncanplay",void 0,function(){o(n,"canplay")}],["oncanplaythrough",void 0,function(){o(n,"canplaythrough")}],["onended",void 0,function(){o(n,"ended")}],["ondurationchange",void 0,function(){o(n,"durationchange")}],["onvolumechange",void 0,function(){o(n,"volumechange")}],["ontimeupdate",void 0,function(){o(n,"timeupdate")}],["onprogress",void 0,function(){o(n,"progress")}],["oncontextmenu",void 0,function(){o(n,"contextmenu")}],["onerror",void 0,function(){o(n,"error")}]]]]);var p=[e];if("video"===e){c(t,[["observableAttributes",[["clientHeight",t.clientHeight,function(){n.onPositionChanged("clientHeight")}],["clientLeft",t.clientLeft,function(){n.onPositionChanged("clientLeft")}],["clientTop",t.clientTop,function(){n.onPositionChanged("clientTop")}],["clientWidth",t.clientWidth,function(){n.onPositionChanged("clientWidth")}],["data-vdi_videoid",t["data-vdi_videoid"],function(){n.onVdiVideoIdChanged()}],["offsetHeight",t.offsetHeight,function(){n.onPositionChanged("offsetHeight")}],["offsetLeft",t.offsetLeft,function(){n.onPositionChanged("offsetLeft")}],["offsetParent",t.offsetParent,function(){n.onPositionChanged("offsetParent")}],["offsetTop",t.offsetTop,function(){n.onPositionChanged("offsetTop")}],["offsetWidth",t.offsetWidth,function(){n.onPositionChanged("offsetWidth")}],["parentElement",t.parentElement,function(){n.onPositionChanged("parentElement")}],["parentNode",t.parentNode,function(){n.onPositionChanged("parentNode")}],["style",t.style,function(){n.onPositionChanged("style")}]]]]);var g=t.getBoundingClientRect();y.debug("MediaElementRedirector("+i+") - bounding client rect: "+JSON.stringify(g)),this.boundingRect=g,p.push({top:g.top,right:g.right,bottom:g.bottom,left:g.left})}this.makeRpcCall("createMediaElement",p)}function m(e,t){var n=(e+t).replace(/-/g,"").match(/[0-9a-f]{2}/gi),i=new ArrayBuffer(n.length),r=new Uint8Array(i);for(var c in n)r[c]=parseInt(n[c],16);this.rawKey=i,this.key=void 0}function R(){this.redirecting=!1,this.vmEventCallback=void 0,this.dtlsEnabled=!0,this.socket=null,this.socketConnected=!1,this.socketClosed=!0,this.rtcSessionStarted=!1,this.debugLevel=0,this.ActualRTCPeerConnection=RTCPeerConnection,this.pendingMessages=[],this.outstandingRpcCalls=new a,this.mediaDevicesRedirector=new u,this.rtcObjects=[this.mediaDevicesRedirector],this.nextPeerConnectionId=1,this.nextVideoElementId=1,this.nextRpcObjectId=1,this.nextRpcCallId=1,this.nextOperationId=1,this.uniqueIds=new a;var e=document.createElement("audio");e.autoplay=!0,e.loop=!0,this.audioElement=e;var t=this;this.onWebSocketOpenFunctor=function(e){t.onWebSocketOpen(e)},this.onWebSocketClosedFunctor=function(e){t.onWebSocketClosed(e)},this.onWebSocketErrorFunctor=function(e){t.onWebSocketError(e)},this.onWebSocketMessageFunctor=function(e){t.onWebSocketMessage(e)}}var C,O={debug:function(){},info:function(e){C.info("MSRDCRTC: [I] "+e)},warn:function(e){C.warn("MSRDCRTC: [W] "+e)},error:function(e){C.error("MSRDCRTC: [E] "+e)}},S={debug:function(e){C.debug("MSRDCRTC: [D] "+e)},info:function(e){C.info("MSRDCRTC: [I] "+e)},warn:function(e){C.warn("MSRDCRTC: [W] "+e)},error:function(e){C.error("MSRDCRTC: [E] "+e)}},T={debug:function(e){console.debug("MSRDCRTC: [D] "+e)},info:function(e){console.info("MSRDCRTC: [I] "+e)},warn:function(e){console.warn("MSRDCRTC: [W] "+e)},error:function(e){console.error("MSRDCRTC: [E] "+e)}},y=O,I=function(){},E=function(){throw new TypeError},D=function(){throw new InvalidStateError};return a.prototype={forEach:function(e){for(var t in this)this.hasOwnProperty(t)&&e(t)},get:function(e){return this[e]},has:function(e){return void 0!=this[e]},keys:function(){var e=[];return this.forEach(function(t){e.push(t)}),e},values:function(){var e=[],t=this;return this.forEach(function(n){e.push(t.get(n))}),e},getSize:function(){return this.keys().length()}},d.prototype={addEventListener:function(e,t,n){var i=this.eventList[e];if(void 0==i)throw new Error({name:"MSRDCRTC: Error",message:"Event not expected: "+e});i.listeners.push(t)},removeEventListener:function(e,t,n){var i=this.eventList[e];if(void 0==i)throw new Error({name:"MSRDCRTC: Error",message:"Event not expected: "+e});var r=i.listeners;for(var c in r)if(r[c]===t){r.splice(c,1);break}},setEventTarget:function(e){this.eventTarget=e},fireEvent:function(e,t){var n=this.eventList[e];if(void 0==n)return y.warn("event not expected: "+e),!1;var i=n.level;"ignore"!==i&&("debug"===i?y.debug:"info"===i?y.info:"warn"===i?y.warn:y.error)("EventManager::fireEvent('"+e+"')");var r=document.createEvent("HTMLEvents");if(r.initEvent(e,!1,!0),void 0!=t)for(var c in t)r[c]=t[c];if(void 0!=this.eventTarget)this.eventTarget.dispatchEvent(r);else{n.listeners.forEach(function(e){e(r)})}return!0}},u.prototype={enableRedirection:function(){this.redirecting=!0},disableRedirection:function(){this.redirecting=!1,this.mediaDevices=null,this.audioInputDevice=null,this.audioOutputDevice=null,this.videoInputDevice=null,this.localInputStream=null,this.localInputDevices=[],this.eventManager.fireEvent("devicechange")},addEventListener:function(e,t,n){y.debug("MediaDevicesRedirector adding event listener for: "+e),this.eventManager.addEventListener(e,t,n),this.actualMediaDevicesAddEventListener.apply(navigator.mediaDevices,arguments)},removeEventListener:function(e,t,n){y.debug("MediaDevicesRedirector removing event listener for: "+e),this.eventManager.removeEventListener(e,t,n),this.actualMediaDevicesRemoveEventListener.apply(navigator.mediaDevices,arguments)},enumerateDevices:function(){if(y.debug("MediaDevicesRedirector::enumerateDevices("+JSON.stringify(arguments)+")"),!this.redirecting)return y.info("passing through call to actual MediaDevices.enumerateDevices"),this.actualMediaDevicesEnumerateDevices.apply(navigator.mediaDevices,arguments);var e=this;return null!=this.mediaDevices?new Promise(function(t,n){y.debug("MediaDevicesRedirector::enumerateDevices returning: "+JSON.stringify(e.mediaDevices)),t(e.mediaDevices)}):new Promise(function(t,n){e.makeRpcCall("enumerateDevices",arguments).then(function(n){e.onEnumerateDevices(n),y.debug("MediaDevicesRedirector::enumerateDevices returning: "+JSON.stringify(n)),t(n)}).catch(function(e){n(e)})})},onEnumerateDevices:function(e){var t=JSON.stringify(e);if(t!==this.deviceList){this.deviceList=t,this.mediaDevices=e,this.audioInputDevice=null,this.audioOutputDevice=null,this.videoInputDevice=null,this.localInputStream=null,this.localInputDevices=[];for(var n in e){var i=e[n];if("audioinput"===i.kind&&null==this.audioInputDevice?this.audioInputDevice=i:"audiooutput"===i.kind&&null==this.audioOutputDevice?this.audioOutputDevice=i:"videoinput"===i.kind&&null==this.videoInputDevice&&(this.videoInputDevice=i),null!=this.audioInputDevice&&null!=this.audioOutputDevice&&null!=this.videoInputDevice)break}this.eventManager.fireEvent("devicechange")}},getUserMedia:function(){if(y.debug("MediaDevicesRedirector::getUserMedia("+JSON.stringify(arguments)+")"),!this.redirecting)return y.info("passing through call to actual MediaDevices.getUserMedia"),this.actualMediaDevicesGetUserMedia.apply(navigator.mediaDevices,arguments);var e,t,n;if(arguments.length<=1?e=arguments[0]:(e=arguments[0],t=arguments[1],n=arguments[2]),void 0==e||0===Object.keys(e).length)throw new TypeError("getUserMedia() constraints must not be the empty set.");var i=!1,r=!1;!0===e||e.audio&&e.video?(i=!0,r=!0):e.audio?i=!0:e.video&&(r=!0);var c=this;return void 0!=c.localInputStream&&null!=c.localInputStream?new Promise(function(e,n){y.debug("MediaDevicesRedirector::getUserMedia returning: "+JSON.stringify(c.localInputStream)),void 0!==t?(t(c.localInputStream),e()):e(c.localInputStream)}):null==c.mediaDevices?new Promise(function(e,o){c.enumerateDevices().then(function(a){if(i&&c.localInputDevices.push(c.audioInputDevice),r&&c.localInputDevices.push(c.videoInputDevice),void 0!==c.localInputDevices&&c.localInputDevices.length>0)c.localInputStream=new p(c.localInputDevices),y.debug("MediaDevicesRedirector::getUserMedia returning: "+JSON.stringify(c.localInputStream)),void 0!==t?(t(c.localInputStream),e()):e(c.localInputStream);else{var s=new Error({name:"MSRDCRTC Error",message:"No audio or video input device found."});void 0!=n&&n(s),o(s)}}).catch(function(e){o(e)})}):new Promise(function(e,o){if(i&&c.localInputDevices.push(c.audioInputDevice),r&&c.localInputDevices.push(c.videoInputDevice),null!=c.localInputDevices&&c.localInputDevices.length>0)c.localInputStream=new p(c.localInputDevices),void 0!=t?(t(c.localInputStream),e()):e(c.localInputStream);else{var a=new Error({name:"MSRDCRTC Error",message:"No audio input device found."});void 0!=n&&n(a),o(a)}})},getDisplayMedia:function(){return y.debug("MediaDevicesRedirector::getUserMedia("+JSON.stringify(arguments)+")"),this.redirecting?this.makeRpcCall("getDisplayMedia",arguments):(y.info("passing through call to actual MediaDevices.getDisplayMedia"),this.actualMediaDevicesGetDisplayMedia.apply(navigator.mediaDevices))},onDeviceChange:function(e){this.onEnumerateDevices(e.mediaDevices)},onRpcEventNotification:function(e){var t=!1;return e.rpcEventTarget.rpcObjectType===this.rpcObjectType&&"devicechange"===e.rpcEventName&&(this.onDeviceChange(e.rpcEventArgs),t=!0),t},makeRpcCall:function(e,t,n){return msRDCRTC.makeRpcCall({rpcObjectType:this.rpcObjectType,rpcName:e,rpcArgs:t},n)}},l.prototype={addEventListener:function(e,t,n){y.debug("adding event listener for: "+e),this.eventManager.addEventListener(e,t,n)},removeEventListener:function(e,t,n){y.debug("removing event listener for: "+e),this.eventManager.removeEventListener(e,t,n)},createOffer:function(){y.debug("RTCPeerConnectionRedirector("+this.rpcObjectId+")::createOffer("+JSON.stringify(arguments)+")");var e,t,n;arguments.length<=1?e=arguments[0]:(t=arguments[0],n=arguments[1],e=arguments[2]);var i=this;return new Promise(function(r,c){i.queueOperation("createOffer",function(){return i.makeRpcCall("createOffer",[e]).then(function(e){void 0!=t?(y.debug("RTCPeerConnectionRedirector("+i.rpcObjectId+")::createOffer - returning: "+JSON.stringify(e.desc)),t(e.desc),r()):r(e.desc)}).catch(function(e){void 0!=n&&n(e),c(e)})})})},createAnswer:function(){if(y.debug("RTCPeerConnectionRedirector("+this.rpcObjectId+")::createAnswer("+JSON.stringify(arguments)+")"),this.closed)return new Promise(function(e,t){t(new InvalidStateError)});var e,t,n;arguments.length<=1?e=arguments[0]:(t=arguments[0],n=arguments[1]);var i=this;return new Promise(function(r,c){i.queueOperation("createAnswer",function(){return i.makeRpcCall("createAnswer",[e]).then(function(e){void 0!=t?(y.debug("RTCPeerConnectionRedirector("+i.rpcObjectId+")::createAnswer - returning: "+JSON.stringify(e.desc)),t(e.desc),r()):r(e.desc)}).catch(function(e){void 0!=n&&n(e),c(e)})})})},setLocalDescription:function(){if(y.debug("RTCPeerConnectionRedirector("+this.rpcObjectId+")::setLocalDescription("+JSON.stringify(arguments)+")"),this.closed)return new Promise(function(e,t){t(new InvalidStateError)});var e,t,n=arguments[0];arguments.length>1&&(e=arguments[1],t=arguments[2]),this.readOnlyAttributes.pendingLocalDescription=n;var i=this;return new Promise(function(r,c){i.queueOperation("setLocalDescription",function(){return i.makeRpcCall("setLocalDescription",[n]).then(function(t){i.readOnlyAttributes.currentLocalDescription=n,i.readOnlyAttributes.pendingLocalDescription=null,void 0!=e&&(y.debug("RTCPeerConnectionRedirector("+i.rpcObjectId+")::setLocalDescription - calling successCallback"),e()),r()}).catch(function(e){i.readOnlyAttributes.pendingLocalDescription=null,void 0!=t&&t(e),c(e)})})})},setRemoteDescription:function(){if(y.debug("RTCPeerConnectionRedirector("+this.rpcObjectId+")::setRemoteDescription("+JSON.stringify(arguments)+")"),this.closed)return new Promise(function(e,t){t(new InvalidStateError)});var e,t,n=arguments[0];arguments.length>1&&(e=arguments[1],t=arguments[2]),n.sdp.match(/\ba=crypto:/)&&n.sdp.match(/\ba=fingerprint:/)&&(n.sdp=n.sdp.replace(/\ba=crypto:.*\r\n/g,""),y.warn("RTCPeerConnectionRedirector("+this.rpcObjectId+") - SDP "+n.type+" has both SDES and DTLS-SRTP, removing SDES: "+JSON.stringify(n.sdp))),this.readOnlyAttributes.pendingRemoteDescription=n;var i=this;return new Promise(function(r,c){i.queueOperation("setRemoteDescription",function(){var o=0;n.sdp.match(/\bm=audio /)&&o++,n.sdp.match(/\bm=video /)&&o++,n.sdp.match(/\bm=data /)&&o++;for(var a=new Array,s=0;s<3*o;++s)a.push(msRDCRTC.getNextRpcObjectId());return i.makeRpcCall("setRemoteDescription",[n,a]).then(function(t){i.readOnlyAttributes.currentRemoteDescription=n,i.readOnlyAttributes.pendingRemoteDescription=null,void 0!=e&&(y.debug("RTCPeerConnectionRedirector("+i.rpcObjectId+")::setRemoteDescription - calling successCallback"),e()),r()}).catch(function(e){i.readOnlyAttributes.pendingRemoteDescription=null,void 0!=t&&t(e),c(e)})})})},addIceCandidate:function(){if(y.debug("RTCPeerConnectionRedirector("+this.rpcObjectId+")::addIceCandidate("+JSON.stringify(arguments)+")"),this.closed)return new Promise(function(e,t){t(new InvalidStateError)});var e,t,n=arguments[0];arguments.length>1&&(e=arguments[1],t=arguments[2]);var i=this;return new Promise(function(r,c){i.queueOperation("addIceCandidate",function(){return i.makeRpcCall("addIceCandidate",[n]).then(function(t){y.debug("RTCPeerConnectionRedirector("+i.rpcObjectId+")::addIceCandidate - updating remoteDescription: "+JSON.stringify(t.result)),i.remoteDescription=t.result,void 0!=e&&(y.debug("RTCPeerConnectionRedirector("+i.rpcObjectId+")::addIceCandidate - calling successCallback"),e()),r()}).catch(function(e){void 0!=t&&t(e),c(e)})})})},getDefaultIceServers:function(){return y.debug("RTCPeerConnectionRedirector("+this.rpcObjectId+")::getDefaultIceServers("+JSON.stringify(arguments)+")"),y.debug("RTCPeerConnectionRedirector("+this.rpcObjectId+")::getDefaultIceServers returning: "+JSON.stringify(this.defaultIceServers)),this.defaultIceServers},getConfiguration:function(){return y.debug("RTCPeerConnectionRedirector("+this.rpcObjectId+")::getConfiguration("+JSON.stringify(arguments)+")"),y.debug("RTCPeerConnectionRedirector("+this.rpcObjectId+")::getConfiguration returning: "+JSON.stringify(this.configuration)),this.configuration},setConfiguration:function(e){y.debug("RTCPeerConnectionRedirector("+this.rpcObjectId+")::setConfiguration("+JSON.stringify(arguments)+")"),this.configuration=e;var t=this;this.queueOperation("setConfiguration",function(){return t.makeRpcCall("setConfiguration",[e]).then(function(){t.configuration=e})})},close:function(){if(y.debug("RTCPeerConnectionRedirector("+this.rpcObjectId+")::close("+JSON.stringify(arguments)+")"),!this.closed){var e=this;this.queueOperation("close",function(){return e.makeRpcCall("close").finally(function(){e.closed=!0})})}},getSenders:function(){return y.debug("RTCPeerConnectionRedirector("+this.rpcObjectId+")::getSenders("+JSON.stringify(arguments)+")"),y.debug("RTCPeerConnectionRedirector("+this.rpcObjectId+")::getSenders returning: "+JSON.stringify(this.senders)),this.senders},getReceivers:function(){return y.debug("RTCPeerConnectionRedirector("+this.rpcObjectId+")::getReceivers("+JSON.stringify(arguments)+")"),y.debug("RTCPeerConnectionRedirector("+this.rpcObjectId+")::getReceivers returning: "+JSON.stringify(this.receivers)),this.receivers},getTransceivers:function(){return y.debug("RTCPeerConnectionRedirector("+this.rpcObjectId+")::getTransceivers("+JSON.stringify(arguments)+")"),y.debug("RTCPeerConnectionRedirector("+this.rpcObjectId+")::getTransceivers returning: "+JSON.stringify(this.transceivers)),this.transceivers},addStream:function(e){y.debug("RTCPeerConnectionRedirector("+this.rpcObjectId+")::addStream("+JSON.stringify(arguments)+")");var t=this;e.getTracks().forEach(function(n){t.internalAddTrack(n,e)})},removeStream:function(){y.error("RTCPeerConnectionRedirector("+this.rpcObjectId+")::addStream("+JSON.stringify(arguments)+") - E_NOTIMPL")},addTrack:function(){return y.debug("RTCPeerConnectionRedirector("+this.rpcObjectId+")::addTrack("+JSON.stringify(arguments)+")"),this.internalAddTrack.apply(this,arguments)},removeTrack:function(e){y.debug("RTCPeerConnectionRedirector("+this.rpcObjectId+")::removeTrack("+JSON.stringify(arguments)+")");var t=this;this.queueOperation("removeTrack",function(){return t.makeRpcCall("removeTrack",[{senderRpcObjectId:e.rpcObjectId}])})},addTransceiver:function(e,t){y.debug("RTCPeerConnectionRedirector("+this.rpcObjectId+")::addTransceiver("+JSON.stringify(arguments)+")");var n={kind:"audio"},i=new f(this,new h(this,n,void 0,void 0),new v(this,n.kind),direction);this.transceivers.push(i);var r=this;return this.queueOperation("addTransceiver",function(){return r.makeRpcCall("addTransceiver",[e,t])}),i},createDTMFSender:function(){y.error("RTCPeerConnectionRedirector("+this.rpcObjectId+")::createDTMFSender("+JSON.stringify(arguments)+") - Not yet implemented")},getLocalStreams:function(){y.debug("RTCPeerConnectionRedirector("+this.rpcObjectId+")::getLocalStreams("+JSON.stringify(arguments)+")");var e=new Array;return this.senders.forEach(function(t){e=e.concat(t.streams)}),y.debug("RTCPeerConnectionRedirector("+this.rpcObjectId+")::getLocalStreams - returning: "+JSON.stringify(e)),e},getRemoteStreams:function(){y.debug("RTCPeerConnectionRedirector("+this.rpcObjectId+")::getRemoteStreams("+JSON.stringify(arguments)+")");var e=new Array;return this.receivers.forEach(function(t){e=e.concat(t.track.mediaStream)}),y.debug("RTCPeerConnectionRedirector("+this.rpcObjectId+")::getRemoteStreams - returning: "+JSON.stringify(e)),e},getStats:function(){if(this.closed)return new Promise(function(e,t){t(new InvalidStateError)});y.debug("RTCPeerConnectionRedirector("+this.rpcObjectId+")::getStats("+JSON.stringify(arguments)+")");var e,t;arguments.length>0&&void 0!=arguments[0]&&"function"==typeof arguments[0]?e=arguments[0]:t=arguments[0];var n={};void 0!=t&&(n={selectorRpcObjectType:t.rpcObjectType,selectorRpcObjectId:t.rpcObjectid});var i=this;if(!this.ready){var r=new a;return new Promise(function(t,n){void 0!=e?e(r):t(r)})}return new Promise(function(t,r){i.makeRpcCall("getStats",[n]).then(function(n){var i=new a;for(var r in n){var c=n[r];i[c.id]=c}if(void 0!=e){try{e(i)}catch(e){y.error("RTCPeerConnectionRedirector("+this.rpcObjectId+")::getStats - exception thrown from callback: "+e.toString())}t()}else t(i)}).catch(function(e){r(e)})})},setState:function(e,t,n){var i=this.readOnlyAttributes[e];i!==t&&(this.readOnlyAttributes[e]=t,y.debug("RTCPeerConnectionRedirector("+this.rpcObjectId+")::setState - "+e+" changed from: "+i+" to: "+t),this.eventManager.fireEvent(n))},setSignalingState:function(e){this.setState("signalingState",e,"signalingstatechange")},setIceConnectionState:function(e){this.setState("iceConnectionState",e,"iceconnectionstatechange")},setIceGatheringState:function(e){this.setState("iceGatheringState",e,"icegatheringstatechange")},setConnectionState:function(e){this.setState("connectionState",e,"connectionstatechange")},getLocalDescription:function(){var e=void 0!=this.readOnlyAttributes.pendingLocalDescription,t=this.readOnlyAttributes.pendingLocalDescription||this.readOnlyAttributes.currentLocalDescription;return y.debug("RTCPeerConnectionRedirector("+this.rpcObjectId+")::getLocalDescription - pending="+e+": "+JSON.stringify(t)),t},getRemoteDescription:function(){var e=void 0!=this.readOnlyAttributes.pendingRemoteDescription,t=this.readOnlyAttributes.pendingRemoteDescription||this.readOnlyAttributes.currentRemoteDescription;return y.debug("RTCPeerConnectionRedirector("+this.rpcObjectId+")::getRemoteDescription - pending="+e+": "+JSON.stringify(t)),t},getReceiverByRpcObjectId:function(e){var t=null;return this.receivers.some(function(n){return n.rpcObjectId==e&&(t=n),null!=t}),t},internalAddTrack:function(e,t){y.debug("RTCPeerConnectionRedirector("+this.rpcObjectId+")::internalAddTrack("+JSON.stringify(arguments)+")"),void 0!=t&&(t=(new Array).concat(t));var n=new h(this,e,t,void 0),i=this,r=new Array;return t.forEach(function(e){r.push(e.rpcObjectId)}),this.queueOperation("addTrack",function(){return i.makeRpcCall("addTrack",[{trackRpcObjectId:e.rpcObjectId,streamRpcObjectIds:r,senderRpcObjectId:n.rpcObjectId,remoteStreamRpcObjectId:msRDCRTC.getNextRpcObjectId(),remoteTrackRpcObjectId:msRDCRTC.getNextRpcObjectId(),receiverRpcObjectId:msRDCRTC.getNextRpcObjectId()}]).then(function(e){n.ready=!0})}),this.senders.push(n),n},onTrack:function(e){y.debug("RTCPeerConnectionRedirector("+this.rpcObjectId+')::onTrack - "rpcObjectId":'+this.rpcObjectId+" - "+JSON.stringify(e));var t=e.receiver,n=e.stream,i=e.track,r=new Array;this.getReceiverByRpcObjectId(t.rpcObjectId);var c=msRDCRTC.mediaDevicesRedirector.audioOutputDevice,o=new p([c],n.rpcObjectId,n.id),a=new g(o,c,i.rpcObjectId,i.id);o.addTrack(a);var s=new v(this,t.kind,t.rpcObjectId,a);this.receivers.push(s);var d={track:a,receiver:s,streams:r};return this.eventManager.fireEvent("addstream",{stream:o}),d},onIceCandidate:function(e){return y.debug("RTCPeerConnectionRedirector("+this.rpcObjectId+')::onIceCandidate - "rpcObjectId":'+this.rpcObjectId+" - updating localDescription: "+JSON.stringify(e.desc)),this.readOnlyAttributes.currentLocalDescription=e.desc,e},queueOperation:function(e,t){var n=this.operations.length,i={id:msRDCRTC.getNextOperationId(),name:e,op:t,queued:performance.now(),started:void 0,completed:void 0};y.debug("RTCPeerConnectionRedirector("+this.rpcObjectId+')::queueOperation - "rpcObjectId":'+this.rpcObjectId+', "opName":'+i.name+', "opId":'+i.id+", "+n+" operation"+(1!==n?"s":"")+" ahead in queue"),this.operations.push(i),this.scheduleNextOperation()},scheduleNextOperation:function(e){if(!this.opExecutionScheduled&&null==this.pendingOp&&this.operations.length>0){this.opExecutionScheduled=!0;var t=this;window.setTimeout(function(){t.executeNextOperation()},0)}},executeNextOperation:function(){this.opExecutionScheduled=!1;var e=this.operations.shift();if(void 0!=e)if(null==this.pendingOp){this.pendingOp=e;var t=this;e.started=performance.now();var n=e.started-e.queued;(n>=5e3?y.error:n>=1e3?y.warn:y.debug)("RTCPeerConnectionRedirector("+this.rpcObjectId+')::executeNextOperation - "rpcObjectId":'+this.rpcObjectId+', "opName":'+e.name+', "opId":'+e.id+" is starting after waiting in queue for "+n.toFixed(4)),e.op().then(function(){e.completed=performance.now();var n=e.started-e.queued,i=e.completed-e.started;(n>=5e3||i>=5e3?y.error:n>=1e3||i>=1e3?y.warn:y.debug)('RTCPeerConnectionRedirector "rpcObjectId":'+t.rpcObjectId+', "opName":'+e.name+', "opId":'+e.id+" took "+i.toFixed(4)+" ms, after sitting in the queue for "+n.toFixed(4)+" ms")}).finally(function(){t.pendingOp=null,t.scheduleNextOperation()})}else y.error("RTCPeerConnectionRedirector("+this.rpcObjectId+')::executeNextOperation "rpcObjectId":'+this.rpcObjectId+" was called while an operation was pending.");else void 0!=e&&y.debug('RTCPeerConnectionRedirector "rpcObjectId":'+this.rpcObjectId+" is closed - dropping operation")},onRpcEventNotification:function(e){var t=!1,n=e.rpcEventTarget,i=e.rpcEventArgs;if(n.rpcObjectType===this.rpcObjectType&&n.rpcObjectId===this.rpcObjectId){var r=e.rpcEventName,c=i&&i.state;if(void 0!=c){var o=this.eventMap[r];void 0!=o&&(this.setState(o,c,r),t=!0)}t||("track"===r?i=this.onTrack(i):"icecandidate"===r&&(i=this.onIceCandidate(i)),t=this.eventManager.fireEvent(r,i))}else"RTCRtpReceiver"===n.rpcObjectType&&this.getReceivers().forEach(function(n){void 0!=n.onRpcEventNotification&&n.onRpcEventNotification(e)&&(t=!0)});return t},makeRpcCall:function(e,t,n){return msRDCRTC.makeRpcCall({rpcObjectType:this.rpcObjectType,rpcObjectId:this.rpcObjectId,rpcName:e,rpcArgs:t},n)}},p.prototype={addEventListener:function(e,t,n){y.debug("MediaStreamRedirector("+this.rpcObjectId+") - adding event listener for: "+e),this.eventManager.addEventListener(e,t,n)},removeEventListener:function(e,t,n){y.debug("MediaStreamRedirector("+this.rpcObjectId+") - removing event listener for: "+e),this.eventManager.removeEventListener(e,t,n)},getAudioTracks:function(){return y.debug("MediaStreamRedirector("+this.rpcObjectId+")::getAudioTracks("+JSON.stringify(arguments)+")"),y.debug("MediaStreamRedirector("+this.rpcObjectId+")::getAudioTracks returning: "+JSON.stringify(this.audioTracks)),this.audioTracks},getVideoTracks:function(){return y.debug("MediaStreamRedirector("+this.rpcObjectId+")::getVideoTracks("+JSON.stringify(arguments)+")"),y.debug("MediaStreamRedirector("+this.rpcObjectId+")::getVideoTracks returning: "+JSON.stringify(this.videoTracks)),this.videoTracks},getTracks:function(){y.debug("MediaStreamRedirector("+this.rpcObjectId+")::getTracks("+JSON.stringify(arguments)+")");var e=this.audioTracks.concat(this.videoTracks);return y.debug("MediaStreamRedirector("+this.rpcObjectId+")::getTracks returning: "+JSON.stringify(e)),e},getTrackById:function(e){y.debug("MediaStreamRedirector("+this.rpcObjectId+")::getTrackById("+JSON.stringify(arguments)+")");var t=null;for(var n in this.audioTracks)if(n.id===e){t=n;break}if(null==t)for(var n in this.videoTracks)if(n.id===e){t=n;break}return y.debug("MediaStreamRedirector("+this.rpcObjectId+")::getTrackById returning: "+JSON.stringify(t)),t},addTrack:function(e){y.debug("MediaStreamRedirector("+this.rpcObjectId+")::addTrack("+JSON.stringify(arguments)+")"),null==this.getTrackById(e.id)&&("audio"===e.kind?this.audioTracks.push(e):"video"===e.kind&&this.videoTracks.push(e),this.eventManager.fireEvent("addtrack"))},removeTrack:function(e){if(y.debug("MediaStreamRedirector("+this.rpcObjectId+")::removeTrack("+JSON.stringify(arguments)+")"),null!=this.getTrackById(e.id)){var t=null;"audio"===e.kind?t=this.audioTracks:"video"===e.kind&&(t=this.videoTracks);var n=e.id;for(var i in t)if(t[i].id===n){t.splice(i,1);break}this.eventManager.fireEvent("removetrack")}},clone:function(){y.debug("MediaStreamRedirector("+this.rpcObjectId+")::clone");var e=new p(this.devices,void 0,void 0,"cloning");return this.getTracks().forEach(function(t){var n=t.internalClone(e);e.addTrack(n)}),y.debug("MediaStreamRedirector("+this.rpcObjectId+")::clone - returning: "+JSON.stringify(e)),e},onRpcEventNotification:function(e){var t=!1,n=e.rpcEventTarget;return n.rpcObjectType===this.rpcObjectType&&n.rpcObjectId===this.rpcObjectId&&(t=this.eventManager.fireEvent(e.rpcEventName,e.rpcEventArgs)),t},makeRpcCall:function(e,t,n){return msRDCRTC.makeRpcCall({rpcObjectType:this.rpcObjectType,rpcObjectId:this.rpcObjectId,rpcName:e,rpcArgs:t},n)}},g.prototype={addEventListener:function(e,t,n){y.debug("MediaStreamTrackRedirector("+this.rpcObjectId+") - adding event listener for: "+e),this.eventManager.addEventListener(e,t,n)},removeEventListener:function(e,t,n){y.debug("MediaStreamTrackRedirector("+this.rpcObjectId+") - removing event listener for: "+e),this.eventManager.removeEventListener(e,t,n)},clone:function(){y.debug("MediaStreamTrackRedirector("+this.rpcObjectId+")::clone");var e=this.internalClone(this.mediaStream);return y.debug("MediaStreamTrackRedirector("+this.rpcObjectId+")::clone - returning: "+JSON.stringify(e)),e},internalClone:function(e){y.debug("MediaStreamTrackRedirector("+this.rpcObjectId+")::clone");var t=new g(e,this.device);return t.readOnlyAttributes.readyState=this.readyState,t.observableAttributes.enabled=this.observableAttributes.enabled,y.debug("MediaStreamTrackRedirector("+this.rpcObjectId+")::clone - returning: "+JSON.stringify(t)),t},stop:function(){y.debug("MediaStreamTrackRedirector("+this.rpcObjectId+")::stop("+JSON.stringify(arguments)+")"),this.setReadyState("ended"),this.makeRpcCall("stop")},getCapabilities:function(){y.debug("MediaStreamTrackRedirector("+this.rpcObjectId+")::getCapabilities("+JSON.stringify(arguments)+")")},getConstraints:function(){y.debug("MediaStreamTrackRedirector("+this.rpcObjectId+")::getConstraints("+JSON.stringify(arguments)+")")},getSettings:function(){y.debug("MediaStreamTrackRedirector("+this.rpcObjectId+")::getSettings("+JSON.stringify(arguments)+")")},applyConstraints:function(e){y.debug("MediaStreamTrackRedirector("+this.rpcObjectId+")::applyConstraints("+JSON.stringify(arguments)+")");var t=this;return new Promise(function(n,i){t.makeRpcCall("applyConstraints",e).then(function(e){n()}).catch(function(e){i(e)})})},setReadyState:function(e){var t=this.readyState;t!==e&&(this.readOnlyAttributes.readyState=e,y.debug("MediaStreamTrackRedirector("+this.rpcObjectId+")::setReadyState - old="+t+", new="+e),"ended"===e&&this.eventManager.fireEvent("ended"))},onEnabledAttributeChanged:function(){y.debug("MediaStreamTrackRedirector("+this.rpcObjectId+")::onEnabledAttributeChanged("+JSON.stringify(arguments)+")"),"ended"!==this.readyState&&this.makeRpcCall("onEnabledAttributeChanged",[this.enabled])},onRpcEventNotification:function(e){var t=!1,n=e.rpcEventTarget;return n.rpcObjectType===this.rpcObjectType&&n.rpcObjectId===this.rpcObjectId&&(t=this.eventManager.fireEvent(e.rpcEventName,e.rpcEventArgs)),t},makeRpcCall:function(e,t,n){return msRDCRTC.makeRpcCall({rpcObjectType:this.rpcObjectType,rpcObjectId:this.rpcObjectId,rpcName:e,rpcArgs:t},n)}},h.prototype={getCapabilities:function(e){y.debug("RTCRtpSenderRedirector("+this.rpcObjectId+")::getCapabilities("+JSON.stringify(arguments)+")");var t="audio"===e?this.capabilities.audio:"video"===e?this.capabilities.video:{};y.debug("RTCRtpSenderRedirector("+this.rpcObjectId+")::getCapabilities returning: "+JSON.stringify(t))},setParameters:function(e){return y.debug("RTCRtpSenderRedirector("+this.rpcObjectId+")::setParameters("+JSON.stringify(arguments)+")"),this.parameters=e,this.makeRpcCall("setParameters",[e])},getParameters:function(){return y.debug("RTCRtpSenderRedirector("+this.rpcObjectId+")::getParameters("+JSON.stringify(arguments)+")"),y.debug("RTCRtpSenderRedirector("+this.rpcObjectId+")::getParameters returning: "+JSON.stringify(this.parameters)),this.parameters},replaceTrack:function(e){return y.debug("RTCRtpSenderRedirector("+this.rpcObjectId+")::replaceTrack("+JSON.stringify(arguments)+")"),this.ready||y.debug("RTCRtpSenderRedirector("+this.rpcObjectId+")::replaceTrack called before we are ready"),this.makeRpcCall("replaceTrack",[e])},setStreams:function(e){return y.debug("RTCRtpSenderRedirector("+this.rpcObjectId+")::setStreams("+JSON.stringify(arguments)+")"),this.ready||y.debug("RTCRtpSenderRedirector("+this.rpcObjectId+")::setStreams called before we are ready"),this.makeRpcCall("setStreams",[e])},getStats:function(){if(y.debug("RTCRtpSenderRedirector("+this.rpcObjectId+")::getStats("+JSON.stringify(arguments)+")"),!this.ready)return new Promise(function(e,t){e(new a)});var e=this;return new Promise(function(t,n){e.makeRpcCall("getStats",arguments).then(function(e){var n=new a;for(var i in e){var r=e[i];n[r.id]=r}t(n)}).catch(function(e){n(e)})})},makeRpcCall:function(e,t,n){return msRDCRTC.makeRpcCall({rpcObjectType:this.rpcObjectType,rpcObjectId:this.rpcObjectId,rpcName:e,rpcArgs:t},n)}},v.prototype={getCapabilities:function(e){y.debug("RTCRtpReceiverRedirector("+this.rpcObjectId+")::getCapabilities("+JSON.stringify(arguments)+")");var t="audio"===e?this.capabilities.audio:"video"===e?this.capabilities.video:{};y.debug("RTCRtpReceiverRedirector("+this.rpcObjectId+")::getCapabilities returning: "+JSON.stringify(t))},getParameters:function(){return y.debug("RTCRtpReceiverRedirector("+this.rpcObjectId+")::getParameters("+JSON.stringify(arguments)+")"),y.debug("RTCRtpReceiverRedirector("+this.rpcObjectId+")::getParameters returning: "+JSON.stringify(this.parameters)),this.parameters},getContributingSources:function(){return y.debug("RTCRtpReceiverRedirector("+this.rpcObjectId+")::getContributingSources("+JSON.stringify(arguments)+")"),y.debug("RTCRtpReceiverRedirector("+this.rpcObjectId+")::getContributingSources returning: "+JSON.stringify(this.contributingSources)),this.contributingSources},getSynchronizationSources:function(){return y.debug("RTCRtpReceiverRedirector("+this.rpcObjectId+")::getSynchronizationSources("+JSON.stringify(arguments)+")"),y.debug("RTCRtpReceiverRedirector("+this.rpcObjectId+")::getSynchronizationSources returning: "+JSON.stringify(this.synchronizationSources)),this.synchronizationSources},getStats:function(){y.debug("RTCRtpReceiverRedirector("+this.rpcObjectId+")::getStats("+JSON.stringify(arguments)+")");var e=this;return new Promise(function(t,n){e.makeRpcCall("getStats",arguments).then(function(e){var n=new a;for(var i in e){var r=e[i];n[r.id]=r}t(n)}).catch(function(e){n(e)})})},onContributingSourcesChanged:function(e){y.debug("RTCRtpReceiverRedirector("+this.rpcObjectId+")::onContributingSourcesChanged("+JSON.stringify(e)+")"),this.contributingSources=e},onRpcEventNotification:function(e){var t=!1;return e.rpcEventTarget.rpcObjectType===this.rpcObjectType&&e.rpcEventTarget.rpcObjectId===this.rpcObjectId&&"notifyContributingSources"===e.rpcEventName&&(this.onContributingSourcesChanged(e.rpcEventArgs.sources),t=!0),t},makeRpcCall:function(e,t,n){return msRDCRTC.makeRpcCall({rpcObjectType:this.rpcObjectType,rpcObjectId:this.rpcObjectId,rpcName:e,rpcArgs:t},n)}},f.prototype={stop:function(){y.debug("RTCRtpTransceiverRedirector("+this.rpcObjectId+")::stop("+JSON.stringify(arguments)+")"),this.makeRpcCall("stop",arguments)},setCodecPreferences:function(e){y.debug("RTCRtpTransceiverRedirector("+this.rpcObjectId+")::setCodecPreferences("+JSON.stringify(arguments)+")"),this.makeRpcCall("setCodecPreferences",[e])},makeRpcCall:function(e,t,n){return msRDCRTC.makeRpcCall({rpcObjectType:this.rpcObjectType,rpcObjectId:this.rpcObjectId,rpcName:e,rpcArgs:t},n)}},function(){var e=this;c(this,[["readOnlyAttributes",{rpcObjectType:"RTCDtlsTransport",rpcObjectId:0,transport:null,state:"new"}],["observableAttributes",[["onstatechange",void 0,function(){o(e,"statechange")}],["onerror",void 0,function(){o(e,"error")}]]],["eventManager",new d([{name:"statechange",level:"info"},{name:"error",level:"error"}])],["eventListeners",new a]])}.prototype={addEventListener:function(e,t,n){y.debug("RTCDtlsTransportRedirector adding event listener for: "+e),this.eventManager.addEventListener(e,t,n)},removeEventListener:function(e,t,n){y.debug("RTCDtlsTransportRedirector removing event listener for: "+e),this.eventManager.removeEventListener(e,t,n)},getRemoteCertificates:function(){y.debug("RTCDtlsTransportRedirector::getRemoteCertificats: "+JSON.stringify(arguments))}},function(){var e=this;c(this,[["readOnlyAttributes",{rpcObjectType:"RTCIceTransport",rpcObjectId:0,role:null,component:"new",state:"new",gatheringState:""}],["observableAttributes",[["onstatechange",void 0,function(){o(e,"statechange")}],["ongatheringstatechange",void 0,function(){o(e,"gatheringstatechange")}],["onselectedcandidatepairchange",void 0,function(){o(e,"selectedcandidatepairchange")}]]],["eventManager",new d([{name:"statechange",level:"info"},{name:"gatheringstatechange",level:"info"},{name:"selectedcandidatepairchange",level:"info"}])],["eventListeners",new a]])}.prototype={addEventListener:function(e,t,n){y.debug("RTCIceTransportRedirector adding event listener for: "+e),this.eventManager.addEventListener(e,t,n)},removeEventListener:function(e,t,n){y.debug("RTCIceTransportRedirector removing event listener for: "+e),this.eventManager.removeEventListener(e,t,n)},getLocalCandidates:function(){},getRemoteCandidates:function(){},getSelectedCandidatePair:function(){},getLocalParameters:function(){},getRemoteParameters:function(){}},function(){c(this,[["readOnlyAttributes",{length:0}],["rangeStart",0],["rangeEnd",0]])}.prototype={start:function(e){if(e>=this.length)throw new IndexSizeError;return this.rangeStart},end:function(e){if(e>=this.length)throw new IndexSizeError;return this.rangeEnd},setTimeRange:function(e,t){this.readOnlyAttributes.length=1,this.rangeStart=e,this.rangeEnd=t}},b.prototype={MEDIA_ERR_ABORTED:1,MEDIA_ERR_NETWORK:2,MEDIA_ERR_DECODE:3,MEDIA_ERR_SRC_NOT_SUPPORTED:4,NETWORK_EMPTY:0,NETWORK_IDLE:1,NETWORK_LOADING:2,NETWORK_NO_SOURCE:3,HAVE_NOTHING:0,HAVE_METADATA:1,HAVE_CURRENT_DATA:2,HAVE_FUTURE_DATA:3,HAVE_ENOUGH_DATA:4,enableRedirection:function(){if(!this.redirecting){var e=this.mediaElement;"video"===this.kind&&e.addEventListener("onresize",this.onResizeFunctor,!1),e.getAttribute=this.getAttributeFunctor,e.setAttribute=this.setAttributeFunctor,e.removeAttribute=this.removeAttributeFunctor,e.addEventListener=this.addEventListenerFunctor,e.removeEventListener=this.removeEventListenerFunctor,e.play=this.playFunctor,e.pause=this.pauseFunctor,e.load=this.loadFunctor,e.setSinkId=this.setSinkIdFunctor,this.redirecting=!0}},disableRedirection:function(){if(this.redirecting){var e=this.mediaElement;e.getAttribute=this.actualGetAttribute,e.setAttribute=this.actualSetAttribute,e.removeAttribute=this.actualRemoveAttribute,e.addEventListener=this.actualAddEventListener,e.removeEventListener=this.actualRemoveEventListener,e.play=this.actualPlay,e.pause=this.actualPause,e.load=this.actualLoad,e.setSinkId=this.actualSetSinkId,"video"===this.kind&&e.removeEventListener("onresize",this.onResizeFunctor,!1),this.stopProgressTimer(),this.redirecting=!1}},getAttribute:function(e){return"preload"===e?"none":"currentTime"===e?this.getCurrentTime():"duration"===e?this.duration:"defaultPlaybackRate"===e?1:"playbackRate"===e?1:"played"===e?this.getPlayedRanges():"loop"!==e&&("srcObject"===e?this.srcObject:"sinkId"===e?this.sinkId:"autoplay"===e?this.autoplay:"muted"===e?this.muted:"volume"===e?this.volume:"data-vdi_videoid"===e?this["data-vdi_videoid"]:void y.warn("MediaElementRedirector("+this.rpcObjectId+")::getAttribute called for unsupported attribute: name="+e))},getReadOnlyAttribute:function(e){return this.redirecting?this.readOnlyAttributes[e]:this.actualGetAttribute.apply(this.mediaElement,arguments)},setAttribute:function(e,t){var n=null,i=!0,r=!1,c=null,o=this;if("srcObject"===e){if(null!=t&&"MediaStream"!==t.rpcObjectType)throw new TypeError("srcObject is not an instance of MediaStreamRedirector");this.readOnlyAttributes.networkState=this.NETWORK_LOADING,c=function(e){o.setReadyState(o.HAVE_ENOUGH_DATA)},this.srcObject=t,null!=t&&(t={rpcObjectType:t.rpcObjectType,rpcObjectId:t.rpcObjectId})}else"autoplay"===e?(r=!0,n=this.autoplay,this.autoplay=t):"muted"===e?(r=!0,n=this.muted,this.muted=t,c=function(e){o.fireEvent("volumechange")}):"volume"===e?(r=!0,n=this.volume,this.volume=t,c=function(e){o.fireEvent("volumechange")}):"data-vdi_videoid"===e?(y.info("MediaElementRedirector("+this.rpcObjectId+")::setAttribute called for data-vdi_video value="+t),this["data-vdi_videoid"]=t):(i=!1,y.warn("MediaElementRedirector("+this.rpcObjectId+")::setAttribute called for unsupported attribute: name="+e+", value="+t));n!==t&&(r&&this.actualSetAttribute.apply(this.mediaElement,arguments),i&&this.makeRpcCall("setAttribute",[e,t]).then(function(e){null!=c&&c(e)}))},removeAttribute:function(e){y.warn("MediaElementRedirector("+this.rpcObjectId+")::removeAttribute called for unsupported attribute: name="+e+", value="+value)},addEventListener:function(e,t,n){y.debug("MediaElementRedirector("+this.rpcObjectId+") - adding event listener for: "+e),this.eventManager.addEventListener(e,t,n),this.actualAddEventListener.apply(this.mediaElement,arguments)},removeEventListener:function(e,t,n){y.debug("MediaElementRedirector("+this.rpcObjectId+") - removing event listener for: "+e),this.eventManager.removeEventListener(e,t,n),this.actualRemoveEventListener.apply(this.mediaElement,arguments)},setSinkId:function(e){return y.debug("MediaElementRedirector("+this.rpcObjectId+")::setSinkId: "+e),this.makeRpcCall("setSinkId",[e])},play:function(){if(y.debug("MediaElementRedirector("+this.rpcObjectId+")::play"),this.paused){this.eventManager.fireEvent("play"),this.lastPlayAt=performance.now();var e=this;this.makeRpcCall("play").then(function(){e.readOnlyAttributes.paused=!1,e.eventManager.fireEvent("playing"),e.startProgressTimer()})}},pause:function(){if(y.debug("MediaElementRedirector("+this.rpcObjectId+")::pause"),!this.paused){var e=this;this.makeRpcCall("pause").then(function(){e.stopProgressTimer(),e.readOnlyAttributes.paused=!0,e.updateCurrentTime(),e.eventManager.fireEvent("pause")})}},load:function(){y.debug("MediaElementRedirector("+this.rpcObjectId+")::load")},getCurrentTime:function(){return this.currentTime},updateCurrentTime:function(){var e=performance.now(),t=this.currentTime,n=e-this.lastPlayAt;n!==t&&(this.readOnlyAttributes.currentTime=n,this.eventManager.fireEvent("timeupdate"))},getPlayedTimeRanges:function(){var e=this.getCurrentTime(),t=new TimeRanges;return 0!==e&&t.setTimeRange(0,e),t},setReadyState:function(e){var t=this.readyState;if(t!==e){var n=!1;t===this.HAVE_NOTHING&&e>=this.HAVE_METADATA&&(this.readOnlyAttributes.readyState=this.HAVE_METADATA,isNaN(this.duration)&&(this.readOnlyAttributes.duration=Number.POSITIVE_INFINITY,this.eventManager.fireEvent("durationchange")),this.eventManager.fireEvent("loadedmetadata")),t<=this.HAVE_METADATA&&e>=this.HAVE_CURRENT_DATA&&(this.readOnlyAttributes.readyState=this.HAVE_CURRENT_DATA,this.eventManager.fireEvent("loadeddata")),t<=this.HAVE_CURRENT_DATA&&e>=this.HAVE_FUTURE_DATA&&(this.readOnlyAttributes.readyState=this.HAVE_FUTURE_DATA,this.eventManager.fireEvent("canplay"),n=!0),t<=this.HAVE_FUTURE_DATA&&e>=this.HAVE_ENOUGH_DATA&&(this.readOnlyAttributes.readyState=this.HAVE_ENOUGH_DATA,this.eventManager.fireEvent("canplaythrough"),n=!0),n&&this.paused&&this.autoplay&&this.play()}},startProgressTimer:function(){if(void 0==this.progressIntervalId){y.debug("MediaElementRedirector("+this.rpcObjectId+")::startProgressTimer");var e=this;this.progressIntervalId=window.setInterval(function(){e.onProgressTimer()},250)}},stopProgressTimer:function(){void 0!=this.progressIntervalId&&(y.debug("MediaElementRedirector("+this.rpcObjectId+")::startProgressTimer"),window.clearInterval(this.progressIntervalId),this.progressIntervalId=void 0)},onProgressTimer:function(){this.paused||this.ended||(this.onPositionChanged("poll"),this.updateCurrentTime(),this.eventManager.fireEvent("progress"))},onVdiVideoIdChanged:function(){y.debug("MediaElementRedirector("+this.rpcObjectId+")::onVdiVideoIdChanged: "+this.mediaElement["data-vdi_video"])},onPositionChanged:function(e){"poll"!==e&&y.debug("MediaElementRedirector("+this.rpcObjectId+")::onPositionChanged due to "+e+": ["+this.mediaElement[e]+"]");var t=this.mediaElement.getBoundingClientRect(),n=this.boundingRect;null!=n&&t.left===n.left&&t.top===n.top&&t.right===n.right&&t.bottom===n.bottom||(y.debug("MediaElementRedirector("+this.rpcObjectId+")::onPositionChanged - bounding client rect changed from: "+JSON.stringify(n)+" to: "+JSON.stringify(t)),this.boundingRect=t,this.makeRpcCall("notifyPositionChanged",[{left:t.left,top:t.top,right:t.right,bottom:t.bottom}],!1))},makeRpcCall:function(e,t,n){return msRDCRTC.makeRpcCall({rpcObjectType:this.rpcObjectType,rpcObjectId:this.rpcObjectId,rpcName:e,rpcArgs:t},n)}},m.prototype={sign:function(e){var t=this;return void 0==this.key?new Promise(function(n,i){t.importKey().then(function(){t.generateHash(e).then(function(e){n(e)}).catch(function(e){i(e)})}).catch(function(e){i(e)})}):this.generateHash(e)},importKey:function(){var e=this;return new Promise(function(t,n){window.crypto.subtle.importKey("raw",e.rawKey,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]).then(function(n){e.key=n,t()}).catch(function(e){n(e)})})},pad:function(e){for(;e.length<2;)e="0"+e;return e},generateHash:function(e){for(var t=this,n=e.length,i=new ArrayBuffer(n),r=new Uint8Array(i),c=0;c<n;++c)r[c]=e.charCodeAt(c);return new Promise(function(e,n){window.crypto.subtle.sign({name:"HMAC"},t.key,i).then(function(n){for(var i=new Uint8Array(n),r="",c=i.byteLength,o=0;o<c;++o)r+=t.pad(i[o].toString(16));e(r)}).catch(function(e){n(e)})})}},R.prototype={VERSION:"0.1.0",WEBSOCKET_DEFAULT_PORT:9500,WEBSOCKET_PORT:R.WEBSOCKET_DEFAULT_PORT,WEBSOCKET_URI_BASE:"ws://localhost",WEBSOCKET_URI:R.WEBSOCKET_URI_BASE+":"+R.WEBSOCKET_DEFAULT_PORT,WEBSOCKET_SERVICE_ID:"388FE4DA-5AAD-C078-FCD5-2DB6ADE9C174",WEBSOCKET_KEY:void 0,init:function(e){var t=this;C=e,y.info("WVD VDI shim loaded - v"+this.VERSION),this.getConfiguration().then(function(){t.startRtcSession(),t.registerAppWindowHandle(),t.enableRedirection()})},setDebugLevel:function(e){if(e!==this.debugLevel){var t=this.debugLevel;if(this.debugLevel=e,y=0===e?O:1===e?S:T,0===e)window.clearInterval(this.periodicCallbackId),this.periodicCallbackId=null;else if(0===t){var n=this;this.periodicCallbackId=window.setInterval(function(){n.debugPeriodicCallback()},1e3)}}},startRtcSession:function(){var e=this,t=msRDCRTC.generateUuid(),n=Date.now().toString(),i=t+"|"+n;new m(this.WEBSOCKET_SERVICE_ID,this.WEBSOCKET_KEY).sign(i).then(function(i){e.makeRpcCall({rpcObjectType:"RDWebRTCRedirector",rpcName:"rtcSession",rpcArgs:[t,n,i]},!0,!0).then(function(i){var r=i[0],c=i[1];e.verifyRtcSession(t,n,r,c)}),e.trySendPendingMessages()})},verifyRtcSession:function(e,t,n,i){var r=this,c=e+"|"+t+"|"+n;new m(this.WEBSOCKET_SERVICE_ID,this.WEBSOCKET_KEY).sign(c).then(function(e){e===i&&(r.rtcSessionStarted=!0,r.trySendPendingMessages())})},getWVDConfigPolyfill:function(){return new Promise(function(e,t){e('{"port":9500,"key":"F3419B0B-8DA1-5A3D-5D29-D375EB3540B2"}')})},getConfiguration:function(){var e=this;return void 0==window.getWVDConfig&&(window.getWVDConfig=this.getWVDConfigPolyfill),new Promise(function(t,n){window.getWVDConfig().then(function(i){y.debug("config="+i);var r=JSON.parse(i);void 0!=r.port&&void 0!=r.key||n(new Error("invalid WVD config")),e.WEBSOCKET_PORT=r.port,e.WEBSOCKET_URI=e.WEBSOCKET_URI_BASE+":"+e.WEBSOCKET_PORT,e.WEBSOCKET_KEY=r.key,t()}).catch(function(e){n(e)})})},enableRedirection:function(){if(y.info("redirection enabled"),!this.redirecting){y.debug("connecting to: "+this.WEBSOCKET_URI);var e=new WebSocket(this.WEBSOCKET_URI);e.addEventListener("open",this.onWebSocketOpenFunctor,!1),e.addEventListener("closed",this.onWebSocketClosedFunctor,!1),e.addEventListener("error",this.onWebSocketErrorFunctor,!1),e.addEventListener("message",this.onWebSocketMessageFunctor,!1),this.socket=e,this.onRedirectionEnabled()}},disableRedirection:function(){this.redirecting&&(this.socketClosed||this.sendWebSocketMessage("close"),y.debug("disconnecting from: "+this.WEBSOCKET_URI),this.onRedirectionDisabled()),y.info("redirection disabled")},registerAppWindowHandle:function(){var e=this;window.getWindowHandleAsHex().then(function(t){t=t.match(/[0-9a-f]{2}/gi).reverse().join(""),y.info("app hwnd="+t),e.makeRpcCall({rpcObjectType:"RDWebRTCRedirector",rpcName:"setAppWindow",rpcArgs:[t]})}).catch(function(e){y.error("failed to get the app window - "+e.toString())})},overrideAppWindowHandle:function(e){y.info("overriding app hwnd="+e),this.makeRpcCall({rpcObjectType:"RDWebRTCRedirector",rpcName:"setAppWindow",rpcArgs:[e]})},getAppWindowHandle:function(){window.getWindowHandleAsHex().then(function(e){e=e.match(/[0-9a-f]{2}/gi).reverse().join(""),y.info("app hwnd="+e)}).catch(function(e){y.error("failed to get the app window - "+e.toString())})},enableDtls:function(e){e!=this.dtlsEnabled&&(e?y.info("DTLS enabled"):y.warn("DTLS disabled"),this.dtlsEnabled=e)},setVMEventCallback:function(e){this.vmEventCallback=e},newAudioElement:function(e){var t=new b("audio",e);this.rtcObjects.push(t),this.redirecting&&t.enableRedirection(),y.info("newAudioElement returning "+(this.redirecting?"":"un")+"shimmed object")},newVideoElement:function(e){var t=this.nextVideoElementId++;e.setAttribute("data-vdi_videoid",t);var n=new b("video",e);this.rtcObjects.push(n),this.redirecting&&n.enableRedirection(),y.info("newVideoElement returning "+(this.redirecting?"":"un")+"shimmed object, id="+t)},playNotifyAudio:function(e,t){var n=this.audioElement;n.src=t,n.paused&&n.play()},pauseNotifyAudio:function(e){this.audioElement.pause()},setSinkId:function(e,t){},setDefaultSinkId:function(e){},addClipRect:function(){},removeClipRect:function(){},createPeerConnection:function(e,t){var n=this.redirecting?new l(e,t):new this.ActualRTCPeerConnection(e,t);if(n.teamsId=this.nextPeerConnectionId++,y.info("createPeerConnection returning "+(this.redirecting?"":"un")+"shimmed object, id="+n.teamsId+" num args="+arguments.length+" args="+JSON.stringify(arguments)),this.redirecting)this.rtcObjects.push(n);else{var i=n.addIceCandidate;n.addIceCandidate=function(){return y.info("addIceCandidate id="+n.teamsId+" num args="+arguments.length+" args="+JSON.stringify(arguments)),i.apply(n,arguments)};var r=n.createOffer;n.createOffer=function(){return y.info("createOffer id="+n.teamsId+" num args="+arguments.length+" args="+JSON.stringify(arguments)),r.apply(n,arguments)};var c=n.createAnswer;n.createAnswer=function(){return y.info("createAnswer id="+n.teamsId+" num args="+arguments.length+" args="+JSON.stringify(arguments)),c.apply(n,arguments)};var o=n.setRemoteDescription;n.setRemoteDescription=function(){return y.info("setRemoteDescription id="+n.teamsId+" num args="+arguments.length+" args="+JSON.stringify(arguments)),o.apply(n,arguments)};var a=n.setLocalDescription;n.setLocalDescription=function(){return y.info("setLocalDescription id="+n.teamsId+" num args="+arguments.length+" args="+JSON.stringify(arguments)),a.apply(n,arguments)};var s=n.createDTMFSender;n.createDTMFSender=function(){return y.info("createDTMFSender id="+n.teamsId+" num args="+arguments.length+" args="+JSON.stringify(arguments)),s.apply(n,arguments)};var d=n.getLocalStreams;n.getLocalStreams=function(){y.info("getLocalStreams id="+n.teamsId+" num args="+arguments.length+" args="+JSON.stringify(arguments));var e=d.apply(n,arguments);return y.info("VDI Local Streams",e),e};var u=n.getRemoteStreams;n.getRemoteStreams=function(){return y.info("getRemoteStreams id="+n.teamsId+" num args="+arguments.length+" args="+JSON.stringify(arguments)),u.apply(n,arguments)};var p=n.getStats;n.getStats=function(){return y.info("getStats id="+n.teamsId+" num args="+arguments.length+" args="+JSON.stringify(arguments)),p.apply(n,arguments)};var g=n.addStream;n.addStream=function(){return y.info("addStream id="+n.teamsId+" num args="+arguments.length+" args="+JSON.stringify(arguments)),g.apply(n,arguments)};var h=n.addTrackStream;n.addTrack=function(){return y.info("addTrack id="+n.teamsId+" num args="+arguments.length+" args="+JSON.stringify(arguments)),h.apply(n,arguments)};var v=n.removeStream;n.removeStream=function(){return y.info("removeStream id="+n.teamsId+" num args="+arguments.length+" args="+JSON.stringify(arguments)),v.apply(n,arguments)};var f=n.getReceivers;n.getReceivers=function(){return y.info("getReceivers id="+n.teamsId+" num args="+arguments.length+" args="+JSON.stringify(arguments)),f.apply(n,arguments)};var b=n.close;n.close=function(){return y.info("close id="+n.teamsId+" num args="+arguments.length+" args="+JSON.stringify(arguments)),b.apply(n,arguments)},["onnegotiationneeded","onsignalingstatechange","onaddstream","onremovestream","onicecandidate","oniceconnectionstatechange","onicegatheringstatechange"].forEach(function(e){var t=n[e];n[e]=function(){if(y.info(e+" id="+n.teamsId+" num args="+arguments.length+" args="+JSON.stringify(arguments)),t)return t.apply(n,arguments)}})}return n},getUserMedia:function(){return this.mediaDevicesRedirector.getUserMedia.apply(this.mediaDevicesRedirector,arguments)},enumerateDevices:function(){return this.mediaDevicesRedirector.enumerateDevices.apply(this.mediaDevicesRedirector,arguments)},getDisplayMedia:function(){return this.mediaDevicesRedirector.getDisplayMedia.apply(this.mediaDevicesRedirector,arguments)},onRedirectionEnabled:function(){this.redirecting=!0,this.rtcObjects.forEach(function(e){void 0!=e.enableRedirection&&e.enableRedirection()}),this.notifyVmEventCallback({event:"vdiClientRedirectionEnabled"})},onRedirectionDisabled:function(){if(this.redirecting=!1,null!=this.socket){var e=this.socket;e.removeEventListener("open",this.onWebSocketOpenFunctor,!1),e.removeEventListener("closed",this.onWebSocketClosedFunctor,!1),e.removeEventListener("error",this.onWebSocketErrorFunctor,!1),e.removeEventListener("message",this.onWebSocketMessageFunctor,!1),this.socket=null,this.socketConnected=!1}this.pendingMessages=[],this.rtcObjects.forEach(function(e){void 0!=e.disableRedirection&&e.disableRedirection()}),this.notifyVmEventCallback({event:"vdiClientRedirectionDisabled"})},onWebSocketOpen:function(e){y.debug("WebSocket opened"),this.socketConnected=!0,this.trySendPendingMessages()},onWebSocketClosed:function(e){y.debug("WebSocket closed"),this.socketConnected=!1,this.onRedirectionDisabled()},onWebSocketError:function(e){y.error("WebSocket error: "+e.toString()),this.socketConnected=!1,this.onRedirectionDisabled()},onWebSocketMessage:function(e){y.debug("onWebSocketMessage");var t=null;try{var n=new String(e.data),i=n.lastIndexOf("}");n=n.substring(0,i+1),t=JSON.parse(n)}catch(t){y.error("failed to parse the JSON string: ["+e.data+"] - "+t.toString())}if(null!=t)try{void 0!=t.rpcCallId?this.onRpcResponse(t):void 0!=t.rpcEventTarget?this.onRpcEventNotification(t):y.error("error: received RPC response with no rpcCallId or rpcEventTarget defined")}catch(t){y.error("failed to handle the WebSocket message: ["+e.data+"] - "+t.toString())}},onRpcResponse:function(e){0===e.hr?y.debug("onRpcResponse: "+JSON.stringify(e)):y.error("onRpcResponse - ERROR: "+JSON.stringify(e));var t=e.rpcCallId,n=this.outstandingRpcCalls[t];if(void 0!=n){n.stats.completed=performance.now();var i=n.stats.completed-n.stats.started;(i>=1e3?y.warn:y.debug)('"rpcCallId":'+t+" took "+i.toFixed(4)+" ms"),delete this.outstandingRpcCalls[t],n.onRpcResponse(e)}else y.error("error: received RPC response with unexpected rpcCallId: "+t)},onRpcEventNotification:function(e){if(0===e.hr?y.debug("onRpcEventNotification: "+JSON.stringify(e)):y.error("onRpcEventNotification - ERROR: "+JSON.stringify(e)),void 0!=e.rpcEventTarget)if(void 0!=e.rpcEventTarget.rpcObjectType)if(void 0!=e.rpcEventName){var t=!1;this.rtcObjects.forEach(function(n){void 0!=n.onRpcEventNotification&&n.onRpcEventNotification(e)&&(t=!0)}),t||y.warn("warning - received RPC event notification but no objects handled the event")}else y.error("error: received RPC event notification with no rpcEventName defined");else y.error("error: received RPC event notification with no rpcEventTarget.rpcObjectType defined");else y.error("error: received RPC event notification with no rpcEventTarget defined")},sendWebSocketMessage:function(e,t){if(this.socketConnected&&(this.rtcSessionStarted||this.isSessionHandshakeMessage(e))){var n="close"===e;n&&this.socketClosed||(y.debug("Sending... "+e),this.socket.send(e),this.socketClosed=n)}else t?this.pendingMessages.unshift(e):this.pendingMessages.push(e)},isSessionHandshakeMessage:function(e){var t=JSON.parse(e);return"RDWebRTCRedirector"===t.rpcObjectType&&"rtcSession"===t.rpcName},trySendPendingMessages:function(){if(this.socketConnected)for(;;){var e=this.pendingMessages.shift();if(void 0==e)break;if(!this.rtcSessionStarted&&!this.isSessionHandshakeMessage(e)){this.pendingMessages.unshift(e);break}this.sendWebSocketMessage(e)}},getNextRpcObjectId:function(){return this.nextRpcObjectId++},getNextOperationId:function(){return this.nextOperationId++},generateUuid:function(){for(var e=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},t=null;;)if(t=e()+e()+e()+"4"+e().substring(1)+"b"+e().substring(1)+e()+e()+e(),void 0==this.uniqueIds[t]){this.uniqueIds[t]=!0;break}return t},makeRpcCall:function(e,t,n){var i=this.nextRpcCallId++;e.rpcCallId=i;var r=e.rpcArgs,c=!0;for(var o in r)if(void 0!=r[o]){c=!1;break}c&&(e.rpcArgs=[]);var a=JSON.stringify(e);this.sendWebSocketMessage(a,n);var d;return void 0==t||t?(e.stats={started:performance.now()},d=new Promise(function(t,n){e.onRpcResponse=function(e){0===e.hr?t(e.result):n(new Error("RPC call failed with hr="+s(e.hr)))}}),e.promise=d,this.outstandingRpcCalls[i]=e):d=new Promise(function(e,t){e()}),d},disconnectAllCalls:function(){this.notifyVmEventCallback({event:"vdiClientDisconnected",request:"endCalls"})},notifyVmEventCallback:function(e){void 0!=this.vmEventCallback&&this.vmEventCallback(e)},debugPeriodicCallback:function(){this.rtcObjects.forEach(function(e){void 0!=e.debugPeriodicCallback&&e.debugPeriodicCallback()})}},msRDCRTC=new R,{init:function(){return msRDCRTC.init.apply(msRDCRTC,arguments)},setVMEventCallback:function(){return msRDCRTC.setVMEventCallback.apply(msRDCRTC,arguments)},newAudioElement:function(){return msRDCRTC.newAudioElement.apply(msRDCRTC,arguments)},newVideoElement:function(){return msRDCRTC.newVideoElement.apply(msRDCRTC,arguments)},playNotifyAudio:function(){return msRDCRTC.playNotifyAudio.apply(msRDCRTC,arguments)},pauseNotifyAudio:function(){return msRDCRTC.pauseNotifyAudio.apply(msRDCRTC,arguments)},setSinkId:function(){return msRDCRTC.setSinkId.apply(msRDCRTC,arguments)},setDefaultSinkId:function(){return msRDCRTC.setDefaultSinkId.apply(msRDCRTC,arguments)},addClipRect:function(){return msRDCRTC.addClipRect.apply(msRDCRTC,arguments)},removeClipRect:function(){return msRDCRTC.removeClipRect.apply(msRDCRTC,arguments)},createPeerConnection:function(){return msRDCRTC.createPeerConnection.apply(msRDCRTC,arguments)},getUserMediaShim:function(){return msRDCRTC.getUserMedia.apply(msRDCRTC,arguments)},mediaDevicesGetUserMediaShim:function(){return msRDCRTC.getUserMedia.apply(msRDCRTC,arguments)},enumerateDevicesShim:function(){return msRDCRTC.enumerateDevices.apply(msRDCRTC,arguments)},getDisplayMediaShim:function(){return msRDCRTC.getDisplayMedia.apply(msRDCRTC,arguments)}}});
//# sourceMappingURL=https://statics.teams.microsoft.com/hashedjs/vdiWVDPeerConnection2.js-4956519c.map