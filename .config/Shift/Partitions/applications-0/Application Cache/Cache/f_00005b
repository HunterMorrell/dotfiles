var $jscomp={scope:{},getGlobal:function(e){return"undefined"!=typeof window&&window===e?e:"undefined"!=typeof global?global:e}};$jscomp.global=$jscomp.getGlobal(this),$jscomp.initSymbol=function(){$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol),$jscomp.initSymbol=function(){}},$jscomp.symbolCounter_=0,$jscomp.Symbol=function(e){return"jscomp_symbol_"+e+$jscomp.symbolCounter_++},$jscomp.initSymbolIterator=function(){$jscomp.initSymbol(),$jscomp.global.Symbol.iterator||($jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator")),$jscomp.initSymbolIterator=function(){}},$jscomp.makeIterator=function(e){if($jscomp.initSymbolIterator(),e[$jscomp.global.Symbol.iterator])return e[$jscomp.global.Symbol.iterator]();var t=0;return{next:function(){return t==e.length?{done:!0}:{done:!1,value:e[t++]}}}},$jscomp.arrayFromIterator=function(e){for(var t,n=[];!(t=e.next()).done;)n.push(t.value);return n},$jscomp.arrayFromIterable=function(e){return e instanceof Array?e:$jscomp.arrayFromIterator($jscomp.makeIterator(e))},$jscomp.inherits=function(e,t){function n(){}n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e;for(var i in t)if($jscomp.global.Object.defineProperties){var o=$jscomp.global.Object.getOwnPropertyDescriptor(t,i);o&&$jscomp.global.Object.defineProperty(e,i,o)}else e[i]=t[i]},$jscomp.array=$jscomp.array||{},$jscomp.array.done_=function(){return{done:!0,value:void 0}},$jscomp.array.arrayIterator_=function(e,t){e instanceof String&&(e=String(e));var n=0;$jscomp.initSymbol(),$jscomp.initSymbolIterator();var i={},o=(i.next=function(){if(n<e.length){var i=n++;return{value:t(i,e[i]),done:!1}}return o.next=$jscomp.array.done_,$jscomp.array.done_()},i[Symbol.iterator]=function(){return o},i);return o},$jscomp.array.findInternal_=function(e,t,n){e instanceof String&&(e=String(e));for(var i=e.length,o=0;o<i;o++){var r=e[o];if(t.call(n,r,o,e))return{i:o,v:r}}return{i:-1,v:void 0}},$jscomp.array.from=function(e,t,n){t=void 0===t?function(e){return e}:t;var i=[];if($jscomp.initSymbol(),$jscomp.initSymbolIterator(),e[Symbol.iterator]){$jscomp.initSymbol(),$jscomp.initSymbolIterator(),e=e[Symbol.iterator]();for(var o;!(o=e.next()).done;)i.push(t.call(n,o.value))}else{o=e.length;for(var r=0;r<o;r++)i.push(t.call(n,e[r]))}return i},$jscomp.array.of=function(e){for(var t=[],n=0;n<arguments.length;++n)t[n-0]=arguments[n];return $jscomp.array.from(t)},$jscomp.array.entries=function(){return $jscomp.array.arrayIterator_(this,function(e,t){return[e,t]})},$jscomp.array.entries$install=function(){Array.prototype.entries||(Array.prototype.entries=$jscomp.array.entries)},$jscomp.array.keys=function(){return $jscomp.array.arrayIterator_(this,function(e){return e})},$jscomp.array.keys$install=function(){Array.prototype.keys||(Array.prototype.keys=$jscomp.array.keys)},$jscomp.array.values=function(){return $jscomp.array.arrayIterator_(this,function(e,t){return t})},$jscomp.array.values$install=function(){Array.prototype.values||(Array.prototype.values=$jscomp.array.values)},$jscomp.array.copyWithin=function(e,t,n){var i=this.length;if(e=Number(e),t=Number(t),n=Number(null!=n?n:i),e<t)for(n=Math.min(n,i);t<n;)t in this?this[e++]=this[t++]:(delete this[e++],t++);else for(n=Math.min(n,i+t-e),e+=n-t;n>t;)--n in this?this[--e]=this[n]:delete this[e];return this},$jscomp.array.copyWithin$install=function(){Array.prototype.copyWithin||(Array.prototype.copyWithin=$jscomp.array.copyWithin)},$jscomp.array.fill=function(e,t,n){for(null!=n&&e.length||(n=this.length||0),n=Number(n),t=Number((void 0===t?0:t)||0);t<n;t++)this[t]=e;return this},$jscomp.array.fill$install=function(){Array.prototype.fill||(Array.prototype.fill=$jscomp.array.fill)},$jscomp.array.find=function(e,t){return $jscomp.array.findInternal_(this,e,t).v},$jscomp.array.find$install=function(){Array.prototype.find||(Array.prototype.find=$jscomp.array.find)},$jscomp.array.findIndex=function(e,t){return $jscomp.array.findInternal_(this,e,t).i},$jscomp.array.findIndex$install=function(){Array.prototype.findIndex||(Array.prototype.findIndex=$jscomp.array.findIndex)},$jscomp.Map=function(e){if(e=void 0===e?[]:e,this.data_={},this.head_=$jscomp.Map.createHead_(),this.size=0,e)for(var t=(e=$jscomp.makeIterator(e)).next();!t.done;t=e.next())t=t.value,this.set(t[0],t[1])},$jscomp.Map.checkBrowserConformance_=function(){var e=$jscomp.global.Map;if(!e||!e.prototype.entries||!Object.seal)return!1;try{var t=Object.seal({x:4}),n=new e($jscomp.makeIterator([[t,"s"]]));if("s"!=n.get(t)||1!=n.size||n.get({x:4})||n.set({x:4},"t")!=n||2!=n.size)return!1;var i=n.entries(),o=i.next();return!o.done&&o.value[0]==t&&"s"==o.value[1]&&!((o=i.next()).done||4!=o.value[0].x||"t"!=o.value[1]||!i.next().done)}catch(e){return!1}},$jscomp.Map.createHead_=function(){var e={};return e.previous=e.next=e.head=e},$jscomp.Map.getId_=function(e){return e instanceof Object?($jscomp.Map.key_ in e||e instanceof Object&&Object.isExtensible&&Object.isExtensible(e)&&$jscomp.Map.defineProperty_(e,$jscomp.Map.key_,++$jscomp.Map.index_),$jscomp.Map.key_ in e?e[$jscomp.Map.key_]:" "+e):String(e)},$jscomp.Map.prototype.set=function(e,t){var n=(o=this.maybeGetEntry_(e)).id,i=o.list,o=o.entry;return i||(i=this.data_[n]=[]),o?o.value=t:(o={next:this.head_,previous:this.head_.previous,head:this.head_,key:e,value:t},i.push(o),this.head_.previous.next=o,this.head_.previous=o,this.size++),this},$jscomp.Map.prototype.delete=function(e){var t=this.maybeGetEntry_(e);e=t.id;var n=t.list,i=t.index;return!(!(t=t.entry)||!n)&&(n.splice(i,1),n.length||delete this.data_[e],t.previous.next=t.next,t.next.previous=t.previous,t.head=null,this.size--,!0)},$jscomp.Map.prototype.clear=function(){this.data_={},this.head_=this.head_.previous=$jscomp.Map.createHead_(),this.size=0},$jscomp.Map.prototype.has=function(e){return!!this.maybeGetEntry_(e).entry},$jscomp.Map.prototype.get=function(e){return(e=this.maybeGetEntry_(e).entry)&&e.value},$jscomp.Map.prototype.maybeGetEntry_=function(e){var t=$jscomp.Map.getId_(e),n=this.data_[t];if(n)for(var i=0;i<n.length;i++){var o=n[i];if(e!==e&&o.key!==o.key||e===o.key)return{id:t,list:n,index:i,entry:o}}return{id:t,list:n,index:-1,entry:void 0}},$jscomp.Map.prototype.entries=function(){return this.iter_(function(e){return[e.key,e.value]})},$jscomp.Map.prototype.keys=function(){return this.iter_(function(e){return e.key})},$jscomp.Map.prototype.values=function(){return this.iter_(function(e){return e.value})},$jscomp.Map.prototype.forEach=function(e,t){for(var n=$jscomp.makeIterator(this.entries()),i=n.next();!i.done;i=n.next())i=i.value,e.call(t,i[1],i[0],this)},$jscomp.Map.prototype.iter_=function(e){var t=this,n=this.head_;$jscomp.initSymbol(),$jscomp.initSymbolIterator();var i={};return i.next=function(){if(n){for(;n.head!=t.head_;)n=n.previous;for(;n.next!=n.head;)return n=n.next,{done:!1,value:e(n)};n=null}return{done:!0,value:void 0}},i[Symbol.iterator]=function(){return this},i},$jscomp.Map.index_=0,$jscomp.Map.defineProperty_=Object.defineProperty?function(e,t,n){Object.defineProperty(e,t,{value:String(n)})}:function(e,t,n){e[t]=String(n)},$jscomp.Map.Entry_=function(){},$jscomp.Map.ASSUME_NO_NATIVE=!1,$jscomp.Map$install=function(){$jscomp.initSymbol(),$jscomp.initSymbolIterator(),!$jscomp.Map.ASSUME_NO_NATIVE&&$jscomp.Map.checkBrowserConformance_()?$jscomp.Map=$jscomp.global.Map:($jscomp.initSymbol(),$jscomp.initSymbolIterator(),$jscomp.Map.prototype[Symbol.iterator]=$jscomp.Map.prototype.entries,$jscomp.initSymbol(),$jscomp.Map.key_=Symbol("map-id-key")),$jscomp.Map$install=function(){}},$jscomp.math=$jscomp.math||{},$jscomp.math.clz32=function(e){if(0==(e=Number(e)>>>0))return 32;var t=0;return 0==(4294901760&e)&&(e<<=16,t+=16),0==(4278190080&e)&&(e<<=8,t+=8),0==(4026531840&e)&&(e<<=4,t+=4),0==(3221225472&e)&&(e<<=2,t+=2),0==(2147483648&e)&&t++,t},$jscomp.math.imul=function(e,t){var n=65535&(e=Number(e)),i=65535&(t=Number(t));return n*i+((e>>>16&65535)*i+n*(t>>>16&65535)<<16>>>0)|0},$jscomp.math.sign=function(e){return 0===(e=Number(e))||isNaN(e)?e:0<e?1:-1},$jscomp.math.log10=function(e){return Math.log(e)/Math.LN10},$jscomp.math.log2=function(e){return Math.log(e)/Math.LN2},$jscomp.math.log1p=function(e){if(.25>(e=Number(e))&&-.25<e){for(var t=e,n=1,i=e,o=0,r=1;o!=i;)t*=e,r*=-1,i=(o=i)+r*t/++n;return i}return Math.log(1+e)},$jscomp.math.expm1=function(e){if(.25>(e=Number(e))&&-.25<e){for(var t=e,n=1,i=e,o=0;o!=i;)t*=e/++n,i=(o=i)+t;return i}return Math.exp(e)-1},$jscomp.math.cosh=function(e){return e=Number(e),(Math.exp(e)+Math.exp(-e))/2},$jscomp.math.sinh=function(e){return 0===(e=Number(e))?e:(Math.exp(e)-Math.exp(-e))/2},$jscomp.math.tanh=function(e){if(0===(e=Number(e)))return e;var t=(1-(t=Math.exp(2*-Math.abs(e))))/(1+t);return 0>e?-t:t},$jscomp.math.acosh=function(e){return e=Number(e),Math.log(e+Math.sqrt(e*e-1))},$jscomp.math.asinh=function(e){if(0===(e=Number(e)))return e;var t=Math.log(Math.abs(e)+Math.sqrt(e*e+1));return 0>e?-t:t},$jscomp.math.atanh=function(e){return e=Number(e),($jscomp.math.log1p(e)-$jscomp.math.log1p(-e))/2},$jscomp.math.hypot=function(e,t,n){for(var i=[],o=2;o<arguments.length;++o)i[o-2]=arguments[o];e=Number(e),t=Number(t);for(var r=Math.max(Math.abs(e),Math.abs(t)),a=$jscomp.makeIterator(i),o=a.next();!o.done;o=a.next())r=Math.max(r,Math.abs(o.value));if(1e100<r||1e-100>r){for(a=(e/=r)*e+(t/=r)*t,o=(i=$jscomp.makeIterator(i)).next();!o.done;o=i.next())o=o.value,o=Number(o)/r,a+=o*o;return Math.sqrt(a)*r}for(r=e*e+t*t,o=(i=$jscomp.makeIterator(i)).next();!o.done;o=i.next())o=o.value,o=Number(o),r+=o*o;return Math.sqrt(r)},$jscomp.math.trunc=function(e){if(e=Number(e),isNaN(e)||1/0===e||-1/0===e||0===e)return e;var t=Math.floor(Math.abs(e));return 0>e?-t:t},$jscomp.math.cbrt=function(e){if(0===e)return e;e=Number(e);var t=Math.pow(Math.abs(e),1/3);return 0>e?-t:t},$jscomp.number=$jscomp.number||{},$jscomp.number.isFinite=function(e){return"number"==typeof e&&(!isNaN(e)&&1/0!==e&&-1/0!==e)},$jscomp.number.isInteger=function(e){return!!$jscomp.number.isFinite(e)&&e===Math.floor(e)},$jscomp.number.isNaN=function(e){return"number"==typeof e&&isNaN(e)},$jscomp.number.isSafeInteger=function(e){return $jscomp.number.isInteger(e)&&Math.abs(e)<=$jscomp.number.MAX_SAFE_INTEGER},$jscomp.number.EPSILON=Math.pow(2,-52),$jscomp.number.MAX_SAFE_INTEGER=9007199254740991,$jscomp.number.MIN_SAFE_INTEGER=-9007199254740991,$jscomp.object=$jscomp.object||{},$jscomp.object.assign=function(e,t){for(var n=[],i=1;i<arguments.length;++i)n[i-1]=arguments[i];for(i=(n=$jscomp.makeIterator(n)).next();!i.done;i=n.next())if(i=i.value)for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o]);return e},$jscomp.object.is=function(e,t){return e===t?0!==e||1/e==1/t:e!==e&&t!==t},$jscomp.Set=function(e){if(e=void 0===e?[]:e,this.map_=new $jscomp.Map,e)for(var t=(e=$jscomp.makeIterator(e)).next();!t.done;t=e.next())this.add(t.value);this.size=this.map_.size},$jscomp.Set.checkBrowserConformance_=function(){var e=$jscomp.global.Set;if(!e||!e.prototype.entries||!Object.seal)return!1;var t=Object.seal({x:4});if((e=new e($jscomp.makeIterator([t]))).has(t)||1!=e.size||e.add(t)!=e||1!=e.size||e.add({x:4})!=e||2!=e.size)return!1;var n=(e=e.entries()).next();return!n.done&&n.value[0]==t&&n.value[1]==t&&(!(n=e.next()).done&&n.value[0]!=t&&4==n.value[0].x&&n.value[1]==n.value[0]&&e.next().done)},$jscomp.Set.prototype.add=function(e){return this.map_.set(e,e),this.size=this.map_.size,this},$jscomp.Set.prototype.delete=function(e){return e=this.map_.delete(e),this.size=this.map_.size,e},$jscomp.Set.prototype.clear=function(){this.map_.clear(),this.size=0},$jscomp.Set.prototype.has=function(e){return this.map_.has(e)},$jscomp.Set.prototype.entries=function(){return this.map_.entries()},$jscomp.Set.prototype.values=function(){return this.map_.values()},$jscomp.Set.prototype.forEach=function(e,t){var n=this;this.map_.forEach(function(i){return e.call(t,i,i,n)})},$jscomp.Set.ASSUME_NO_NATIVE=!1,$jscomp.Set$install=function(){!$jscomp.Set.ASSUME_NO_NATIVE&&$jscomp.Set.checkBrowserConformance_()?$jscomp.Set=$jscomp.global.Set:($jscomp.Map$install(),$jscomp.initSymbol(),$jscomp.initSymbolIterator(),$jscomp.Set.prototype[Symbol.iterator]=$jscomp.Set.prototype.values),$jscomp.Set$install=function(){}},$jscomp.string=$jscomp.string||{},$jscomp.string.noRegExp_=function(e,t){if(e instanceof RegExp)throw new TypeError("First argument to String.prototype."+t+" must not be a regular expression")},$jscomp.string.fromCodePoint=function(e){for(var t=[],n=0;n<arguments.length;++n)t[n-0]=arguments[n];for(var n="",i=(t=$jscomp.makeIterator(t)).next();!i.done;i=t.next()){if(i=i.value,0>(i=+i)||1114111<i||i!==Math.floor(i))throw new RangeError("invalid_code_point "+i);65535>=i?n+=String.fromCharCode(i):(i-=65536,n+=String.fromCharCode(i>>>10&1023|55296),n+=String.fromCharCode(1023&i|56320))}return n},$jscomp.string.repeat=function(e){var t=this.toString();if(0>e||1342177279<e)throw new RangeError("Invalid count value");e|=0;for(var n="";e;)1&e&&(n+=t),(e>>>=1)&&(t+=t);return n},$jscomp.string.repeat$install=function(){String.prototype.repeat||(String.prototype.repeat=$jscomp.string.repeat)},$jscomp.string.codePointAt=function(e){var t=this.toString(),n=t.length;if(0<=(e=Number(e)||0)&&e<n){e|=0;var i=t.charCodeAt(e);return 55296>i||56319<i||e+1===n?i:56320>(e=t.charCodeAt(e+1))||57343<e?i:1024*(i-55296)+e+9216}},$jscomp.string.codePointAt$install=function(){String.prototype.codePointAt||(String.prototype.codePointAt=$jscomp.string.codePointAt)},$jscomp.string.includes=function(e,t){return t=void 0===t?0:t,$jscomp.string.noRegExp_(e,"includes"),-1!==this.toString().indexOf(e,t)},$jscomp.string.includes$install=function(){String.prototype.includes||(String.prototype.includes=$jscomp.string.includes)},$jscomp.string.startsWith=function(e,t){t=void 0===t?0:t,$jscomp.string.noRegExp_(e,"startsWith");var n=this.toString();e+="";for(var i=n.length,o=e.length,r=Math.max(0,Math.min(0|t,n.length)),a=0;a<o&&r<i;)if(n[r++]!=e[a++])return!1;return a>=o},$jscomp.string.startsWith$install=function(){String.prototype.startsWith||(String.prototype.startsWith=$jscomp.string.startsWith)},$jscomp.string.endsWith=function(e,t){$jscomp.string.noRegExp_(e,"endsWith");var n=this.toString();e+="",void 0===t&&(t=n.length);for(var i=Math.max(0,Math.min(0|t,n.length)),o=e.length;0<o&&0<i;)if(n[--i]!=e[--o])return!1;return 0>=o},$jscomp.string.endsWith$install=function(){String.prototype.endsWith||(String.prototype.endsWith=$jscomp.string.endsWith)};var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),__awaiter=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,r){function a(e){try{s(i.next(e))}catch(e){r(e)}}function c(e){try{s(i.throw(e))}catch(e){r(e)}}function s(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,c)}s((i=i.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function n(e){return function(t){return i([e,t])}}function i(n){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,r&&(a=2&n[0]?r.return:n[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,n[1])).done)return a;switch(r=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,r=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(a=s.trys,!(a=0<a.length&&a[a.length-1])&&(6===n[0]||2===n[0])){s=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3]))s.label=n[1];else if(6===n[0]&&s.label<a[1])s.label=a[1],a=n;else{if(!(a&&s.label<a[2])){a[2]&&s.ops.pop(),s.trys.pop();continue}s.label=a[2],s.ops.push(n)}}n=t.call(e,s)}catch(e){n=[6,e],r=0}finally{o=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var o,r,a,c,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return $jscomp.initSymbol(),$jscomp.initSymbol(),$jscomp.initSymbolIterator(),c={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c};define("logger",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.tracing=!1,this.mslogger_=void 0,this.tag=e,this.enabled=!0}return e.prototype.setMSLogger=function(e){this.mslogger_=e},e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&(void 0!=this.mslogger_?this.mslogger_.info(this.tag+" "+e):console.log(this.tag+" "+e))},e.prototype.trace=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.tracing&&this.log.apply(this,e)},e}();t.Logger=n,t.logger=new n("[HdxWebRTC.js]"),t.logger.enabled=!0}),define("util",["require","exports","logger"],function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),e=function(){function e(){}return e.stringifyArray=function(e){for(var t="[",n=0;n<e.length;++n)0!=n&&(t+=","),t+=this.stringify(e[n]);return t+"]"},e.stringifyObject=function(e){var t,n="{",i=!0;for(t in e)i?i=!1:n+=",",n=n+'"'+t+'":',n=e[t]instanceof Array?n+this.stringifyArray(e[t]):"object"==typeof e[t]?n+this.stringifyObject(e[t]):n+JSON.stringify(e[t]);return n+"}"},e.stringify=function(e){return"object"==typeof e?"[object Array]"==Object.prototype.toString.call(e)?this.stringifyArray(e):this.stringifyObject(e):JSON.stringify(e)},e.GetObjectPropertyDescriptor=function(e,t){for(var n=void 0;e!=Object.prototype&&void 0===(n=Object.getOwnPropertyDescriptor(e,t));)e=e.__proto__;return n},e.sendEvent=function(e,t){try{var i=document.createEvent("Event");i.initEvent(t,!0,!0),e.dispatchEvent(i)}catch(e){n.logger.log('sendEvent(): exception dispatching "'+t+'" event: '+e.message)}},e}(),t.Util=e}),define("webrpcclassinfo",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.HDXMS_VERSION="1.2.0.0";y=function(e,t,n,i){this.major=e,this.minor=t,this.revision=n,this.build=i};t.VersionData=y;var n=function(){};t.FeatureData=n,new(n=function(e,t){this.fature=e,this.version=t})("ms_teams_redirection",new y(1,1,0,0)),new n("ms_teams_desktop_sharing",new y(1,2,0,0)),function(e){e[e.EngineControl=0]="EngineControl",e[e.RTCPeerConnection=1]="RTCPeerConnection",e[e.RTCSessionDescription=2]="RTCSessionDescription",e[e.RTCIceCandidate=3]="RTCIceCandidate",e[e.RTCIceCandidateEvent=4]="RTCIceCandidateEvent",e[e.MediaDevices=5]="MediaDevices",e[e.MediaDeviceInfo=6]="MediaDeviceInfo",e[e.MediaStreamTrack=7]="MediaStreamTrack",e[e.MediaStreamEvent=8]="MediaStreamEvent",e[e.MediaStream=9]="MediaStream",e[e.NavigatorUserMedia=10]="NavigatorUserMedia",e[e.VideoElement=11]="VideoElement",e[e.AudioElement=12]="AudioElement"}(y=t.class_id_t||(t.class_id_t={})),function(e){e[e.ctor=0]="ctor",e[e.version=1]="version",e[e.feature_flags=2]="feature_flags",e[e.version_info=3]="version_info"}(n=t.method_id_EngineControl_t||(t.method_id_EngineControl_t={}));var i;!function(e){e[e.ctor=0]="ctor",e[e.localDescription=1]="localDescription",e[e.remoteDescription=2]="remoteDescription",e[e.readyState=3]="readyState",e[e.iceState=4]="iceState",e[e.localStreams=5]="localStreams",e[e.remoteStreams=6]="remoteStreams",e[e.createOffer=7]="createOffer",e[e.createAnswer=8]="createAnswer",e[e.setLocalDescription=9]="setLocalDescription",e[e.setRemoteDescription=10]="setRemoteDescription",e[e.updateIce=11]="updateIce",e[e.addIceCandidate=12]="addIceCandidate",e[e.addStream=13]="addStream",e[e.removeStream=14]="removeStream",e[e.close=15]="close",e[e.iceConnectionState=16]="iceConnectionState",e[e.iceGatheringState=17]="iceGatheringState",e[e.signalingState=18]="signalingState",e[e.onaddstream=19]="onaddstream",e[e.onicecandidate=20]="onicecandidate",e[e.oniceconnectionstatechange=21]="oniceconnectionstatechange",e[e.onicegatheringstatechange=22]="onicegatheringstatechange",e[e.onsignalingstatechange=23]="onsignalingstatechange",e[e.onnegotiationneeded=24]="onnegotiationneeded",e[e.onremovestream=25]="onremovestream",e[e.getStats=26]="getStats"}(i=t.method_id_RTCPeerConnection_t||(t.method_id_RTCPeerConnection_t={}));var o;!function(e){e[e.ctor=0]="ctor",e[e.enumerateDevices=1]="enumerateDevices",e[e.getDisplayMedia=2]="getDisplayMedia"}(o=t.method_id_MediaDevices_t||(t.method_id_MediaDevices_t={}));var r;!function(e){e[e.ctor=0]="ctor",e[e.deviceId=1]="deviceId",e[e.kind=2]="kind",e[e.label=3]="label",e[e.groupId=4]="groupId"}(r=t.method_id_MediaDeviceInfo_t||(t.method_id_MediaDeviceInfo_t={}));var a;!function(e){e[e.ctor=0]="ctor",e[e.type=1]="type",e[e.sdp=2]="sdp"}(a=t.method_id_RTCSessionDescription_t||(t.method_id_RTCSessionDescription_t={}));var c;!function(e){e[e.ctor=0]="ctor",e[e.kind=1]="kind",e[e.id=2]="id",e[e.label=3]="label",e[e.enabled=4]="enabled",e[e.muted=5]="muted",e[e.readyState=6]="readyState",e[e.onended=7]="onended",e[e.onmute=8]="onmute",e[e.onunmute=9]="onunmute",e[e.clone=10]="clone",e[e.stop=11]="stop",e[e.getCapabilities=12]="getCapabilities",e[e.getSettings=13]="getSettings",e[e.applyConstraints=14]="applyConstraints"}(c=t.method_id_MediaStreamTrack_t||(t.method_id_MediaStreamTrack_t={}));var s;!function(e){e[e.ctor=0]="ctor",e[e.id=1]="id",e[e.getAudioTracks=2]="getAudioTracks",e[e.getVideoTracks=3]="getVideoTracks",e[e.getTracks=4]="getTracks",e[e.getTrackById=5]="getTrackById",e[e.addTrack=6]="addTrack",e[e.removeTrack=7]="removeTrack",e[e.clone=8]="clone",e[e.active=9]="active"}(s=t.method_id_MediaStream_t||(t.method_id_MediaStream_t={}));var d;!function(e){e[e.ctor=0]="ctor",e[e.getUserMedia=1]="getUserMedia"}(d=t.method_id_NavigatorUserMedia_t||(t.method_id_NavigatorUserMedia_t={}));var l;!function(e){e[e.ctor=0]="ctor",e[e.candidate=1]="candidate",e[e.sdpMid=2]="sdpMid",e[e.sdpMLineIndex=3]="sdpMLineIndex"}(l=t.method_id_RTCIceCandidate_t||(t.method_id_RTCIceCandidate_t={}));var u;!function(e){e[e.ctor=0]="ctor",e[e.candidate=1]="candidate"}(u=t.method_id_RTCIceCandidateEvent_t||(t.method_id_RTCIceCandidateEvent_t={}));var g;!function(e){e[e.ctor=0]="ctor",e[e.stream=1]="stream"}(g=t.method_id_MediaStreamEvent_t||(t.method_id_MediaStreamEvent_t={}));var f;!function(e){e[e.ctor=0]="ctor",e[e.sinkId=1]="sinkId",e[e.connectTo=2]="connectTo",e[e.disconnect=3]="disconnect",e[e.setFrame=4]="setFrame",e[e.addClipRect=5]="addClipRect",e[e.removeClipRect=6]="removeClipRect",e[e.onerror=7]="onerror",e[e.onvideoframechanged=8]="onvideoframechanged"}(f=t.method_id_VideoElement_t||(t.method_id_VideoElement_t={}));var p;!function(e){e[e.ctor=0]="ctor",e[e.sinkId=1]="sinkId",e[e.srcObject=2]="srcObject",e[e.src=3]="src",e[e.play=4]="play",e[e.pause=5]="pause"}(p=t.method_id_AudioElement_t||(t.method_id_AudioElement_t={}));var h=function(e,t,n,i,o){void 0===o&&(o="ms_teams_redirection"),this.iid=e,this.mid=t,this.name=n,this.isprop=i,this.feature=o};t.WebrpcMethodInfo=h;var m=function(e,t,n){this.id=e,this.name=t,this.methods=n};t.WebrpcClassInfo=m;var _=new function(e,t){this.name=e,this.classes=t}("msteams_class_library",[new m(y.EngineControl,"EngineControl",[new h(y.EngineControl,n.ctor,"ctor",!1),new h(y.EngineControl,n.version,"version",!0),new h(y.EngineControl,n.feature_flags,"feature_flags",!0),new h(y.EngineControl,n.version_info,"version_info",!0,"ms_teams_desktop_sharing")]),new m(y.RTCPeerConnection,"RTCPeerConnection",[new h(y.RTCPeerConnection,i.ctor,"ctor",!1),new h(y.RTCPeerConnection,i.localDescription,"localDescription",!0),new h(y.RTCPeerConnection,i.remoteDescription,"remoteDescription",!0),new h(y.RTCPeerConnection,i.readyState,"readyState",!0),new h(y.RTCPeerConnection,i.iceState,"iceState",!0),new h(y.RTCPeerConnection,i.localStreams,"localStreams",!0),new h(y.RTCPeerConnection,i.remoteStreams,"remoteStreams",!0),new h(y.RTCPeerConnection,i.createOffer,"createOffer",!1),new h(y.RTCPeerConnection,i.createAnswer,"createAnswer",!1),new h(y.RTCPeerConnection,i.setLocalDescription,"setLocalDescription",!1),new h(y.RTCPeerConnection,i.setRemoteDescription,"setRemoteDescription",!1),new h(y.RTCPeerConnection,i.updateIce,"updateIce",!0),new h(y.RTCPeerConnection,i.addIceCandidate,"addIceCandidate",!0),new h(y.RTCPeerConnection,i.addStream,"addStream",!0),new h(y.RTCPeerConnection,i.removeStream,"removeStream",!0),new h(y.RTCPeerConnection,i.close,"close",!0),new h(y.RTCPeerConnection,i.iceConnectionState,"iceConnectionState",!0),new h(y.RTCPeerConnection,i.iceGatheringState,"iceGatheringState",!0),new h(y.RTCPeerConnection,i.signalingState,"signalingState",!0),new h(y.RTCPeerConnection,i.onaddstream,"onaddstream",!0),new h(y.RTCPeerConnection,i.onicecandidate,"onicecandidate",!0),new h(y.RTCPeerConnection,i.oniceconnectionstatechange,"oniceconnectionstatechange",!0),new h(y.RTCPeerConnection,i.onicegatheringstatechange,"onicegatheringstatechange",!0),new h(y.RTCPeerConnection,i.onsignalingstatechange,"onsignalingstatechange",!0),new h(y.RTCPeerConnection,i.onnegotiationneeded,"onnegotiationneeded",!0),new h(y.RTCPeerConnection,i.onremovestream,"onremovestream",!0),new h(y.RTCPeerConnection,i.getStats,"getStats",!1)]),new m(y.RTCSessionDescription,"RTCSessionDescription",[new h(y.RTCSessionDescription,a.ctor,"ctor",!1),new h(y.RTCSessionDescription,a.type,"type",!0),new h(y.RTCSessionDescription,a.sdp,"sdp",!0)]),new m(y.RTCIceCandidate,"RTCIceCandidate",[new h(y.RTCIceCandidate,l.ctor,"ctor",!1),new h(y.RTCIceCandidate,l.candidate,"candidate",!0),new h(y.RTCIceCandidate,l.sdpMid,"sdpMid",!0),new h(y.RTCIceCandidate,l.sdpMLineIndex,"sdpMLineIndex",!0)]),new m(y.RTCIceCandidateEvent,"RTCIceCandidateEvent",[new h(y.RTCIceCandidateEvent,u.ctor,"ctor",!1),new h(y.RTCIceCandidateEvent,u.candidate,"candidate",!0)]),new m(y.MediaDevices,"MediaDevices",[new h(y.MediaDevices,o.ctor,"ctor",!1),new h(y.MediaDevices,o.enumerateDevices,"enumerateDevices",!1),new h(y.MediaDevices,o.getDisplayMedia,"getDisplayMedia",!1,"ms_teams_desktop_sharing")]),new m(y.MediaDeviceInfo,"MediaDeviceInfo",[new h(y.MediaDeviceInfo,r.ctor,"ctor",!1),new h(y.MediaDeviceInfo,r.deviceId,"deviceId",!0),new h(y.MediaDeviceInfo,r.kind,"kind",!0),new h(y.MediaDeviceInfo,r.label,"label",!0),new h(y.MediaDeviceInfo,r.groupId,"groupId",!0)]),new m(y.MediaStreamTrack,"MediaStreamTrack",[new h(y.MediaStreamTrack,c.ctor,"ctor",!1),new h(y.MediaStreamTrack,c.clone,"clone",!1),new h(y.MediaStreamTrack,c.stop,"stop",!1),new h(y.MediaStreamTrack,c.getCapabilities,"getCapabilities",!1),new h(y.MediaStreamTrack,c.getSettings,"getSettings",!1),new h(y.MediaStreamTrack,c.applyConstraints,"applyConstraints",!1,"ms_teams_desktop_sharing"),new h(y.MediaStreamTrack,c.kind,"kind",!0),new h(y.MediaStreamTrack,c.id,"id",!0),new h(y.MediaStreamTrack,c.label,"label",!0),new h(y.MediaStreamTrack,c.enabled,"enabled",!0),new h(y.MediaStreamTrack,c.muted,"muted",!0),new h(y.MediaStreamTrack,c.readyState,"readyState",!0),new h(y.MediaStreamTrack,c.onended,"onended",!0),new h(y.MediaStreamTrack,c.onmute,"onmute",!0),new h(y.MediaStreamTrack,c.onunmute,"onunmute",!0)]),new m(y.MediaStream,"MediaStream",[new h(y.MediaStream,s.ctor,"ctor",!1),new h(y.MediaStream,s.id,"id",!0),new h(y.MediaStream,s.getAudioTracks,"getAudioTracks",!1),new h(y.MediaStream,s.getVideoTracks,"getVideoTracks",!1),new h(y.MediaStream,s.getTracks,"getTracks",!1),new h(y.MediaStream,s.getTrackById,"getTrackById",!1),new h(y.MediaStream,s.addTrack,"addTrack",!1),new h(y.MediaStream,s.removeTrack,"removeTrack",!1),new h(y.MediaStream,s.clone,"clone",!0),new h(y.MediaStream,s.active,"active",!0)]),new m(y.NavigatorUserMedia,"NavigatorUserMedia",[new h(y.NavigatorUserMedia,d.ctor,"ctor",!1),new h(y.NavigatorUserMedia,d.getUserMedia,"getUserMedia",!1)]),new m(y.MediaStreamEvent,"MediaStreamEvent",[new h(y.MediaStreamEvent,g.ctor,"ctor",!1),new h(y.MediaStreamEvent,g.stream,"stream",!0)]),new m(y.VideoElement,"VideoElement",[new h(y.VideoElement,f.ctor,"ctor",!1),new h(y.VideoElement,f.sinkId,"sinkId",!0),new h(y.VideoElement,f.connectTo,"connectTo",!1),new h(y.VideoElement,f.disconnect,"disconnect",!1),new h(y.VideoElement,f.setFrame,"setFrame",!1),new h(y.VideoElement,f.addClipRect,"addClipRect",!1),new h(y.VideoElement,f.removeClipRect,"removeClipRect",!1),new h(y.VideoElement,f.onerror,"onerror",!0),new h(y.VideoElement,f.onvideoframechanged,"onvideoframechanged",!0)]),new m(y.AudioElement,"AudioElement",[new h(y.AudioElement,p.ctor,"ctor",!1),new h(y.AudioElement,p.sinkId,"sinkId",!0),new h(y.AudioElement,p.srcObject,"srcObject",!0),new h(y.AudioElement,p.src,"src",!0),new h(y.AudioElement,p.play,"play",!1),new h(y.AudioElement,p.pause,"pause",!1)])]),y=function(){function e(){}return e.getInterfaceByid=function(e){for(var t=0,n=_.classes;t<n.length;t++){var i=n[t];if(i.id==e)return i}return null},e.getMethodByid=function(e,t){if(null!=(i=this.getInterfaceByid(e)))for(var n=0,i=i.methods;n<i.length;n++){var o=i[n];if(o.mid==t)return o}return null},e.getMethodFeatureByid=function(e,t){if(null!=(i=this.getInterfaceByid(e)))for(var n=0,i=i.methods;n<i.length;n++){var o=i[n];if(o.mid==t)return o.feature}return null},e.composeClassInfoData=function(e){if(void 0==(e=e.hdr))return"*** Invalid packet: Couldn't find hdr object ***";if(void 0==(t=e.proc))return"";e=t.iid;for(var t=t.methodid,n=0,i=_.classes;n<i.length;n++){var o=i[n];if(o.id==e)for(var r=0,a=o.methods;r<a.length;r++){var c=a[r];if(c.mid==t)return o.name+"::"+c.name}}return""},e}();t.WebrpcClassLibInfoUtil=y}),define("wsjsonutil",["require","exports","webrpcclassinfo"],function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i;!function(e){e[e.req=0]="req",e[e.reply=1]="reply",e[e.event_req=2]="event_req",e[e.event_reply=3]="event_reply"}(i=t.ws_msg_type_t||(t.ws_msg_type_t={})),e=function(){function e(){}return e.createMessageByid=function(e,t,i,o,r,a){for(var c=[],s=6;s<arguments.length;s++)c[s-6]=arguments[s];return(s=n.WebrpcClassLibInfoUtil.getMethodByid(o,r))&&s.isprop||(e=!1),this.createMessage.apply(this,[i,e,t,o,r,a].concat(c))},e.createMessage=function(e,t,n,i,o,r){for(var a=[],c=6;c<arguments.length;c++)a[c-6]=arguments[c];return{v:"webrtc",hdr:{version:this._version,msg_type:this.getMsgType(e),modifier:t,destroy:n,proc:{iid:i,methodid:o}},objref:{oid:r},params:a.slice()}},e.getMsgType=function(e){var t="";switch(e){default:t="req";break;case i.reply:t="reply";break;case i.event_req:t="event-req";break;case i.event_reply:t="event-reply"}return t},e._version=1,e}(),t.WsJsonUtil=e}),define("garbagecollector",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.parent_=this.object_=null,this.children_=[],this.object_=e}return e.prototype.addChild=function(e){e.parent_!=this&&(e.parent_=this,this.children_.push(e))},e.prototype.removeChild=function(e){var t=this.children_.indexOf(e);this.children_.splice(t,1),e.parent_=null},e}(),i=function(){function e(){this.root_=new n(null)}return e.prototype.trackObject=function(e,t){if(void 0===t&&(t=null),null===this.findNode(e,this.root_)){var i=this.findNode(t,this.root_),o=new n(e);i.addChild(o)}},e.prototype.releaseObject=function(e){return null!==(e=this.findNode(e,this.root_))&&(this.destroyNodeObjectRecurse(e),e.parent_.removeChild(e),!0)},e.prototype.destroyNodeObjectRecurse=function(e){for(var t=0,n=e.children_;t<n.length;t++)this.destroyNodeObjectRecurse(n[t]);e.object_.destroy()},e.prototype.setParent=function(e,t){var n=this.findNode(e,this.root_);if(null===n)return!1;var i=this.findNode(t,this.root_);return null!==i&&(n.parent_===i||(n.parent_.removeChild(n),i.addChild(n),!0))},e.prototype.findNode=function(e,t){if(t.object_===e)return t;for(var n=null,i=0,o=t.children_;i<o.length&&null===(n=this.findNode(e,o[i]));i++);return n},e}();t.GC=i,t.gc=new i}),define("proxyobject","require exports hdxms logger wsjsonutil garbagecollector webrpcclassinfo".split(" "),function(e,t,n,i,o,r,a){Object.defineProperty(t,"__esModule",{value:!0});var c=function(){function e(e,t,n){this.resolve=e,this.reject=t,this.name=n}return e.prototype.post=function(e){1==e?(i.logger.log('deferred_action.post(): resolving "'+this.name+'"'),this.resolve()):(i.logger.log('deferred_action.post(): rejecting "'+this.name+'"'),this.reject())},e}();t.deferred_action=c;var s=function(e,t){this.id=e,this.is_null=t};t.rpc_callback=s;var d=function(){function e(e,t,n){this.success=new s(e<<16,t),this.fail=new s(e<<16|1,t),this.id=e,this.oneShot=n}return e.prototype.resolve=function(e){i.logger.trace("callback.resolve() called. [id="+this.id+"]"),null!=this.handler&&this.handler(e)},e.prototype.reject=function(){null!=this.err_handler&&this.err_handler()},e.prototype.then=function(e){this.handler=e},e.prototype.prom=function(){var e=this;return new Promise(function(t,n){e.handler=t,e.err_handler=n})},e}();t.callback=d;var l;!function(e){e[e.NotConfigured=0]="NotConfigured",e[e.Configured=1]="Configured",e[e.Error=2]="Error",e[e.Destroyed=3]="Destroyed"}(l||(l={})),e=function(){function e(t,c,s,d){for(var u=[],g=4;g<arguments.length;g++)u[g-4]=arguments[g];var f=this;this.hdxms=n.getRedirector(),this.iid=c,this.oid=s,this.state=l.NotConfigured,this.deferredActions=[],this.cbs=new Map,0==d?(g=!1,this.iid===a.class_id_t.EngineControl&&(g=!0),this.hdxms.startRedirection(g,this.user_friendly_id()).then(function(){f.oid=e.nextId++;var t=a.WebrpcClassLibInfoUtil.getMethodFeatureByid(c,0);return f.hdxms.WSSendObjectWrapper(t,c,0,o.WsJsonUtil.createMessageByid.apply(o.WsJsonUtil,[!1,!1,o.ws_msg_type_t.req,c,0,f.oid].concat(u)))}).then(function(e){i.logger.trace("ProxyObject: setting state to configured. (iid: "+f.iid+" oid: "+f.oid+")"),f.state=l.Configured,f.oid=f.param0(e),f.onConnected(),r.gc.trackObject(f,t)}).catch(function(){f.state=l.Error,f.onConnected()})):(this.state=l.Configured,r.gc.trackObject(this,t))}return e.prototype.setParent=function(e){r.gc.setParent(this,e)},e.prototype.release=function(){r.gc.releaseObject(this)},e.prototype.destroy=function(){this.state=l.Destroyed;var e=a.WebrpcClassLibInfoUtil.getMethodFeatureByid(this.iid,0);this.hdxms.WSSendObjectWrapper(e,this.iid,0,o.WsJsonUtil.createMessageByid(!1,!0,o.ws_msg_type_t.req,this.iid,0,this.oid))},e.prototype.onConnected=function(){for(;this.deferredActions&&0<this.deferredActions.length;)this.deferredActions.shift().post(this.state==l.Configured)},e.prototype.checkState=function(e,t){var n=this;0>=e?(i.logger.log("ProxyObject.checkState() timeout waiting for connection response! failed. (iid: "+n.iid+" oid: "+n.oid+")"),n.onConnected()):setTimeout(function(){n.state==l.Configured?n.onConnected():n.state==l.Error?n.onConnected():n.state==l.Destroyed?n.onConnected():(i.logger.log('ProxyObject.checkState(): count= "'+e+'". (iid: '+n.iid+" oid: "+n.oid+")"),n.checkState(--e,t))},t)},e.prototype.waitUntilConnected=function(e){var t=this;return new Promise(function(n,o){i.logger.trace("ProxyObject.waitUntilConnected(): readyState="+t.state+". (iid: "+t.iid+" oid: "+t.oid+")"),t.state==l.Destroyed&&(t.onConnected(),o("Object already destroyed :"+t.user_friendly_id())),t.state==l.Configured?(t.onConnected(),n()):t.state==l.Error?(i.logger.trace("ProxyObject.waitUntilConnected(): readyState="+t.state+". (iid: "+t.iid+" oid: "+t.oid+")"),t.onConnected(),o()):(i.logger.log('ProxyObject.waitUntilConnected(): deferring action "'+e+'". (iid: '+t.iid+" oid: "+t.oid+")"),t.deferredActions.push(new c(n,o,e)),t.checkState(15,1e3))})},e.prototype.remoteInvoke=function(e,t){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];return this.state==l.Destroyed?Promise.reject("Cannot invoke destroyed object :"+this.user_friendly_id()):(i=a.WebrpcClassLibInfoUtil.getMethodFeatureByid(this.iid,t),this.hdxms.WSSendObjectWrapper(i,this.iid,t,o.WsJsonUtil.createMessageByid.apply(o.WsJsonUtil,[e,!1,o.ws_msg_type_t.req,this.iid,t,this.oid].concat(n))))},e.prototype.registerCallbacks=function(t,n,i){this.unregisterCallbacks(i);var o=e.nextcbid++,r=new d(o,n,t);return n||(t||this.cbs.set(i,o),this.hdxms.registerHandler(this.iid,this.oid,r)),r},e.prototype.unregisterCallbacks=function(e){this.cbs.has(e)?(this.hdxms.unregisterHandler(this.iid,this.oid,this.cbs.get(e)),this.cbs.delete(e)):(i.logger.log("ProxyObject: Cant find callback handler registration for mid: "+e),i.logger.trace(this.cbs))},e.prototype.object_id=function(){return this.oid},e.prototype.param0=function(e){return e.params[0]},e.prototype.isNullCallback=function(e){return void 0==e||null==e},e.prototype.user_friendly_id=function(){return this.constructor.name+"["+this.oid+"]"},e.prototype.isRedirected=function(){return this.hdxms.isRedirected()},e.nextId=0,e.nextcbid=0,e}(),t.ProxyObject=e}),define("hdxms","require exports proxyobject logger webrpcclassinfo wsjsonutil".split(" "),function(e,t,n,i,o,r){Object.defineProperty(t,"__esModule",{value:!0});var a,c=function(e,t,n,i,o,r,a){this.resolve=e,this.reject=t,this.iid=n,this.oid=i,this.cbid=o,this.oneShot=r,this.mid=a};!function(e){e[e.NotRedirected=0]="NotRedirected",e[e.Connecting=1]="Connecting",e[e.Binding=2]="Binding",e[e.Redirected=3]="Redirected"}(a=t.RedirectionStatus||(t.RedirectionStatus={})),e=function(){function e(){this.status=a.NotRedirected,this.reqs=[],this.cbs=[],this.deferredActions=[]}return e.prototype.setRemoteSessionInfoCb=function(e){this.remoteSessionInfoCb=e},e.prototype.setFeatures=function(e){this.features=e},e.prototype.onRedirectionComplete=function(){for(;this.deferredActions&&0<this.deferredActions.length;)this.deferredActions.shift().post(this.status==a.Redirected)},e.prototype.connectToService=function(){return i.logger.log("Redirection status: Connecting..."),this.status=a.Connecting,new Promise(function(e,t){var n=new WebSocket("wss://127.0.0.1:9002");n.onopen=function(){e(n)},n.onerror=function(e){i.logger.log("websocket connection error: "+e.type),t(e)}})},e.prototype.waitUntilRedirected=function(e){var t=this;return new Promise(function(n,o){t.status==a.Redirected?n():0>=e?o():setTimeout(function(){i.logger.log("waitUntilRedirected() timeout. count="+e),t.status!=a.Redirected?t.waitUntilRedirected(--e).then(function(){n()}).catch(function(){o()}):n()},2e3)})},e.prototype.startRedirection=function(e,t){var o=this,r=window.onVdiUnableToRemote;return new Promise(function(c,s){o.status==a.NotRedirected?(i.logger.log("Attempting to start redirection: "+t),0==e?o.deferredActions.push(new n.deferred_action(c,s,t)):o.connectToService().then(function(e){i.logger.log("Redirection status: Binding..."),o.status=a.Binding,o.websocket=e,o.websocket.onmessage=function(e){o.onWSMessage(e)},o.websocket.onclose=function(e){o.onWSClose(e)},c(),o.remoteSessionInfoCb?o.remoteSessionInfoCb().then(function(e){i.logger.log("getSessionInfo success! info:"+JSON.stringify(e)),i.logger.log("Redirection status: Redirected"),o.status=a.Redirected,o.pingConnectionEnd(),(0,window.onVdiClientConnected)(),o.onRedirectionComplete()}).catch(function(){i.logger.log("getSessionInfo failure!"),o.suspendRedirection(!0),o.onRedirectionComplete()}):(i.logger.log("getSessionInfo failure!"),o.suspendRedirection(!0),o.onRedirectionComplete())}).catch(function(e){i.logger.log("Unable to connect to websocket service!"),s(),o.suspendRedirection(!0),o.onRedirectionComplete(),r()})):o.status==a.Connecting||o.status==a.Binding?(i.logger.log("Waiting for start redirection to finish"),o.waitUntilRedirected(15).then(function(){i.logger.log("Waiting for start redirection: success"),c()}).catch(function(){i.logger.log("Waiting for start redirection: failed"),s(),r()})):(i.logger.log("Redirection already started."),c())})},e.prototype.suspendRedirection=function(e){i.logger.log("Suspending redirection."),(0,window.onVdiClientDisconnected)(),this.status===a.Redirected&&this.pingConnectionBegin(),i.logger.log("Redirection status: NotRedirected"),this.status=a.NotRedirected},e.prototype.onWSOpen=function(){},e.prototype.onWSClose=function(e){i.logger.log("disconnected from websocket service.");try{this.suspendRedirection(!0)}catch(e){i.logger.log("suspendRedirection(): exception closing WebSocket: "+e.message)}},e.prototype.onWSError=function(){try{this.suspendRedirection(!0)}catch(e){i.logger.log("suspendRedirection(): exception on WebSocket error: "+e.message)}},e.prototype.WSSendObjectWrapper=function(e,t,n,i){a=!0;t!=o.class_id_t.EngineControl||n!=o.method_id_EngineControl_t.ctor&&n!=o.method_id_EngineControl_t.version&&n!=o.method_id_EngineControl_t.feature_flags||(a=!1);var r=!0;if(a&&(r=!1,void 0!=this.features))for(var a=0,c=this.features;a<c.length;a++){var s=c[a];if(!0===s.value&&s.name==e){r=!0;break}}return 1==r?this.WSSendObject(i):Promise.reject("Cannot invoke method that is not supported by webrpc: iid("+t+") mid("+n+")")},e.prototype.WSSendObject=function(e){var t=this;return new Promise(function(n,r){if("webrtc"==e.v){var a=e.hdr.proc.iid,s=e.hdr.proc.methodid,d=e.objref.oid,l=e.hdr.destroy;e.hdr.modifier||l||(a=new c(n,r,a,d,0,!0,s),t.reqs.push(a)),a=JSON.stringify(e),i.logger.trace("WSSendObject: >>> "+o.WebrpcClassLibInfoUtil.composeClassInfoData(e)+" "+a);try{t.websocket.send(a)}catch(e){i.logger.log("WSSendObject(): exception: "+e.message),r(e.message)}}else"overlay"==e.v?(a=JSON.stringify(e),i.logger.log("HDXMS: SendOverlayData: >>> "+a+"'"),t.websocket.send(a)):i.logger.log("HDXMS: Unknown protocol: '"+JSON.stringify(e)+"'")})},e.prototype.onWSMessage=function(e){var t,n=e.data;try{t=JSON.parse(n)}catch(e){console.log("invalid JSON!!!"),console.log(e),console.log(n)}if("webrtc"==t.v){i.logger.trace("onWSMessage: <<< "+o.WebrpcClassLibInfoUtil.composeClassInfoData(t)+" "+n);var a=t.hdr.proc.iid,c=t.hdr.proc.methodid,s=t.objref.oid;if(e=t.status,t.hdr.msg_type==r.WsJsonUtil.getMsgType(r.ws_msg_type_t.reply))0<=(n=this.reqs.findIndex(function(e){return e.iid==a&&e.oid==s&&e.mid==c}))?0==e?this.reqs.splice(n,1).shift().resolve(t):this.reqs.splice(n,1).shift().reject():(i.logger.log("HDXMS didnt find this one. (reqs)"),i.logger.log(this.reqs));else if(t.hdr.msg_type==r.WsJsonUtil.getMsgType(r.ws_msg_type_t.event_req)){var d=t.func.id;0<=(n=this.cbs.findIndex(function(e){return e.iid==a&&e.oid==s&&e.cbid==d>>16}))?(0==(65535&d)?this.cbs[n].resolve(t):this.cbs[n].reject(),1==this.cbs[n].oneShot&&this.cbs.splice(n,1)):(i.logger.log("HDXMS didnt find this one. (cbs)"),i.logger.log(this.cbs))}else i.logger.log("HDXMS Received bogus message: "+n+"'")}else i.logger.log("HDXMS: Unknown protocol: "+n+"'")},e.prototype.registerHandler=function(e,t,n){e=new c(n.resolve.bind(n),n.reject.bind(n),e,t,n.id,n.oneShot,0),this.cbs.push(e)},e.prototype.unregisterHandler=function(e,t,n){var o=this.cbs.findIndex(function(i){return i.iid==e&&i.oid==t&&i.cbid==n});0<=o?this.cbs.splice(o,1):(i.logger.log("HDXMS Didnt find this callback in the list!"),console.log(this.cbs))},e.prototype.isRedirected=function(){return this.status===a.Redirected||this.status===a.Binding||this.status===a.Connecting},e.prototype.pingConnectionBegin=function(){this.conntimer_=setInterval(function(){i.logger.log("checking if we are connected..."),(0,window.onVdiClientDisconnectedTimer)()},15e3)},e.prototype.pingConnectionEnd=function(){clearInterval(this.conntimer_)},e}(),t.HdxMediaStream=e;var s=new e;t.getRedirector=function(){return s}}),define("remotemedia",["require","exports","webrpcclassinfo","proxyobject","logger"],function(e,t,n,i,o){Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t){this.type=e,this.target=t},a=function(){function e(){this.is_local_clone=!1,this.clone_id=this.clone_count=0}return e.prototype.clone=function(){this.clone_count++;var t=new e;return t.is_local_clone=!0,t.clone_id=this.clone_count,t},e.prototype.synchronize=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this.is_local_clone?[2,e.asyncClone()]:[2,e]})})},e}(),c=function(e){function t(t,i){var o=e.call(this,t,n.class_id_t.MediaStreamTrack,i,!0)||this;return o.refCount_=0,o.clone_state=new a,o}return __extends(t,e),t.prototype.addRef=function(){this.refCount_++},Object.defineProperty(t.prototype,"onended",{get:function(){return o.logger.log(this.user_friendly_id()+".get_onended() called. [id="+this.id+"]"),this.onended_},set:function(e){var t=this;o.logger.log(this.user_friendly_id()+".set_onended() called. [id="+this.id+"]"),this.onended_=e,this.waitUntilConnected("MediaStreamTrack.onended").then(function(){var i=t.registerCallbacks(!1,t.isNullCallback(e),n.method_id_MediaStreamTrack_t.onended);return i.then(function(e){o.logger.log(t.user_friendly_id()+"onended event received!!!"),e=new r("ended",t),t.readyState_="ended",t.onended_(e)}),t.remoteInvoke(!0,n.method_id_MediaStreamTrack_t.onended,i.success)}).catch(function(){o.logger.log(t.user_friendly_id()+".onended failed!!!")})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onmute",{get:function(){return o.logger.log(this.user_friendly_id()+".get_onmute() called. [id="+this.id+"]"),this.onmute_},set:function(e){var t=this;o.logger.log(this.user_friendly_id()+".set_onmute() called. [id="+this.id+"]"),this.onmute_=e,this.waitUntilConnected("MediaStreamTrack.onmute").then(function(){var i=t.registerCallbacks(!1,t.isNullCallback(e),n.method_id_MediaStreamTrack_t.onmute);return i.then(function(e){o.logger.log(t.user_friendly_id()+"onmute event received!!!"),e=new r("mute",t),t.muted=!0,t.onmute_(e)}),t.remoteInvoke(!0,n.method_id_MediaStreamTrack_t.onmute,i.success)}).catch(function(){o.logger.log(t.user_friendly_id()+".onmute failed!!!")})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onunmute",{get:function(){return o.logger.log(this.user_friendly_id()+".get_onunmute() called. [id="+this.id+"]"),this.onunmute_},set:function(e){var t=this;o.logger.log(this.user_friendly_id()+".set_onunmute() called. [id="+this.id+"]"),this.onunmute_=e,this.waitUntilConnected("MediaStreamTrack.onunmute").then(function(){var i=t.registerCallbacks(!1,t.isNullCallback(e),n.method_id_MediaStreamTrack_t.onunmute);return i.then(function(e){o.logger.log("onunmute event received!!!"),e=new r("unmute",t),t.muted=!1,t.onunmute_(e)}),t.remoteInvoke(!0,n.method_id_MediaStreamTrack_t.onunmute,i.success)}).catch(function(){o.logger.log(t.user_friendly_id()+".onunmute failed!!!")})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onstop",{set:function(e){this.onstop_=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"enabled",{get:function(){return o.logger.log(this.user_friendly_id()+".get_enabled() called. [id="+this.id+", value="+this.enabled_+"]"),this.enabled_},set:function(e){o.logger.log(this.user_friendly_id()+".set_enabled() called. [id="+this.id+", value="+e+"]"),this.enabled_=e,this.remoteInvoke(!0,n.method_id_MediaStreamTrack_t.enabled,e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"readyState",{get:function(){return o.logger.log(this.user_friendly_id()+".get_readyState() called. [id="+this.id+"]"),this.readyState_},enumerable:!0,configurable:!0}),t.prototype.asyncClone=function(){return __awaiter(this,void 0,void 0,function(){var e,i,o;return __generator(this,function(r){switch(r.label){case 0:return[4,this.waitUntilConnected("RemoteMediaTrack.asyncClone")];case 1:return r.sent(),[4,this.remoteInvoke(!1,n.method_id_MediaStreamTrack_t.clone,[])];case 2:return e=r.sent(),i=this.param0(e),o=new t(this,i.oid),[2,o.syncBarrier()]}})})},t.prototype.clone=function(){o.logger.log(this.user_friendly_id()+".clone() called. [id="+this.id+"]");var e=this.clone_state.clone(),n=new t(this,this.object_id());return n.id=this.id+"."+e.clone_id.toString(),n.label=this.label,n.kind=this.kind,n.enabled_=this.enabled_,n.muted=this.muted,n.readyState_=this.readyState_,n.trackSettings_=this.trackSettings_,n.clone_state=e,n},t.prototype.stop=function(){var e=this;o.logger.log(this.user_friendly_id()+".stop() called. [id="+this.id+"]"),this.readyState_="ended",this.remoteInvoke(!1,n.method_id_MediaStreamTrack_t.stop).catch(function(t){o.logger.log(e.user_friendly_id()+".stop() failed with:"+t)}),0<this.refCount_?this.refCount_--:null!==this.onstop_&&this.onstop_()},t.prototype.getCapabilities=function(){o.logger.log(this.user_friendly_id()+".getCapabilities() called. [id="+this.id+"]")},t.prototype.getConstrains=function(){o.logger.log(this.user_friendly_id()+".getConstrains() called. [id="+this.id+"]")},t.prototype.getSettings=function(){return"audio"==this.kind?function(e){return{deviceId:e.deviceId,echoCancellation:e.echoCancellation}}(this.trackSettings_):function(e){return{aspectRatio:e.aspectRatio,deviceId:e.deviceId,frameRate:e.frameRate,height:e.height,width:e.width}}(this.trackSettings_)},t.prototype.applyConstraints=function(e){var t=this;return o.logger.log("MediaStreamTrack.applyConstraints() called."),new Promise(function(i,o){t.waitUntilConnected("MediaStreamTrack.applyConstraints").then(function(){return t.remoteInvoke(!1,n.method_id_MediaStreamTrack_t.applyConstraints,e)}).then(function(){i()}).catch(function(){o({name:"OverconstrainedError",message:"Failed to apply constraints."})})})},t.convertReadyState=function(e){return 0==e?"live":"ended"},t.prototype.syncBarrier=function(){var e=this;return o.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise(function(i,o){e.waitUntilConnected("MediaStreamTrack.syncBarrier").then(function(){return Promise.all([e.remoteInvoke(!1,n.method_id_MediaStreamTrack_t.kind,""),e.remoteInvoke(!1,n.method_id_MediaStreamTrack_t.id,""),e.remoteInvoke(!1,n.method_id_MediaStreamTrack_t.label,""),e.remoteInvoke(!1,n.method_id_MediaStreamTrack_t.enabled,!1),e.remoteInvoke(!1,n.method_id_MediaStreamTrack_t.muted,!1),e.remoteInvoke(!1,n.method_id_MediaStreamTrack_t.readyState,0),e.remoteInvoke(!1,n.method_id_MediaStreamTrack_t.getSettings)])}).then(function(n){var o=0;n=n.map(function(t){return e.param0(t)}),e.kind=n[0],e.id=n[1],e.label=n[2],e.enabled_=n[3],e.muted=n[4],o=n[5],e.trackSettings_=n[6],e.readyState_=t.convertReadyState(o),i(e)}).catch(function(){o()})})},t}(i.ProxyObject);t.RemoteMediaTrack=c;var s=function(e){function t(t,i){var o=e.call(this,t,n.class_id_t.MediaStream,i,!0)||this;return o.clone_state=new a,o}return __extends(t,e),t.prototype.toJSON=function(){return"RemoteStream to json"},t.prototype.getAudioTracks=function(){o.logger.log(this.user_friendly_id()+".getAudioTracks() called. [id="+this.id+"]");for(var e=[],t=0,n=this.tracks_;t<n.length;t++){var i=n[t];"audio"==i.kind&&e.push(i)}return e},t.prototype.getVideoTracks=function(){o.logger.log(this.user_friendly_id()+".getVideoTracks() called. [id="+this.id+"]");for(var e=[],t=0,n=this.tracks_;t<n.length;t++){var i=n[t];"video"==i.kind&&e.push(i)}return e},t.prototype.getTracks=function(){return o.logger.log(this.user_friendly_id()+".getTracks() called. [id="+this.id+"]"),this.tracks_},t.prototype.getTrackById=function(e){o.logger.log(this.user_friendly_id()+".getTrackById() called. [id="+this.id+"]");for(var t=0,n=this.tracks_;t<n.length;t++){var i=n[t];if(i.id==e)return i}},t.prototype.addTrack=function(e){o.logger.log(this.user_friendly_id()+".addTrack() called. [id="+this.id+"]"),this.tracks_.push(e),this.remoteInvoke(!1,n.method_id_MediaStream_t.addTrack,{oid:e.object_id()})},t.prototype.removeTrack=function(e){o.logger.log(this.user_friendly_id()+".removeTrack() called. [id="+this.id+"]");var t=this.tracks_.indexOf(e);this.tracks_.splice(t,1),this.remoteInvoke(!1,n.method_id_MediaStream_t.removeTrack,{oid:e.object_id()})},t.prototype.asyncClone=function(){return __awaiter(this,void 0,void 0,function(){var e,i,r;return __generator(this,function(a){switch(a.label){case 0:return o.logger.log(this.user_friendly_id()+".asyncClone() called. [id="+this.id+"]"),[4,this.waitUntilConnected("asyncClone")];case 1:return a.sent(),[4,this.remoteInvoke(!1,n.method_id_MediaStream_t.clone,[])];case 2:return e=a.sent(),console.log(e),i=this.param0(e),r=new t(this,i.oid),[2,r.syncBarrier()]}})})},t.prototype.clone=function(){o.logger.log(this.user_friendly_id()+".clone() called. [id="+this.id+"]");var e=this.clone_state.clone(),n=new t(this,this.object_id());return n.id=this.id+"."+e.clone_id.toString(),this.tracks_.forEach(function(e){e.addRef()}),n.tracks_=this.tracks_,n.clone_state=e,n},t.prototype.syncBarrier=function(){var e=this;return o.logger.log(this.user_friendly_id()+".syncBarrier() called. [id="+this.id+"]"),new Promise(function(t,i){e.waitUntilConnected("MediaStream.syncBarrier").then(function(){return Promise.all([e.remoteInvoke(!1,n.method_id_MediaStream_t.id,""),e.remoteInvoke(!1,n.method_id_MediaStream_t.active,!1),e.remoteInvoke(!1,n.method_id_MediaStream_t.getTracks,[])])}).then(function(t){t=t.map(function(t){return e.param0(t)}),e.id=t[0],e.active=t[1],t=t[2];for(var n=[],i=0;i<t.length;i++){var o=new c(e,t[i].oid);n.push(o.syncBarrier())}return Promise.all(n)}).then(function(n){e.tracks_=[],n.forEach(function(t){t.onstop=function(){var t=!0;e.tracks_.forEach(function(e){"ended"!=e.readyState&&(t=!1)}),t&&e.release()},e.tracks_.push(t)}),t(e)}).catch(function(){i()})})},t}(i.ProxyObject);t.RemoteStream=s,e=function(e){function t(t,i){return e.call(this,t,n.class_id_t.MediaStreamEvent,i,!0)||this}return __extends(t,e),t.prototype.syncBarrier=function(){var e=this;return o.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise(function(t,i){e.waitUntilConnected("MediaStreamEvent.syncBarrier").then(function(){return e.remoteInvoke(!1,n.method_id_MediaStreamEvent_t.stream,{oid:0})}).then(function(t){return new s(e,t.params[0].oid).syncBarrier()}).then(function(n){e.stream=n,t(e)}).catch(function(){i()})})},t}(i.ProxyObject),t.RemoteStreamEvent=e;var d=function(e){function t(t){return e.call(this,null,n.class_id_t.MediaDeviceInfo,t,!0)||this}return __extends(t,e),t.prototype.convertKind=function(e){return 0==e?"audioinput":1==e?"audiooutput":"videoinput"},t.prototype.syncBarrier=function(){var e=this;return o.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise(function(t,i){e.waitUntilConnected("RemoteDeviceInfo.syncBarrier").then(function(){return Promise.all([e.remoteInvoke(!1,n.method_id_MediaDeviceInfo_t.deviceId,""),e.remoteInvoke(!1,n.method_id_MediaDeviceInfo_t.kind,0),e.remoteInvoke(!1,n.method_id_MediaDeviceInfo_t.label,""),e.remoteInvoke(!1,n.method_id_MediaDeviceInfo_t.groupId,"")])}).then(function(n){e.kind=e.convertKind(e.param0(n.splice(1,1)[0])),n=n.map(function(t){return e.param0(t)}),e.deviceId=n[0],e.label=n[1],e.groupId=n[2],t(e)}).catch(function(){o.logger.log(e.user_friendly_id()+".syncBarrier(): rejected."),i()})})},t}(i.ProxyObject);t.RemoteDeviceInfo=d,e=function(e){function t(){var t=e.call(this,null,n.class_id_t.MediaDevices,0,!1)||this;return t.devices_=[],t}return __extends(t,e),t.prototype.enumerateDevices=function(){var e=this;return o.logger.log(this.user_friendly_id()+".enumerateDevices() called"),new Promise(function(t,i){e.waitUntilConnected("RemoteDevices.enumerateDevices").then(function(){return e.remoteInvoke(!1,n.method_id_MediaDevices_t.enumerateDevices,[])}).then(function(t){var n=[];return t.params[0].forEach(function(t){var i=e.devices_.find(function(e){return e.object_id()===t.oid});void 0===i?(i=new d(t.oid),n.push(i.syncBarrier())):n.push(i)}),Promise.all(n)}).then(function(n){o.logger.log(e.user_friendly_id()+".enumerateDevices: returning enumerated devices with ids ["+n.map(function(e){return e.object_id()})+"]"),t(n),e.devices_.forEach(function(e){for(var t=!0,i=0;i<n.length;i++)if(e===n[i]){t=!1;break}t&&e.release()}),e.devices_=n}).catch(function(){o.logger.log(e.user_friendly_id()+".enumerateDevices() didnt get response."),e.devices_=[],i()})})},t.prototype.getDisplayMedia=function(e){var t=this;return new Promise(function(i,r){t.waitUntilConnected("RemoteDevices.getDisplayMedia").then(function(){return t.remoteInvoke(!1,n.method_id_MediaDevices_t.getDisplayMedia,e)}).then(function(e){return new s(null,e.params[0].oid).syncBarrier()}).then(function(e){i(e)}).catch(function(){o.logger.log(t.user_friendly_id()+".getDisplayMedia() returned an error."),r(new DOMException("Unable to get a display stream.","NotReadableError"))})})},t}(i.ProxyObject),t.RemoteDevices=e,i=function(e){function t(){return e.call(this,null,n.class_id_t.NavigatorUserMedia,0,!1)||this}return __extends(t,e),t.prototype.webkitGetUserMedia=function(e,t,n){this.getUserMedia(e,t,n)},t.prototype.getUserMedia=function(e,t,i){var r=this;o.logger.log(this.user_friendly_id()+".getUserMedia() called."),this.waitUntilConnected("NavigatorUserMedia.getUserMedia").then(function(){var t=r.registerCallbacks(!0,!1,n.method_id_NavigatorUserMedia_t.getUserMedia);return void 0!==e.audio&&0==Object.keys(e.audio).length&&(e.audio={dummy:1}),r.remoteInvoke(!1,n.method_id_NavigatorUserMedia_t.getUserMedia,e,t.success,t.fail),t.prom()}).then(function(e){return o.logger.log(r.user_friendly_id()+".getUserMedia: received success callback!"),new s(null,r.param0(e).oid).syncBarrier()}).then(function(e){o.logger.log(r.user_friendly_id()+".getUserMedia: MediaStream ready to deliver",e),t(e)}).catch(function(e){o.logger.log(e),i({constraintName:"",name:"NotReadableError",message:""})})},t}(i.ProxyObject),t.NavigatorUserMedia=i}),define("rtpsender",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){};t.RtpSender=n}),define("map",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),define("stats",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this.items=[]}return e.fromJSON=function(t){for(var n=new e,o=0;o<t.length;o++){var r=i.fromJSON(t[o]);n.items.push(r)}return n},e.prototype.toJSON=function(){return JSON.stringify(this.items)},e.prototype.result=function(){return this.items},e}();t.StatsReport=n;var i=function(){function e(){this.names_=[],this.stat_=new Map,this.id="",this.timestamp=0,this.type=""}return e.fromJSON=function(t){var n=new e;return n.id=t.id||"",n.timestamp=t.timestamp||"",n.type=t.type||"",Object.keys(t).forEach(function(e){"id"!==e&&"timestamp"!==e&&"type"!==e&&(n.names_.push(e),n.stat_.set(e,t[e]))}),n},e.prototype.toJSON=function(){return JSON.stringify({id:this.id,timestamp:this.timestamp,type:this.type,stat:this.stat_})},e.prototype.names=function(){return this.names_},e.prototype.stat=function(e){return this.stat_.get(e)},e}();t.Stats=i}),define("peerconnection","require exports remotemedia proxyobject webrpcclassinfo logger stats".split(" "),function(e,t,n,i,o,r,a){Object.defineProperty(t,"__esModule",{value:!0});var c=function(e){function t(t,n,i){return t=e.call(this,t,o.class_id_t.RTCIceCandidateEvent,n,!0)||this,t.target=i,t.type="icecandidate",t}return __extends(t,e),Object.defineProperty(t.prototype,"candidate",{get:function(){return this.candidate_},enumerable:!0,configurable:!0}),t.prototype.syncBarrier=function(){var e=this;return r.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise(function(t,n){e.waitUntilConnected("IceCandidateEvent.syncBarrier").then(function(){return e.remoteInvoke(!1,o.method_id_RTCIceCandidateEvent_t.candidate,{oid:0})}).then(function(t){return!1===(t=e.param0(t)).is_null?new s(e,t.oid).syncBarrier():Promise.resolve(null)}).then(function(n){r.logger.log(e.user_friendly_id()+".onicecandidate: icecandidate available!"),e.candidate_=n,t(e)}).catch(function(){r.logger.log(e.user_friendly_id()+".onicecandidate() failed."),n()})})},t}(i.ProxyObject);t.IceCandidateEvent=c;var s=function(e){function t(t,n){return e.call(this,t,o.class_id_t.RTCIceCandidate,n,!0)||this}return __extends(t,e),Object.defineProperty(t.prototype,"candidate",{get:function(){return this.candidate_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sdpMid",{get:function(){return this.sdpMid_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sdpMLineIndex",{get:function(){return this.sdpMLineIndex_},enumerable:!0,configurable:!0}),t.prototype.syncBarrier=function(){var e=this;return r.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise(function(t,n){e.waitUntilConnected("IceCandidate.syncBarrier").then(function(){return Promise.all([e.remoteInvoke(!1,o.method_id_RTCIceCandidate_t.candidate,""),e.remoteInvoke(!1,o.method_id_RTCIceCandidate_t.sdpMid,""),e.remoteInvoke(!1,o.method_id_RTCIceCandidate_t.sdpMLineIndex,0)])}).then(function(n){n=n.map(function(t){return e.param0(t)}),e.candidate_=n[0],e.sdpMid_=n[1],e.sdpMLineIndex_=n[2],t(e)}).catch(function(){n()})})},t}(i.ProxyObject);t.IceCandidate=s;var d=function(){function e(e){this.state_="new",this.candidates_=[],this.pc_=e}return e.prototype.pushState=function(e){r.logger.log(this.pc_.user_friendly_id()+".onicegatheringstatechange: new state is "+e),this.state_=e,"gathering"==this.state_?(this.candidates_=[],this.postUpdate()):this.processRemaining()},e.prototype.addIceCandidate=function(e){var t=this;this.candidates_.push(e),e.syncBarrier().then(function(e){return r.logger.log(t.pc_.user_friendly_id()+".onicecandidate: icecandidate available!"),Promise.all([t.pc_.updateLocalDescription(),Promise.resolve(e)])}).then(function(e){t.postIceCandidate(e[1])})},e.prototype.postIceCandidate=function(e){r.logger.log(this.pc_.user_friendly_id()+".onicecandidate: posting ice candidate now!"),null!=this.pc_.onicecandidate?this.pc_.onicecandidate(e):r.logger.log(this.pc_.user_friendly_id()+"onicecandidate is NULL!!!"),this.candidates_.shift(),this.processRemaining()},e.prototype.postUpdate=function(){r.logger.log(this.pc_.user_friendly_id()+".onicegatheringstatechange: posting event now!");var e=new u("onicegatheringstatechange",this.pc_);this.pc_.onicegatheringstatechange(e)},e.prototype.processRemaining=function(){0==this.candidates_.length&&"complete"==this.state_?(this.pc_.onicecandidate({candidate:null,target:this}),this.postUpdate()):r.logger.log(this.pc_.user_friendly_id()+".onicecandidate: candidates remaining=["+this.candidates_.map(function(e){return e.object_id()})+"], state="+this.state_)},e}(),l=function(e){function t(t,n,i){for(var r=[],a=3;a<arguments.length;a++)r[a-3]=arguments[a];return e.apply(this,[t,o.class_id_t.RTCSessionDescription,n,i].concat(r))||this}return __extends(t,e),t.prototype.toJSON=function(){return{type:this.type_,sdp:this.sdp_}},Object.defineProperty(t.prototype,"sdp",{get:function(){return this.sdp_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"type",{get:function(){return this.type_},enumerable:!0,configurable:!0}),t.prototype.syncBarrier=function(){var e=this;return r.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise(function(t,n){e.waitUntilConnected("SessionDescription.syncBarrier").then(function(){return Promise.all([e.remoteInvoke(!1,o.method_id_RTCSessionDescription_t.type,0),e.remoteInvoke(!1,o.method_id_RTCSessionDescription_t.sdp,"")])}).then(function(n){e.type_=e.convertType(e.param0(n[0])),e.sdp_=e.param0(n[1]),t(e)}).catch(function(){n()})})},t.prototype.convertType=function(e){return 0==e?"offer":1==e?"pranswer":"answer"},t.convertC2H=function(e){return"offer"==e?0:"pranswer"==e?1:2},t}(i.ProxyObject);t.SessionDescription=l;var u=function(e,t){this.type=e,this.target=t};e=function(e){function t(t){var n=e.call(this,null,o.class_id_t.RTCPeerConnection,0,!1,void 0!=t?t:{},{})||this;return r.logger.log("peerconnection.constructor"),r.logger.log(JSON.stringify(t)),n.localStreams=[],n.remoteStreams=[],n.onaddstream_=null,n.signalingState_="stable",n.iceConnectionState_="new",n.iceGatheringState_="new",n.iceQ_=new d(n),n}return __extends(t,e),t.prototype.addIceCandidate=function(){r.logger.log(this.user_friendly_id()+".addIceCandidate"),r.logger.log(arguments)},Object.defineProperty(t.prototype,"onicecandidate",{get:function(){return this.onicecandidate_},set:function(e){var t=this;r.logger.log(this.user_friendly_id()+".set_onicecandidate() called."),this.onicecandidate_=e,this.waitUntilConnected("PeerConnection.onicecandidate").then(function(){var n=t.registerCallbacks(!1,t.isNullCallback(e),o.method_id_RTCPeerConnection_t.onicecandidate);return n.then(function(e){r.logger.log(t.user_friendly_id()+".onicecandidate callback received!!!"),e=new c(t,t.param0(e).oid,t),null!=t.iceQ_&&t.iceQ_.addIceCandidate(e)}),t.remoteInvoke(!0,o.method_id_RTCPeerConnection_t.onicecandidate,n.success)}).catch(function(){r.logger.log(t.user_friendly_id()+".set_onicecandidate() failed.")})},enumerable:!0,configurable:!0}),t.prototype.convertIceConnectionState=function(e){return 0==e?"new":1==e?"checking":2==e?"connected":3==e?"completed":4==e?"failed":5==e?"disconnected":"closed"},Object.defineProperty(t.prototype,"oniceconnectionstatechange",{get:function(){return this.oniceconnectionstatechange_},set:function(e){var t=this;r.logger.log(this.user_friendly_id()+".set_oniceconnectionstatechange() called."),this.oniceconnectionstatechange_=e,this.waitUntilConnected("PeerConnection.oniceconnectionstatechange").then(function(){var n=t.registerCallbacks(!1,t.isNullCallback(e),o.method_id_RTCPeerConnection_t.oniceconnectionstatechange);return n.then(function(e){r.logger.log(t.user_friendly_id()+".oniceconnectionstatechange(): success callback received!!!"),t.iceConnectionState_=t.convertIceConnectionState(t.param0(e)),e=new u("iceconnectionstatechange",t),t.oniceconnectionstatechange_(e)}),t.remoteInvoke(!0,o.method_id_RTCPeerConnection_t.oniceconnectionstatechange,n.success)}).catch(function(){r.logger.log(t.user_friendly_id()+".set_oniceconnectionstatechange() failed.")})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"iceConnectionState",{get:function(){return r.logger.log(this.user_friendly_id()+".get_iceConnectionState() called, value = "+this.iceConnectionState_),this.iceConnectionState_},enumerable:!0,configurable:!0}),t.prototype.convertIceGatheringState=function(e){return 0==e?"new":1==e?"gathering":"complete"},Object.defineProperty(t.prototype,"onicegatheringstatechange",{get:function(){return this.onicegatheringstatechange_},set:function(e){var t=this;r.logger.log(this.user_friendly_id()+".set_onicegatheringstatechange() called."),this.onicegatheringstatechange_=e,this.waitUntilConnected("PeerConnection.onicegatheringstatechange").then(function(){var n=t.registerCallbacks(!1,t.isNullCallback(e),o.method_id_RTCPeerConnection_t.onicegatheringstatechange);return n.then(function(e){r.logger.log(t.user_friendly_id()+".onicegatheringstatechange(): callback received!!!"),t.iceGatheringState_=t.convertIceGatheringState(t.param0(e)),null!=t.iceQ_&&t.iceQ_.pushState(t.iceGatheringState_)}),t.remoteInvoke(!0,o.method_id_RTCPeerConnection_t.onicegatheringstatechange,n.success)}).catch(function(){r.logger.log(t.user_friendly_id()+".set_onicegatheringstatechange() failed.")})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"iceGatheringState",{get:function(){return r.logger.log(this.user_friendly_id()+".get_iceGatheringState() called, value = "+this.iceGatheringState_),this.iceGatheringState_},enumerable:!0,configurable:!0}),t.prototype.convertSignalState=function(e){return 0==e?"stable":1==e?"have-local-offer":2==e?"have-local-pranswer":3==e?"have-remote-offer":4==e?"have-remote-pranswer":"closed"},Object.defineProperty(t.prototype,"onsignalingstatechange",{set:function(e){var t=this;r.logger.log(this.user_friendly_id()+".set_onsignalingstatechange() called."),this.onsignalingstatechange_=e,this.waitUntilConnected("PeerConnection.onsignalingstatechanged").then(function(){var n=t.registerCallbacks(!1,t.isNullCallback(e),o.method_id_RTCPeerConnection_t.onsignalingstatechange);return n.then(function(e){r.logger.log(t.user_friendly_id()+".onsignalingstatechange(): callback received!!!"),t.signalingState_=t.convertSignalState(t.param0(e)),e=new u("onsignalingstatechange",t),t.onsignalingstatechange_(e)}),t.remoteInvoke(!0,o.method_id_RTCPeerConnection_t.onsignalingstatechange,n.success)}).catch(function(){r.logger.log(t.user_friendly_id()+".set_onsignalingstatechange(): failed.")})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onsignalingstatechanged",{get:function(){return this.onsignalingstatechange_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"signalingState",{get:function(){return r.logger.log(this.user_friendly_id()+".get_signalingState() called, value = "+this.signalingState_),this.signalingState_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onnegotiationneeded",{get:function(){return this.onnegotiationneeded_},set:function(e){var t=this;r.logger.log(this.user_friendly_id()+".set_onnegotiationneeded() called."),this.onnegotiationneeded_=e,this.waitUntilConnected("PeerConnection.onnegotiationneeded").then(function(){var n=t.registerCallbacks(!1,t.isNullCallback(e),o.method_id_RTCPeerConnection_t.onnegotiationneeded);return n.then(function(){r.logger.log(t.user_friendly_id()+".onnegotiationneeded(): callback received!!!");var e=new u("negotiationneeded",t);t.onnegotiationneeded_(e)}),t.remoteInvoke(!0,o.method_id_RTCPeerConnection_t.onnegotiationneeded,n.success)}).catch(function(){r.logger.log(t.user_friendly_id()+".set_onnegotiationneeded(): failed.")})},enumerable:!0,configurable:!0}),t.prototype.createOffer=function(e,t,n){var i=this;r.logger.log(this.user_friendly_id()+".createOffer() called.",JSON.stringify(n)),this.waitUntilConnected("PeerConnection.createOffer").then(function(){var e=i.registerCallbacks(!0,!1,o.method_id_RTCPeerConnection_t.createOffer);return i.remoteInvoke(!1,o.method_id_RTCPeerConnection_t.createOffer,e.success,e.fail,{}),e.prom()}).then(function(e){return r.logger.log(i.user_friendly_id()+".createOffer(): success callback received!!!"),new l(i,i.param0(e).oid,!0).syncBarrier()}).then(function(t){e&&e(t)}).catch(function(){r.logger.log(i.user_friendly_id()+".createOffer() failed."),t&&t(new DOMException("PeerConnection.createOffer() failed.","PeerConnection"))})},t.prototype.createAnswer=function(e,t,n){var i=this;r.logger.log(this.user_friendly_id()+".createAnswer() called.",JSON.stringify(n)),this.waitUntilConnected("PeerConnection.createAnswer").then(function(){var e=i.registerCallbacks(!0,!1,o.method_id_RTCPeerConnection_t.createAnswer);return i.remoteInvoke(!1,o.method_id_RTCPeerConnection_t.createAnswer,e.success,e.fail,{},{}),e.prom()}).then(function(e){return r.logger.log(i.user_friendly_id()+".createAnswer(): success callback received!!!"),new l(i,i.param0(e).oid,!0).syncBarrier()}).then(function(t){e&&e(t)}).catch(function(){r.logger.log(i.user_friendly_id()+".createAnswer() failed."),t&&t("PeerConnection::createAnswer() failed.")})},t.prototype.updateLocalDescription=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n;return __generator(this,function(i){switch(i.label){case 0:return r.logger.log(this.user_friendly_id()+".updateLocalDescription() called."),[4,this.remoteInvoke(!1,o.method_id_RTCPeerConnection_t.localDescription,{oid:this.object_id()})];case 1:return e=i.sent(),t=new l(this,this.param0(e).oid,!0),[4,t.syncBarrier()];case 2:return this.localDescription=n=i.sent(),[2]}})})},t.prototype.setLocalDescription=function(e,t,n){var i=this;r.logger.log(this.user_friendly_id()+".setLocalDescription() called."),this.waitUntilConnected("PeerConnection.setLocalDescription").then(function(){return new l(i,0,!1,{type:l.convertC2H(e.type),sdp:e.sdp}).syncBarrier()}).then(function(e){var n=i.registerCallbacks(!0,!1,o.method_id_RTCPeerConnection_t.setLocalDescription);i.remoteInvoke(!1,o.method_id_RTCPeerConnection_t.setLocalDescription,{oid:e.object_id()},n.success,n.fail),n.prom().then(function(){r.logger.log(i.user_friendly_id()+".setLocalDescription(): success callback received!!!"),i.localDescription=e,t&&t()})}).catch(function(){r.logger.log(i.user_friendly_id()+".setLocalDescription() failed."),n&&n("PeerConnection::setLocalDescription() failed.")})},t.prototype.setRemoteDescription=function(e,t,n){var i=this;r.logger.log(this.user_friendly_id()+".setRemoteDescription() called."),this.waitUntilConnected("PeerConnection.setRemoteDescription").then(function(){return new l(i,0,!1,{type:l.convertC2H(e.type),sdp:e.sdp}).syncBarrier()}).then(function(e){var n=i.registerCallbacks(!0,!1,o.method_id_RTCPeerConnection_t.setRemoteDescription);i.remoteInvoke(!1,o.method_id_RTCPeerConnection_t.setRemoteDescription,{oid:e.object_id()},n.success,n.fail),n.prom().then(function(){r.logger.log(i.user_friendly_id()+".setRemoteDescription(): success callback received!!!"),i.remoteDescription=e,t&&t()})}).catch(function(){r.logger.log(i.user_friendly_id()+".setRemoteDescription() failed."),n&&n("PeerConnection::setRemoteDescription() failed.")})},t.prototype.getLocalStreams=function(){return r.logger.log("PeerConnection.getLocalStreams() called. [oid="+this.object_id()+"]"),this.localStreams},t.prototype.getRemoteStreams=function(){return r.logger.log(this.user_friendly_id()+".getRemoteStreams() called."),this.remoteStreams},t.prototype.addStream=function(e){var t=this;r.logger.log(this.user_friendly_id()+".addStream() called.",e),this.localStreams.push(e),this.waitUntilConnected("PeerConnection.addStream").then(function(){return t.remoteInvoke(!1,o.method_id_RTCPeerConnection_t.addStream,{oid:e.object_id()},{})}).then(function(){r.logger.log(t.user_friendly_id()+".addStream() success.")}).catch(function(){r.logger.log(t.user_friendly_id()+".addStream() failed.")})},t.prototype.removeStream=function(e){var t=this;r.logger.log(this.user_friendly_id()+".removeStream() called.");for(var n=0;n<this.localStreams.length;n++)this.localStreams[n]==e&&this.localStreams.splice(n,1);this.waitUntilConnected("PeerConnection.removeStream").then(function(){return t.remoteInvoke(!1,o.method_id_RTCPeerConnection_t.removeStream,{oid:e.object_id()})}).then(function(){r.logger.log(t.user_friendly_id()+".removeStream() success.")}).catch(function(){r.logger.log(t.user_friendly_id()+".removeStream() failed.")})},Object.defineProperty(t.prototype,"onaddstream",{get:function(){return this.onaddstream_},set:function(e){var t=this;r.logger.log(this.user_friendly_id()+".set_onaddstream() called."),this.onaddstream_=e,this.waitUntilConnected("PeerConnection.onaddstream").then(function(){var i=t.registerCallbacks(!1,t.isNullCallback(e),o.method_id_RTCPeerConnection_t.onaddstream);return i.then(function(e){new n.RemoteStreamEvent(t,t.param0(e).oid).syncBarrier().then(function(e){r.logger.log(t.user_friendly_id()+".onaddstream callback received!"),t.remoteStreams.push(e.stream),t.onaddstream_(e)})}),t.remoteInvoke(!0,o.method_id_RTCPeerConnection_t.onaddstream,i.success)}).catch(function(){r.logger.log(t.user_friendly_id()+".set_onaddstream(): failed!")})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onremovestream",{get:function(){return this.onremovestream_},set:function(e){var t=this;r.logger.log(this.user_friendly_id()+".set_onremovestream() called."),this.onremovestream_=e,this.waitUntilConnected("PeerConnection.onremovestream").then(function(){var i=t.registerCallbacks(!1,t.isNullCallback(e),o.method_id_RTCPeerConnection_t.onremovestream);return i.then(function(e){new n.RemoteStreamEvent(t,t.param0(e).oid).syncBarrier().then(function(e){r.logger.log(t.user_friendly_id()+".onremovestream callback received!");var n=t.remoteStreams.findIndex(function(t){return t.id==e.stream.id});0<=n&&t.remoteStreams.splice(n,1),t.onremovestream_(e)})}),t.remoteInvoke(!0,o.method_id_RTCPeerConnection_t.onremovestream,i.success)}).catch(function(){r.logger.log(t.user_friendly_id()+".set_onremovestream(): failed!")})},enumerable:!0,configurable:!0}),t.prototype.getStats=function(e){r.logger.log(this.user_friendly_id()+".getStats");var t=this;return new Promise(function(n,i){t.isRedirected()?t.waitUntilConnected("PeerConnection.getStats").then(function(){var i=t.registerCallbacks(!0,!1,o.method_id_RTCPeerConnection_t.getStats);return i.then(function(t){void 0!==t.params&&0!==t.params.length&&(e(a.StatsReport.fromJSON(JSON.parse(t.params[0]))),n())}),t.remoteInvoke(!1,o.method_id_RTCPeerConnection_t.getStats,i.success)}).catch(function(){r.logger.log(t.user_friendly_id()+".getStats(): failed!"),i()}):(r.logger.log(t.user_friendly_id()+".getStats(): not in active redirection!"),e({}),n())})},t.prototype.close=function(){var e=this;r.logger.log(this.user_friendly_id()+".close() called."),this.onnegotiationneeded=this.onsignalingstatechange=this.onicegatheringstatechange=this.oniceconnectionstatechange=this.onicecandidate=this.onaddstream=null,this.waitUntilConnected("PeerConnection.close").then(function(){return e.remoteInvoke(!1,o.method_id_RTCPeerConnection_t.close)}).then(function(){e.iceQ_=null,e.release(),r.logger.log(e.user_friendly_id()+".close() success.")}).catch(function(){e.iceQ_=null,e.release(),r.logger.log(e.user_friendly_id()+".close() failed.")})},t.prototype.getSenders=function(){r.logger.log(this.user_friendly_id()+".getSenders() called.")},t.prototype.getReceivers=function(){r.logger.log(this.user_friendly_id()+".getReceivers() called.")},t}(i.ProxyObject),t.PeerConnection=e}),define("videoelement",["require","exports","proxyobject","webrpcclassinfo","logger"],function(e,t,n,i,o){Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){this.x=Math.round(e.x),this.y=Math.round(e.y),this.width=Math.round(e.width),this.height=Math.round(e.height)};t.VideoRect=r,e=function(e){function t(){var t=e.call(this,null,i.class_id_t.VideoElement,0,!1)||this;return t.srcObject_=null,t.sinkId_="",t.videoWidth=0,t.videoHeight=0,t.isLoaded=!1,t.connectionState="disconnected",t.dispose_=!1,t}return __extends(t,e),Object.defineProperty(t.prototype,"sinkId",{get:function(){return this.sinkId_},set:function(e){var t=this;this.waitUntilConnected("VideoElement.sinkId").then(function(){return t.remoteInvoke(!0,i.method_id_VideoElement_t.sinkId,e)}).then(function(){t.sinkId_=e}).catch(function(){o.logger.log(t.user_friendly_id()+".sinkId setter: failed to connect!")})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"srcObject",{get:function(){return this.srcObject_},set:function(e){o.logger.log(this.user_friendly_id()+".srcObject: set srcObject..."),this.srcObject_!==e&&(null!==this.srcObject_&&(null===e&&(this.dispose_=!0),this.disconnect(),this.isLoaded=!1),this.srcObject_=e,null!==this.srcObject_&&this.connectTo(this.srcObject_))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onconnectionstatechange",{get:function(){return this.onconnectionstatechange_},set:function(e){o.logger.log(this.user_friendly_id()+".set_onconnectionstatechange() called."),this.onconnectionstatechange_=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onloadedmetadata",{set:function(e){o.logger.log(this.user_friendly_id()+".set_onloadedmetadata() called."),this.onloadedmetadata_=e},enumerable:!0,configurable:!0}),t.prototype.setupOnVideoFrameChanged=function(){var e=this,t=this.registerCallbacks(!1,!1,i.method_id_VideoElement_t.onvideoframechanged);t.then(function(t){o.logger.log(e.user_friendly_id()+".onvideoframechanged",t.params),e.videoWidth=t.params[0]||0,e.videoHeight=t.params[1]||0,e.isLoaded||(e.isLoaded=!0,e.onloadedmetadata_&&e.onloadedmetadata_())}),this.remoteInvoke(!0,i.method_id_VideoElement_t.onvideoframechanged,t.success)},t.prototype.connectTo=function(e){var t=this;console.log(this.user_friendly_id()+".connectTo: connect media stream with id = "+e.object_id()+", clone_id = "+e.clone_state.clone_id),this.waitUntilConnected("VideoElement.connectTo").then(function(){return t.setupOnVideoFrameChanged(),e.clone_state.synchronize(e)}).then(function(e){var n=t.registerCallbacks(!0,!1,i.method_id_VideoElement_t.connectTo);return Promise.all([t.remoteInvoke(!1,i.method_id_VideoElement_t.connectTo,{oid:e.object_id()},n.success,n.fail),n.prom()])}).then(function(e){o.logger.log(t.user_friendly_id()+".connectTo: remote media stream is connected!"),t.onconnectionstatechange_&&(t.connectionState="connected",t.onconnectionstatechange_()),t.updateTimer=setInterval(function(){t.ontimeupdate&&t.ontimeupdate()},250)}).catch(function(e){o.logger.log(t.user_friendly_id()+".connectTo: failed to connect! msg = ",e)})},t.prototype.disconnect=function(){var e=this;o.logger.log(this.user_friendly_id()+".disconnect: disconnect from current media stream"),this.waitUntilConnected("VideoElement.disconnect").then(function(){e.updateTimer&&clearInterval(e.updateTimer),e.onconnectionstatechange_&&(e.connectionState="disconnected",e.onconnectionstatechange_());var t=e.registerCallbacks(!1,!0,i.method_id_VideoElement_t.onvideoframechanged);return e.remoteInvoke(!0,i.method_id_VideoElement_t.onvideoframechanged,t.success),e.remoteInvoke(!1,i.method_id_VideoElement_t.disconnect)}).then(function(){o.logger.log(e.user_friendly_id()+".disconnect: remote media stream is disconnected!")}).catch(function(){o.logger.log(e.user_friendly_id()+".disconnect: failed to connect!")})},t.prototype.setFrame=function(e){var t=this;o.logger.log(this.user_friendly_id()+".setFrame: set video frame to",e.x,e.y,e.width,e.height),this.waitUntilConnected("VideoElement.setFrame").then(function(){var n=new r(e);return t.remoteInvoke(!1,i.method_id_VideoElement_t.setFrame,n)}).then(function(){o.logger.log(t.user_friendly_id()+".setFrame: success!")}).catch(function(){o.logger.log(t.user_friendly_id()+".setFrame: failed to connect!")})},t.prototype.addClipRect=function(e){var t=this;o.logger.log(this.user_friendly_id()+".addClipRect: ",JSON.stringify(e)),this.waitUntilConnected("VideoElement.addClipRect").then(function(){var n=new r(e);return t.remoteInvoke(!1,i.method_id_VideoElement_t.addClipRect,n)}).catch(function(){o.logger.log(t.user_friendly_id()+".addClipRect failed!")})},t.prototype.removeClipRect=function(e){var t=this;o.logger.log(this.user_friendly_id()+".removeClipRect: ",JSON.stringify(e)),this.waitUntilConnected("VideoElement.removeClipRect").then(function(){var n=new r(e);return t.remoteInvoke(!1,i.method_id_VideoElement_t.removeClipRect,n)}).catch(function(){o.logger.log(t.user_friendly_id()+".removeClipRect failed!")})},t}(n.ProxyObject),t.VideoElement=e}),define("audioelement",["require","exports","proxyobject","webrpcclassinfo","logger"],function(e,t,n,i,o){Object.defineProperty(t,"__esModule",{value:!0}),e=function(e){function t(){var t=e.call(this,null,i.class_id_t.AudioElement,0,!1)||this;return t.sinkId_="",t.srcObject_=null,t}return __extends(t,e),Object.defineProperty(t.prototype,"sinkId",{get:function(){return this.sinkId_},set:function(e){var t=this;o.logger.log(this.user_friendly_id()+".sinkId: set sinkId to "+e),this.waitUntilConnected("AudioElement.sinkId").then(function(){return t.remoteInvoke(!0,i.method_id_AudioElement_t.sinkId,e)}).then(function(){t.sinkId_=e}).catch(function(){o.logger.log(t.user_friendly_id()+".sinkId setter: failed to connect!")})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"srcObject",{get:function(){return this.srcObject_},set:function(e){var t=this;if(o.logger.log(this.user_friendly_id()+".srcObject: set srcObject to "+JSON.stringify(e)),e!==this.srcObject_){var n=null!==e?e.object_id():"null";this.waitUntilConnected("AudioElement.srcObject").then(function(){return t.remoteInvoke(!0,i.method_id_AudioElement_t.srcObject,n)}).then(function(){t.srcObject_=e,null===e&&t.release()}).catch(function(){o.logger.log(t.user_friendly_id()+".srcObject setter: failed to connect!"),null===e&&t.release()})}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"src",{get:function(){return this.src_},set:function(e){var t=this;o.logger.log(this.user_friendly_id()+".src: set src to "+e),this.src_=e,this.waitUntilConnected("AudioElement.src").then(function(){t.remoteInvoke(!0,i.method_id_AudioElement_t.src,e)}).catch(function(){o.logger.log(t.user_friendly_id()+".src setter: failed to connect!")})},enumerable:!0,configurable:!0}),t.prototype.play=function(){var e=this;o.logger.log(this.user_friendly_id()+".play() called."),this.waitUntilConnected("AudioElement.play").then(function(){e.remoteInvoke(!1,i.method_id_AudioElement_t.play,[])}).catch(function(){o.logger.log(e.user_friendly_id()+".play: failed to connect!")})},t.prototype.pause=function(){var e=this;o.logger.log(this.user_friendly_id()+".pause() called."),this.waitUntilConnected("AudioElement.pause").then(function(){e.remoteInvoke(!1,i.method_id_AudioElement_t.pause,[])}).catch(function(){o.logger.log(e.user_friendly_id()+".pause: failed to connect!")})},t}(n.ProxyObject),t.AudioElement=e}),define("frametracker",["require","exports","logger","hdxms"],function(e,t,n,i){Object.defineProperty(t,"__esModule",{value:!0}),e=function(){function e(){var e=this;this.running_=!1,this.elements_=[];var t=i.getRedirector();Promise.all([(0,window.getWindowHandleAsHex)(),t.startRedirection(!1,"FrameTracker.ctor")]).then(function(e){n.logger.log("FrameTracker: set window handle: "+e[0]),t.WSSendObject({v:"overlay",command:"window",windowHandle:e[0]})}),this.observer_=new MutationObserver(function(t){e.updateAll()})}return e.prototype.rectanglesIntersect=function(e,t){return e.x<t.x+t.width&&e.x+e.width>t.x&&e.y<t.y+t.height&&e.y+e.height>t.y},e.prototype.intersectingRect=function(e,t){var n=Math.max(e.left,t.left),i=Math.max(e.top,t.top);return new DOMRect(n,i,Math.min(e.right,t.right)-n,Math.min(e.bottom,t.bottom)-i)},e.prototype.pedigreeCount=function(e,t){for(var n=0,i=e.parentElement;null!=i&&i!=t;)n++,i=i.parentElement;return{isAncestor:null!=i,pedigree:n}},e.prototype.selectTopmost=function(e,t){var n=e.getBoundingClientRect(),i=t.getBoundingClientRect(),n=this.intersectingRect(n,i);if((i=document.elementFromPoint(n.left+n.width/2,n.top+n.height/2))==e)return e;if(i==t)return t;if(n=this.pedigreeCount(e,i),i=this.pedigreeCount(t,i),n.isAncestor&&i.isAncestor){if(n.pedigree<i.pedigree)return e;if(i.pedigree<n.pedigree)return t}else{if(n.isAncestor)return e;if(i.isAncestor)return t}},e.prototype.checkOverlappingVideos=function(e){var t=this,n=e.target.getBoundingClientRect();e.overlaps.forEach(function(t){e.target.remoteVideoElement.removeClipRect(t.rect)}),e.overlaps=[],this.elements_.forEach(function(i){if(i!=e){var o=i.overlaps.map(function(e){return e.element}).indexOf(e.target);if(-1!=o&&(o=i.overlaps.splice(o,1)[0],i.target.remoteVideoElement.removeClipRect(o.rect)),o=i.target.getBoundingClientRect(),t.rectanglesIntersect(n,o)){var r=t.selectTopmost(e.target,i.target);r==e.target?(i.overlaps.push({element:e.target,rect:n}),i.target.remoteVideoElement.addClipRect(n)):r==i.target&&(e.overlaps.push({element:i.target,rect:o}),e.target.remoteVideoElement.addClipRect(o))}}})},e.prototype.updateAll=function(){var e=this;this.elements_.forEach(function(t){var n=t.target.getBoundingClientRect();if(void 0!==n){var i=t.clientRect;void 0!==i&&i.x===n.x&&i.y===n.y&&i.width===n.width&&i.height===n.height||(t.clientRect=n,t.callback(n),e.checkOverlappingVideos(t))}})},e.prototype.track=function(e,t){var i=e.getBoundingClientRect();n.logger.log("Track element frame",e,JSON.stringify(i)),console.log(e),this.elements_.push({target:e,clientRect:void 0,callback:t,overlaps:[]}),this.running_||(n.logger.log("Start FrameTracker observer..."),this.observer_.observe(document.body,{attributes:!0,childList:!0,subtree:!0}),this.running_=!0,this.updateAll())},e.prototype.untrack=function(e){n.logger.log("Untrack element frame",e);var t=-1;this.elements_.forEach(function(n,i){n.target===e&&(t=i)}),0<=t&&(this.elements_.splice(t,1),0===this.elements_.length&&(n.logger.log("Stop FrameTracker observer..."),this.observer_.disconnect(),this.running_=!1))},e.prototype.addOcclusion=function(e){var t=this;n.logger.log("[HdxWebRTC.js] Adding occlusion "+JSON.stringify(e)),n.logger.log("[HdxWebRTC.js] Tracking '"+this.elements_.length+"' elements."),this.elements_.forEach(function(n){var i=n.target.getBoundingClientRect();t.rectanglesIntersect(e,i)&&void 0!==n.target.remoteVideoElement&&n.target.remoteVideoElement.addClipRect(e)})},e.prototype.removeOcclusion=function(e){var t=this;n.logger.log("[HdxWebRTC.js] Removing occlusion "+JSON.stringify(e)),n.logger.log("[HdxWebRTC.js] Tracking '"+this.elements_.length+"' elements."),this.elements_.forEach(function(n){var i=n.target.getBoundingClientRect();t.rectanglesIntersect(e,i)&&void 0!==n.target.remoteVideoElement&&n.target.remoteVideoElement.removeClipRect(e)})},e}(),t.FrameTracker=e}),define("enginecontrol","require exports webrpcclassinfo hdxms proxyobject logger".split(" "),function(e,t,n,i,o,r){Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Webrpc=0]="Webrpc",e[e.WebrtcCodecs=1]="WebrtcCodecs",e[e.Receiver=2]="Receiver",e[e.Vda=3]="Vda",e[e.Endpoint=4]="Endpoint",e[e.TypeScript=5]="TypeScript",e[e.Max=6]="Max"}(t.VersionType||(t.VersionType={})),e=function(e){function t(){return e.call(this,null,n.class_id_t.EngineControl,0,!1)||this}return __extends(t,e),t.prototype.syncBarrier=function(){var e=this;return r.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise(function(t,o){e.waitUntilConnected("EngineControl.syncBarrier").then(function(){return Promise.all([e.remoteInvoke(!1,n.method_id_EngineControl_t.version,{major:0,minor:0,revision:0,build:0}),e.remoteInvoke(!1,n.method_id_EngineControl_t.feature_flags,[])])}).then(function(t){r.logger.log(e.user_friendly_id()+"received webrpc version and supported feature list."),t=t.map(function(t){return e.param0(t)}),e.version_=t[0],e.features_=t[1],i.getRedirector().setFeatures(e.features_),t=0;for(var o=e.features_;t<o.length;t++){var a=o[t];if("ms_teams_desktop_sharing"===a.name&&!0===a.value)return Promise.all([e.remoteInvoke(!1,n.method_id_EngineControl_t.version_info,[])])}}).then(function(n){void 0===n?r.logger.log(e.user_friendly_id()+"release-1905 client."):(r.logger.log(e.user_friendly_id()+"release-1906 or later client: received detailed client version list."),e.versions_=n.map(function(t){return e.param0(t)})[0]),t(e)}).catch(function(){r.logger.log(e.user_friendly_id()+"failure to retrieve version/feature related client info."),o()})})},t}(o.ProxyObject),t.EngineControl=e}),define("remotesession","require exports hdxms webrpcclassinfo enginecontrol logger".split(" "),function(e,t,n,i,o,r){Object.defineProperty(t,"__esModule",{value:!0});var a;!function(e){e[e.Unknown=0]="Unknown",e[e.Windows=1]="Windows",e[e.Linux=2]="Linux"}(a=t.RemoteType||(t.RemoteType={}));var c=function(){};t.SessionInfo=c;var s=function(e,t){this.type=e,this.version=t};t.VersionInfo=s,e=function(){function e(){var e=this;this.isremote_=!1,this.isremote_=!0,this.type_=a.Windows,this.address_="0.0.0.0",this.sessioninfo_=null,this.enginecontrol_=new o.EngineControl,n.getRedirector().setRemoteSessionInfoCb(function(){return e.remoteSessionInfo()})}return e.prototype.release=function(){n.getRedirector().setRemoteSessionInfoCb(null)},e.prototype.user_friendly_id=function(){return"[RemoteSession]"},e.prototype.getSessionInfo=function(){return r.logger.log(this.user_friendly_id()+".getSessionInfo() called."),null!=this.sessioninfo_?Promise.resolve(this.sessioninfo_):this.remoteSessionInfo()},e.prototype.remoteSessionInfo=function(){var e=this;return r.logger.log(e.user_friendly_id()+".getSessionInfo() called."),new Promise(function(t,n){e.enginecontrol_.syncBarrier().then(function(n){if(r.logger.log(e.user_friendly_id()+"enginecontrol info received!"),e.sessioninfo_=new c,e.sessioninfo_.type_script=new s(o.VersionType.TypeScript,i.HDXMS_VERSION),e.sessioninfo_.webrpc=new s(o.VersionType.Webrpc,n.version_.major.toString()+"."+n.version_.minor.toString()+"."+n.version_.revision.toString()+"."+n.version_.build.toString()),void 0!=n.versions_&&null!=n.versions_){var a=0,d=0;for(n=n.versions_;d<n.length;d++){var l=(l=n[d]).major.toString()+"."+l.minor.toString()+"."+l.revision.toString()+"."+l.build.toString();switch(a){case o.VersionType.Webrpc:e.sessioninfo_.webrpc=new s(a,l);break;case o.VersionType.WebrtcCodecs:e.sessioninfo_.webrtc_codecs=new s(a,l);break;case o.VersionType.Receiver:e.sessioninfo_.receiver=new s(a,l);break;case o.VersionType.Vda:e.sessioninfo_.vda=new s(a,l);break;case o.VersionType.Endpoint:e.sessioninfo_.endpoint=new s(a,l);break;default:r.logger.log(e.user_friendly_id()+"Unknown version type!")}a++}}t(e.sessioninfo_),e.enginecontrol_.release()}).catch(function(){n(),e.enginecontrol_.release()})})},e}(),t.RemoteSession=e});var vdishim=require("./peerconnection"),rmshim=require("./remotemedia"),videoelem=require("./videoelement"),audioelem=require("./audioelement"),frametracker=require("./frametracker"),logger=require("./logger").logger,remotesession=require("./remotesession");!function(e,t){"object"==typeof module&&module.exports?module.exports=t():e.vdiPeerConnection=t()}("undefined"!=typeof self?self:this,function(){function e(){null===u&&(u=new remotesession.RemoteSession),u.getSessionInfo().then(function(e){e.event="vdiClientConnected",logger.log("getSessionInfo success! info:"+JSON.stringify(e)),d(e)}).catch(function(){logger.log("getSessionInfo failure! session is not fully connected yet..."),u=null})}function t(){logger.log("VDI : cleanup"),s=r=i=null,u&&u.release(),u=null}var n=vdishim.PeerConnection,i=new rmshim.NavigatorUserMedia,o=i.webkitGetUserMedia,r=new rmshim.RemoteDevices,a=r.enumerateDevices,c=r.getDisplayMedia,s=new frametracker.FrameTracker,d=void 0;window.onVdiClientDisconnected=function(){logger.log("VDI Event: vdiClientDisconnected"),t(),l=!1,d({event:"vdiClientDisconnected",request:"endCalls"})},window.onVdiClientDisconnectedTimer=function(){logger.log("VDI Event: onVdiClientDisconnectedTimer"),e()},window.onVdiClientConnected=function(){logger.log("VDI Event: vdiClientConnected"),e()};var l=!1;window.onVdiUnableToRemote=function(){logger.log("VDI Event: vdiUnableToRemote"),t(),!1===l&&(logger.log("VDI Event: vdiUnableToRemote reported"),l=!0,d({event:"vdiUnableToRemote"}))};var u=new remotesession.RemoteSession;return{createPeerConnection:function(e,t){var i=new n(e,t),o=i.createOffer;i.createOffer=function(){return logger.log("VDI Shim createOffer"),o.apply(i,arguments)};var r=i.createAnswer;i.createAnswer=function(){return logger.log("VDI Shim createAnswer"),r.apply(i,arguments)};var a=i.setRemoteDescription;i.setRemoteDescription=function(){return logger.log("VDI Shim setRemoteDescription"),a.apply(i,arguments)};var c=i.setLocalDescription;i.setLocalDescription=function(){return logger.log("VDI Shim setLocalDescription"),c.apply(i,arguments)};var s=i.createDTMFSender;i.createDTMFSender=function(){return logger.log("VDI Shim createDTMFSender"),s.apply(i,arguments)};var d=i.getLocalStreams;i.getLocalStreams=function(){return logger.log("VDI Shim getLocalStreams"),d.apply(i,arguments)};var l=i.getRemoteStreams;i.getRemoteStreams=function(){return logger.log("VDI Shim getRemoteStreams"),l.apply(i,arguments)};var u=i.getStats;i.getStats=function(){return logger.log("VDI Shim getStats"),u.apply(i,arguments)};var g=i.addStream;i.addStream=function(){return logger.log("VDI Shim addStream"),g.apply(i,arguments)};var f=i.removeStream;i.removeStream=function(){return logger.log("VDI Shim removeStream"),f.apply(i,arguments)};var p=i.getReceivers;i.getReceivers=function(){return logger.log("VDI Shim getReceivers"),p.apply(i,arguments)};var h=i.close;return i.close=function(){return logger.log("VDI Shim close"),h.apply(i,arguments)},i},getUserMediaShim:function(e,t,n){return logger.log("VDI Shim getUserMedia"),null===i&&(i=new rmshim.NavigatorUserMedia,o=i.webkitGetUserMedia),o.apply(i,arguments)},getDisplayMediaShim:function(e){return logger.log("VDI Shim getDisplayMedia"),null===r&&(r=new rmshim.RemoteDevices,c=r.getDisplayMedia),c.apply(r,arguments)},enumerateDevicesShim:function(){return logger.log("VDI Shim enumerateDevices"),null===r&&(r=new rmshim.RemoteDevices,a=r.enumerateDevices),a.apply(r,arguments)},newAudioElement:function(e){logger.log("VDI New Audio Element Created, Creating Mapping to Thin Client DOM "),void 0!==e.remoteAudioElement?logger.log("Audio element is already configured!!!"):(Object.defineProperty(e,"remoteAudioElement",{writable:!0,value:null}),e.remoteAudioElement=new audioelem.AudioElement,Object.defineProperty(e,"sinkId",{writable:!0}),e.setSinkId=function(t){logger.log("VDI Shim set audio element SinkId value = "+t),e.remoteAudioElement.sinkId=t},Object.defineProperty(e,"srcObject",{get:function(){return e.remoteAudioElement.srcObject},set:function(t){logger.log("VDI Shim set audio element srcObject "+JSON.stringify(t)),null===t&&e.remoteAudioElement.release()}}))},newVideoElement:function(e){logger.log("VDI New Video Element Created, Creating Mapping to Thin Client DOM"),null===s&&(s=new frametracker.FrameTracker),void 0!==e.remoteVideoElement?logger.log("Video element is already configured!!!"):(Object.defineProperty(e,"remoteVideoElement",{writable:!0,value:null}),e.remoteVideoElement=new videoelem.VideoElement,e.remoteVideoElement.onloadedmetadata=function(){var t=new Event("loadedmetadata");e.dispatchEvent(t)},e.remoteVideoElement.ontimeupdate=function(){var t=new Event("timeupdate");e.dispatchEvent(t)},e.remoteVideoElement.onconnectionstatechange=function(){"connected"==e.remoteVideoElement.connectionState?s.track(e,function(t){e.remoteVideoElement.setFrame(t)}):s.untrack(e)},Object.defineProperty(e,"sinkId",{get:function(){return e.remoteVideoElement.sinkId},set:function(t){logger.log("VDI Shim set video element SinkId value = "+t),e.remoteVideoElement.sinkId=t}}),Object.defineProperty(e,"srcObject",{get:function(){return e.remoteVideoElement.srcObject},set:function(t){logger.log("VDI Shim set video element srcObject"),e.remoteVideoElement.srcObject=t}}),Object.defineProperty(e,"videoWidth",{get:function(){return e.remoteVideoElement.videoWidth}}),Object.defineProperty(e,"videoHeight",{get:function(){return e.remoteVideoElement.videoHeight}}))},setVMEventCallback:function(e){d=e,logger.log("VDI Event Callback Set")},playNotifyAudio:function(e,t){""!==(t="")&&logger.log("VDI Shim Audio Notification Playing, Remote to Thin Client "+t)},pauseNotifyAudio:function(e,t){""!==(t="")&&logger.log("VDI Shim Audio Notification Paused, Remote to Thin Client "+t)},setSinkId:function(e,t){logger.log("VDI Shim Audio setSinkId audioId:"+e+" sinkId:"+t)},setDefaultSinkId:function(e){logger.log("VDI Shim Audio setSinkId sinkId:"+e)},addClipRect:function(e){logger.log("VDI Adding Occlusion "+JSON.stringify(e)),null===s&&(s=new frametracker.FrameTracker),s.addOcclusion(e)},removeClipRect:function(e){logger.log("VDI Removing Occlusion "+JSON.stringify(e)),null===s&&(s=new frametracker.FrameTracker),s.removeOcclusion(e)},init:function(e){logger.setMSLogger(e),logger.log("VDI init logger")}}});
//# sourceMappingURL=https://statics.teams.microsoft.com/hashedjs/vdiCitrixPeerConnection2.js-ac27fe00.map